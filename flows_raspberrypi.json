[
    {
        "id": "76c778b95ae3572e",
        "type": "tab",
        "label": "Assorted",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "9122054e.29969",
        "type": "tab",
        "label": "Neopixels",
        "disabled": false,
        "info": ""
    },
    {
        "id": "459a3a0f.cadb4c",
        "type": "tab",
        "label": "Temperature control",
        "disabled": false,
        "info": ""
    },
    {
        "id": "fe7297a4.e6dc1",
        "type": "tab",
        "label": "Kodi",
        "disabled": false,
        "info": ""
    },
    {
        "id": "53214520.af847c",
        "type": "tab",
        "label": "P1",
        "disabled": false,
        "info": ""
    },
    {
        "id": "dd00ef6b.1ab33",
        "type": "tab",
        "label": "AXA",
        "disabled": false,
        "info": ""
    },
    {
        "id": "47b85eed.4f8768",
        "type": "tab",
        "label": "AMP IR",
        "disabled": false,
        "info": ""
    },
    {
        "id": "1ce9f9b0.4eb196",
        "type": "tab",
        "label": "Discharger",
        "disabled": false,
        "info": ""
    },
    {
        "id": "5ecdcc0a.76574c",
        "type": "tab",
        "label": "LCD",
        "disabled": false,
        "info": ""
    },
    {
        "id": "d8803db646ffca0f",
        "type": "tab",
        "label": "KP184",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "f7c3f5b1.15af3",
        "type": "subflow",
        "name": "BufferFlow",
        "info": "Connect both the external input and\nthe control output to the input.\nMake sure the control has topic 'control'\nThe output should be connected to the input\nof the control.",
        "in": [
            {
                "x": 40,
                "y": 180,
                "wires": [
                    {
                        "id": "ea4d6784.fc38b"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 880,
                "y": 180,
                "wires": [
                    {
                        "id": "230bc5d2.7396a2",
                        "port": 0
                    }
                ]
            }
        ]
    },
    {
        "id": "88ca25f284925286",
        "type": "group",
        "z": "76c778b95ae3572e",
        "name": "Small display header",
        "style": {
            "fill": "#bfdbef",
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "c03904e8.eae328",
            "72c315d3.7abf64",
            "88d8c6a6.33ee2",
            "4dc22ed0.90af3",
            "eb748fda.fbcb88",
            "cbc9b8e1.8d4d2",
            "98a0bd0c.674268",
            "e86fa4f8.ce18e8",
            "52af6729c7028a1d"
        ],
        "x": 54,
        "y": 79,
        "w": 1072,
        "h": 262
    },
    {
        "id": "1697a5bffd1de833",
        "type": "group",
        "z": "76c778b95ae3572e",
        "name": "LED strip brightness",
        "style": {
            "fill": "#bfdbef",
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "98327496.bfed28",
            "5d56d136.f96c18",
            "dbbe7721.83f838",
            "463deb53.e62e44"
        ],
        "x": 54,
        "y": 379,
        "w": 552,
        "h": 162
    },
    {
        "id": "aad3cec1c3ea6bf3",
        "type": "group",
        "z": "76c778b95ae3572e",
        "name": "Doorbell testing",
        "style": {
            "fill": "#e3f3d3",
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "14fe4241.fdab76",
            "3b9016f1.6d2232",
            "e84a50b41929a9ab",
            "03eb931f7a6e3479"
        ],
        "x": 314,
        "y": 579,
        "w": 492,
        "h": 142
    },
    {
        "id": "40f8dec5a1cd082a",
        "type": "group",
        "z": "76c778b95ae3572e",
        "name": "Server sounds",
        "style": {
            "fill": "#bfdbef",
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "e2ba0b59.7d901",
            "6c6af118.4fa65",
            "af2a2eca.6e18e8",
            "bab6bf5de35d28d1",
            "8f0dfa83e88b79a9",
            "40c2382e81ff0848",
            "5dcd1391e0e9146e",
            "3d6328bb.df1c9"
        ],
        "x": 314,
        "y": 759,
        "w": 672,
        "h": 162
    },
    {
        "id": "cee831a055a4415c",
        "type": "group",
        "z": "76c778b95ae3572e",
        "name": "Solar",
        "style": {
            "fill": "#bfdbef",
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "2890bb46.0c3124",
            "6757fa12.66ed94",
            "99968074.722f88",
            "2348e05d.e3d64",
            "2e363d39.1628da",
            "7b37f4d0.653aa4",
            "cf463c2c.d0c398"
        ],
        "x": 54,
        "y": 1059,
        "w": 812,
        "h": 202
    },
    {
        "id": "326cb0c425d84f87",
        "type": "group",
        "z": "76c778b95ae3572e",
        "name": "Central heating",
        "style": {
            "fill": "#bfdbef",
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "0b3731705511f2d3",
            "33235cb24294f9cc",
            "2d7af49fbb9d5cb8",
            "6fad1f83889df6a8",
            "3bc1ecc2b79435ae",
            "2dd30816124478db",
            "f467169fa32ae12e",
            "7782fcdd5ce50be7",
            "dc1cb9593c2db61c",
            "62f946eab6ef55b4",
            "4d2cce54441b0f6a"
        ],
        "x": 64,
        "y": 1299,
        "w": 1062,
        "h": 282
    },
    {
        "id": "245c6352e67871c3",
        "type": "group",
        "z": "76c778b95ae3572e",
        "name": "Temperature / Humidity",
        "style": {
            "fill": "#bfdbef",
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "d2baeb97d466f9c2",
            "291797345c53722b",
            "ec4f6398910cefaa",
            "411f279796897c37",
            "65fd0d1e9908923b",
            "997545a4b06e810a",
            "bf6daca12632d79c",
            "540ac6a89690e985",
            "e5385a494ece704a"
        ],
        "x": 54,
        "y": 1619,
        "w": 832,
        "h": 282
    },
    {
        "id": "40c2382e81ff0848",
        "type": "junction",
        "z": "76c778b95ae3572e",
        "g": "40f8dec5a1cd082a",
        "x": 340,
        "y": 860,
        "wires": [
            [
                "8f0dfa83e88b79a9",
                "bab6bf5de35d28d1"
            ]
        ]
    },
    {
        "id": "5dcd1391e0e9146e",
        "type": "junction",
        "z": "76c778b95ae3572e",
        "g": "40f8dec5a1cd082a",
        "x": 340,
        "y": 800,
        "wires": [
            [
                "6c6af118.4fa65"
            ]
        ]
    },
    {
        "id": "df7451c1.bfdb28",
        "type": "ui_base",
        "theme": {
            "customTheme": {
                "baseColor": "#4B7930",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "default": "#4B7930",
                "name": "Untitled Theme 1"
            },
            "darkTheme": {
                "baseColor": "#097479",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "default": "#097479",
                "edited": true,
                "reset": false
            },
            "lightTheme": {
                "baseColor": "#0094CE",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "default": "#0094CE",
                "edited": true,
                "reset": false
            },
            "name": "theme-dark",
            "themeState": {
                "base-color": {
                    "default": "#097479",
                    "edited": true,
                    "value": "#097479"
                },
                "base-font": {
                    "value": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
                },
                "group-backgroundColor": {
                    "edited": false,
                    "value": "#333333"
                },
                "group-borderColor": {
                    "edited": false,
                    "value": "#555555"
                },
                "group-textColor": {
                    "edited": false,
                    "value": "#0eb8c0"
                },
                "page-backgroundColor": {
                    "edited": false,
                    "value": "#111111"
                },
                "page-sidebar-backgroundColor": {
                    "edited": false,
                    "value": "#333333"
                },
                "page-titlebar-backgroundColor": {
                    "edited": false,
                    "value": "#097479"
                },
                "widget-backgroundColor": {
                    "edited": false,
                    "value": "#097479"
                },
                "widget-borderColor": {
                    "edited": false,
                    "value": "#333333"
                },
                "widget-textColor": {
                    "edited": false,
                    "value": "#eeeeee"
                }
            },
            "angularTheme": {
                "primary": "indigo",
                "accents": "blue",
                "warn": "red",
                "background": "grey",
                "palette": "light"
            }
        },
        "site": {
            "allowSwipe": "false",
            "dateFormat": "DD/MM/YYYY",
            "hideToolbar": "false",
            "name": "Node-RED Dashboard",
            "sizes": {
                "cx": 6,
                "cy": 6,
                "gx": 6,
                "gy": 6,
                "px": 0,
                "py": 0,
                "sx": 48,
                "sy": 48
            },
            "lockMenu": "false"
        }
    },
    {
        "id": "5cee9693.358b08",
        "type": "ui_tab",
        "name": "Temps",
        "icon": "dashboard",
        "order": 3
    },
    {
        "id": "69f5a3df.5a8b0c",
        "type": "mqtt-broker",
        "name": "PI",
        "broker": "raspberrypi.fritz.box",
        "port": "1883",
        "clientid": "",
        "usetls": false,
        "compatmode": true,
        "keepalive": "60",
        "cleansession": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthPayload": "",
        "closeTopic": "",
        "closeQos": "0",
        "closePayload": "",
        "willTopic": "",
        "willQos": "0",
        "willPayload": ""
    },
    {
        "id": "b47e83d3.de77e",
        "type": "ui_tab",
        "name": "Dashboard",
        "icon": "dashboard",
        "order": 1
    },
    {
        "id": "ddd0fc4c.8a5e8",
        "type": "ui_group",
        "name": "Bedroom",
        "tab": "b47e83d3.de77e",
        "order": 3,
        "disp": true,
        "width": "6"
    },
    {
        "id": "42b6ae00.90b7d4",
        "type": "ui_group",
        "name": "Home",
        "tab": "b47e83d3.de77e",
        "order": 4,
        "disp": true,
        "width": "6",
        "collapse": false
    },
    {
        "id": "c8a54de6.369ff",
        "type": "ui_group",
        "name": "NeoPixels",
        "tab": "b47e83d3.de77e",
        "order": 5,
        "disp": true,
        "width": "6"
    },
    {
        "id": "a8db762f.1aeb8",
        "type": "ui_group",
        "name": "Desk",
        "tab": "b47e83d3.de77e",
        "order": 1,
        "disp": true,
        "width": "6"
    },
    {
        "id": "9677c439.5fa54",
        "type": "ui_group",
        "name": "Kodi",
        "tab": "b47e83d3.de77e",
        "order": 7,
        "disp": true,
        "width": "6",
        "collapse": false
    },
    {
        "id": "b9ef850f.12a2",
        "type": "position-config",
        "name": "Home2",
        "isValide": "true",
        "longitude": "0",
        "latitude": "0",
        "angleType": "deg",
        "timeZoneOffset": 99,
        "timeZoneDST": 0,
        "stateTimeFormat": "3",
        "stateDateFormat": "12"
    },
    {
        "id": "8f71738d.39f7d8",
        "type": "ui_tab",
        "name": "Power",
        "icon": "fa-plug",
        "order": 4,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "3c71ce20.73a8c2",
        "type": "ui_tab",
        "name": "Solar only",
        "icon": "dashboard",
        "order": 5,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "38eddcdf.4bf11c",
        "type": "ui_tab",
        "name": "Home power",
        "icon": "dashboard",
        "order": 6,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "3ecae79f.798258",
        "type": "ui_tab",
        "name": "AMP",
        "icon": "dashboard",
        "order": 6,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "ffd321ee.bc6a68",
        "type": "ui_group",
        "name": "AMP",
        "tab": "3ecae79f.798258",
        "order": 1,
        "disp": false,
        "width": "6",
        "collapse": false
    },
    {
        "id": "5a94b1ee.ca1428",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "ffd321ee.bc6a68",
        "order": 2,
        "width": 2,
        "height": 1
    },
    {
        "id": "57d529e4.de3f58",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "ffd321ee.bc6a68",
        "order": 4,
        "width": 4,
        "height": 1
    },
    {
        "id": "e756cac3.f4dce",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "ffd321ee.bc6a68",
        "order": 6,
        "width": 6,
        "height": 1
    },
    {
        "id": "5d5caac3.0a752c",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "ffd321ee.bc6a68",
        "order": 13,
        "width": "6",
        "height": "1"
    },
    {
        "id": "9e729019.2637e",
        "type": "influxdb",
        "hostname": "127.0.0.1",
        "port": "8086",
        "protocol": "http",
        "database": "database",
        "name": "InfluxDB-Flux",
        "usetls": false,
        "tls": "",
        "influxdbVersion": "2.0",
        "url": "http://debian.fritz.box:8086",
        "rejectUnauthorized": true
    },
    {
        "id": "b3110722.bd5e3",
        "type": "ui_tab",
        "name": "Watt Meter",
        "icon": "dashboard",
        "disabled": false,
        "hidden": false
    },
    {
        "id": "c2fe2d52.ecd92",
        "type": "ui_group",
        "name": "Display",
        "tab": "b3110722.bd5e3",
        "order": 1,
        "disp": true,
        "width": "6",
        "collapse": false
    },
    {
        "id": "5228a8eb.6285a8",
        "type": "ui_group",
        "name": "Values",
        "tab": "b3110722.bd5e3",
        "order": 2,
        "disp": true,
        "width": "6",
        "collapse": false
    },
    {
        "id": "cfb855fc5bc17af9",
        "type": "ui_group",
        "name": "Control",
        "tab": "b3110722.bd5e3",
        "order": 3,
        "disp": true,
        "width": "6",
        "collapse": false
    },
    {
        "id": "c5472008.083cd8",
        "type": "change",
        "z": "f7c3f5b1.15af3",
        "name": "",
        "rules": [
            {
                "p": "topic",
                "pt": "msg",
                "t": "set",
                "to": "trigger",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 370,
        "y": 240,
        "wires": [
            [
                "267878a1.6cb448"
            ]
        ]
    },
    {
        "id": "267878a1.6cb448",
        "type": "trigger",
        "z": "f7c3f5b1.15af3",
        "name": "",
        "op1": "true",
        "op2": "false",
        "op1type": "str",
        "op2type": "str",
        "duration": "1000",
        "extend": true,
        "units": "ms",
        "reset": "",
        "bytopic": "all",
        "outputs": 1,
        "x": 560,
        "y": 240,
        "wires": [
            [
                "230bc5d2.7396a2"
            ]
        ]
    },
    {
        "id": "230bc5d2.7396a2",
        "type": "function",
        "z": "f7c3f5b1.15af3",
        "name": "buffer",
        "func": "// Message from trigger\n// The trigger sends true, then false after 1s\nif(msg.topic == \"trigger\") {\n    context.set('wait', msg.payload);\n    if(msg.payload == 'true') {\n        // Trigger started, wait...\n        return null;\n    }\n\n    // Get and remove buffered value, then send it\n    var buffered = context.get('buf');\n    if(typeof buffered !== 'undefined' &&\n       buffered !== null) {\n        context.set('buf', null);\n        return {payload: buffered};\n    }\n    return null;\n}\n\n// Message from external input\nif(context.get('wait') == 'true') {\n    // Trigger active, store value\n    context.set('buf', msg.payload);\n    return null;\n}\n\n// Trigger not active, pass on value\nreturn {payload: msg.payload};\n",
        "outputs": 1,
        "noerr": 0,
        "x": 750,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "ea4d6784.fc38b",
        "type": "switch",
        "z": "f7c3f5b1.15af3",
        "name": "Extract control",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "control",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 180,
        "y": 180,
        "wires": [
            [
                "230bc5d2.7396a2"
            ],
            [
                "c5472008.083cd8"
            ]
        ]
    },
    {
        "id": "c03904e8.eae328",
        "type": "mqtt out",
        "z": "76c778b95ae3572e",
        "g": "88ca25f284925286",
        "name": "",
        "topic": "devices/3c71bf0c0ad4/display/header/set",
        "qos": "2",
        "retain": "true",
        "broker": "69f5a3df.5a8b0c",
        "x": 940,
        "y": 180,
        "wires": []
    },
    {
        "id": "72c315d3.7abf64",
        "type": "inject",
        "z": "76c778b95ae3572e",
        "g": "88ca25f284925286",
        "name": "",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "Hello dragon!",
        "payloadType": "str",
        "x": 570,
        "y": 260,
        "wires": [
            [
                "c03904e8.eae328"
            ]
        ]
    },
    {
        "id": "88d8c6a6.33ee2",
        "type": "mqtt in",
        "z": "76c778b95ae3572e",
        "g": "88ca25f284925286",
        "name": "Bedroom temp. inside",
        "topic": "devices/0085b208/f6011581e788ff28/temperature",
        "qos": "2",
        "datatype": "utf8",
        "broker": "69f5a3df.5a8b0c",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 180,
        "y": 120,
        "wires": [
            [
                "cbc9b8e1.8d4d2"
            ]
        ]
    },
    {
        "id": "4dc22ed0.90af3",
        "type": "inject",
        "z": "76c778b95ae3572e",
        "g": "88ca25f284925286",
        "name": "",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "Squeee!",
        "payloadType": "str",
        "x": 560,
        "y": 300,
        "wires": [
            [
                "c03904e8.eae328"
            ]
        ]
    },
    {
        "id": "eb748fda.fbcb88",
        "type": "mqtt in",
        "z": "76c778b95ae3572e",
        "g": "88ca25f284925286",
        "name": "Bedroom temp. outside",
        "topic": "devices/0085b208/c480000003e30d28/temperature",
        "qos": "2",
        "datatype": "utf8",
        "broker": "69f5a3df.5a8b0c",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 180,
        "y": 180,
        "wires": [
            [
                "cbc9b8e1.8d4d2"
            ]
        ]
    },
    {
        "id": "cbc9b8e1.8d4d2",
        "type": "function",
        "z": "76c778b95ae3572e",
        "g": "88ca25f284925286",
        "name": "Rename topic",
        "func": "if(msg.topic == \"devices/0085b208/f6011581e788ff28/temperature\") {\n    msg.topic = \"bedroom_inside\";\n}\nif(msg.topic == \"devices/0085b208/c480000003e30d28/temperature\") {\n    msg.topic = \"bedroom_outside\";\n}\nif(msg.topic == \"bedroom_outside_api\") {\n    msg.topic = \"bedroom_outside\";\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 180,
        "wires": [
            [
                "98a0bd0c.674268"
            ]
        ]
    },
    {
        "id": "98a0bd0c.674268",
        "type": "function",
        "z": "76c778b95ae3572e",
        "g": "88ca25f284925286",
        "name": "To text",
        "func": "if(msg.topic == \"bedroom_inside\") {\n    context.temp_inside = msg.payload;\n}\nif(msg.topic == \"bedroom_outside\") {\n    context.temp_outside = msg.payload;\n}\nreturn { \n    payload:\n    Number(context.temp_inside).toFixed(2) + \n    \" / \" +\n    Number(context.temp_outside).toFixed(2),\n    topic: \"temps\"\n}\n",
        "outputs": 1,
        "noerr": 0,
        "x": 630,
        "y": 180,
        "wires": [
            [
                "c03904e8.eae328"
            ]
        ]
    },
    {
        "id": "e86fa4f8.ce18e8",
        "type": "link in",
        "z": "76c778b95ae3572e",
        "g": "88ca25f284925286",
        "name": "Small display header temp.",
        "links": [
            "fbf9e851.048aa"
        ],
        "x": 285,
        "y": 240,
        "wires": [
            [
                "cbc9b8e1.8d4d2"
            ]
        ]
    },
    {
        "id": "52af6729c7028a1d",
        "type": "comment",
        "z": "76c778b95ae3572e",
        "g": "88ca25f284925286",
        "name": "Outside temp (API)",
        "info": "",
        "x": 170,
        "y": 240,
        "wires": []
    },
    {
        "id": "98327496.bfed28",
        "type": "ui_slider",
        "z": "76c778b95ae3572e",
        "g": "1697a5bffd1de833",
        "name": "",
        "label": "LED strip",
        "tooltip": "",
        "group": "a8db762f.1aeb8",
        "order": 5,
        "width": 0,
        "height": 0,
        "passthru": true,
        "outs": "all",
        "topic": "",
        "min": 0,
        "max": "2047",
        "step": 1,
        "x": 160,
        "y": 420,
        "wires": [
            [
                "5d56d136.f96c18"
            ]
        ]
    },
    {
        "id": "5d56d136.f96c18",
        "type": "mqtt out",
        "z": "76c778b95ae3572e",
        "g": "1697a5bffd1de833",
        "name": "",
        "topic": "/ledstrip1/value/set",
        "qos": "2",
        "retain": "false",
        "broker": "69f5a3df.5a8b0c",
        "x": 490,
        "y": 420,
        "wires": []
    },
    {
        "id": "dbbe7721.83f838",
        "type": "mqtt out",
        "z": "76c778b95ae3572e",
        "g": "1697a5bffd1de833",
        "name": "",
        "topic": "/ledstrip1/update",
        "qos": "2",
        "retain": "false",
        "broker": "69f5a3df.5a8b0c",
        "x": 490,
        "y": 500,
        "wires": []
    },
    {
        "id": "463deb53.e62e44",
        "type": "inject",
        "z": "76c778b95ae3572e",
        "g": "1697a5bffd1de833",
        "name": "Update",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "true",
        "payloadType": "str",
        "x": 150,
        "y": 500,
        "wires": [
            [
                "dbbe7721.83f838"
            ]
        ]
    },
    {
        "id": "c4d84721.57b068",
        "type": "mqtt in",
        "z": "76c778b95ae3572e",
        "name": "Doorbell",
        "topic": "devices/receiver/doorbell/pushed",
        "qos": "2",
        "datatype": "auto",
        "broker": "69f5a3df.5a8b0c",
        "inputs": 0,
        "x": 160,
        "y": 800,
        "wires": [
            [
                "2c24143f99311a94",
                "5dcd1391e0e9146e"
            ]
        ]
    },
    {
        "id": "a9244488.d9968",
        "type": "e-mail",
        "z": "76c778b95ae3572e",
        "server": "smtp.gmail.com",
        "port": "465",
        "secure": true,
        "tls": false,
        "name": "",
        "dname": "",
        "x": 610,
        "y": 980,
        "wires": []
    },
    {
        "id": "fd7cc3025e3187c6",
        "type": "mqtt in",
        "z": "76c778b95ae3572e",
        "name": "Reset",
        "topic": "devices/receiver/doorbell/reset",
        "qos": "2",
        "datatype": "auto",
        "broker": "69f5a3df.5a8b0c",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 150,
        "y": 860,
        "wires": [
            [
                "40c2382e81ff0848"
            ]
        ]
    },
    {
        "id": "2c24143f99311a94",
        "type": "change",
        "z": "76c778b95ae3572e",
        "name": "Create doorbell email",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Doorbell pressed",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "Ding dong!",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "to",
                "pt": "msg",
                "to": "j.p.cranendonk@gmail.com",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 420,
        "y": 980,
        "wires": [
            [
                "a9244488.d9968"
            ]
        ]
    },
    {
        "id": "14fe4241.fdab76",
        "type": "inject",
        "z": "76c778b95ae3572e",
        "g": "aad3cec1c3ea6bf3",
        "name": "Ring",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "true",
        "payloadType": "str",
        "x": 410,
        "y": 620,
        "wires": [
            [
                "3b9016f1.6d2232"
            ]
        ]
    },
    {
        "id": "3b9016f1.6d2232",
        "type": "mqtt out",
        "z": "76c778b95ae3572e",
        "g": "aad3cec1c3ea6bf3",
        "name": "",
        "topic": "devices/receiver/doorbell/pushed",
        "qos": "2",
        "retain": "false",
        "broker": "69f5a3df.5a8b0c",
        "x": 640,
        "y": 620,
        "wires": []
    },
    {
        "id": "e84a50b41929a9ab",
        "type": "mqtt out",
        "z": "76c778b95ae3572e",
        "g": "aad3cec1c3ea6bf3",
        "name": "",
        "topic": "devices/receiver/doorbell/reset",
        "qos": "2",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "69f5a3df.5a8b0c",
        "x": 630,
        "y": 680,
        "wires": []
    },
    {
        "id": "03eb931f7a6e3479",
        "type": "inject",
        "z": "76c778b95ae3572e",
        "g": "aad3cec1c3ea6bf3",
        "name": "Reset",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "true",
        "payloadType": "str",
        "x": 410,
        "y": 680,
        "wires": [
            [
                "e84a50b41929a9ab"
            ]
        ]
    },
    {
        "id": "e2ba0b59.7d901",
        "type": "PlaySound",
        "z": "76c778b95ae3572e",
        "g": "40f8dec5a1cd082a",
        "name": "",
        "playerOptions": "{\"player\": \"ogg123\"}",
        "audioURI": "/data/ogg/01_-_NeverEnding_Story_-_C64_-_The_NeverEnding_Story.ogg",
        "options": "{}",
        "x": 890,
        "y": 840,
        "wires": [
            []
        ]
    },
    {
        "id": "6c6af118.4fa65",
        "type": "trigger",
        "z": "76c778b95ae3572e",
        "g": "40f8dec5a1cd082a",
        "name": "",
        "op1": "start",
        "op2": "stop",
        "op1type": "str",
        "op2type": "str",
        "duration": "30",
        "extend": true,
        "overrideDelay": false,
        "units": "s",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 1,
        "x": 670,
        "y": 800,
        "wires": [
            [
                "af2a2eca.6e18e8"
            ]
        ]
    },
    {
        "id": "af2a2eca.6e18e8",
        "type": "PlaySound",
        "z": "76c778b95ae3572e",
        "g": "40f8dec5a1cd082a",
        "name": "",
        "playerOptions": "{\"player\": \"mpg123\"}",
        "audioURI": "/data/mp3/Englishman_In_New_York.mp3",
        "options": "{}",
        "x": 890,
        "y": 880,
        "wires": [
            []
        ]
    },
    {
        "id": "bab6bf5de35d28d1",
        "type": "change",
        "z": "76c778b95ae3572e",
        "g": "40f8dec5a1cd082a",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "stop",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 460,
        "y": 880,
        "wires": [
            [
                "af2a2eca.6e18e8"
            ]
        ]
    },
    {
        "id": "8f0dfa83e88b79a9",
        "type": "change",
        "z": "76c778b95ae3572e",
        "g": "40f8dec5a1cd082a",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "reset",
                "pt": "msg",
                "to": "true",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 460,
        "y": 840,
        "wires": [
            [
                "6c6af118.4fa65"
            ]
        ]
    },
    {
        "id": "3d6328bb.df1c9",
        "type": "comment",
        "z": "76c778b95ae3572e",
        "g": "40f8dec5a1cd082a",
        "name": "File source",
        "info": "wget http://vgmpf.com/Wiki/images/1/15/01_-_NeverEnding_Story_-_C64_-_The_NeverEnding_Story.ogg",
        "x": 880,
        "y": 800,
        "wires": []
    },
    {
        "id": "2890bb46.0c3124",
        "type": "mqtt in",
        "z": "76c778b95ae3572e",
        "g": "cee831a055a4415c",
        "name": "SonoffR2-Solar-A",
        "topic": "tele/tasmota_6815F0/SENSOR",
        "qos": "2",
        "datatype": "json",
        "broker": "69f5a3df.5a8b0c",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 160,
        "y": 1100,
        "wires": [
            [
                "6757fa12.66ed94"
            ]
        ]
    },
    {
        "id": "6757fa12.66ed94",
        "type": "function",
        "z": "76c778b95ae3572e",
        "g": "cee831a055a4415c",
        "name": "To influxdb format",
        "func": "time = msg.payload.Time;\ndata = msg.payload.ENERGY;\n\nmsg.measurement = \"solar_power\";\nmsg.payload = {\n  value: data.Power,\n  power: data.Power,\n  apparent_power: data.ApparentPower,\n  reactive_power: data.ReactivePower,\n  voltage: data.Voltage,\n  current: data.Current,\n  factor: data.Factor,\n  total_start_time: data.TotalStartTime,\n  total: data.Total,\n  today: data.Today,\n  yesterday: data.Yesterday,\n  time: new Date(time).getTime()\n};\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 430,
        "y": 1100,
        "wires": [
            [
                "cf463c2c.d0c398"
            ]
        ]
    },
    {
        "id": "99968074.722f88",
        "type": "mqtt in",
        "z": "76c778b95ae3572e",
        "g": "cee831a055a4415c",
        "name": "SonoffR2-Solar-B-Attic",
        "topic": "tele/tasmota_4F6977/SENSOR",
        "qos": "2",
        "datatype": "json",
        "broker": "69f5a3df.5a8b0c",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 180,
        "y": 1160,
        "wires": [
            [
                "2348e05d.e3d64"
            ]
        ]
    },
    {
        "id": "2348e05d.e3d64",
        "type": "function",
        "z": "76c778b95ae3572e",
        "g": "cee831a055a4415c",
        "name": "To influxdb format",
        "func": "time = msg.payload.Time;\ndata = msg.payload.ENERGY;\n\nmsg.measurement = \"solar_power2\";\nmsg.payload = {\n  value: data.Power,\n  power: data.Power,\n  apparent_power: data.ApparentPower,\n  reactive_power: data.ReactivePower,\n  voltage: data.Voltage,\n  current: data.Current,\n  factor: data.Factor,\n  total_start_time: data.TotalStartTime,\n  total: data.Total,\n  today: data.Today,\n  yesterday: data.Yesterday,\n  time: new Date(time).getTime()\n};\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 430,
        "y": 1160,
        "wires": [
            [
                "cf463c2c.d0c398"
            ]
        ]
    },
    {
        "id": "2e363d39.1628da",
        "type": "mqtt in",
        "z": "76c778b95ae3572e",
        "g": "cee831a055a4415c",
        "name": "SonoffR2-Solar-C",
        "topic": "tele/tasmota_4F6981/SENSOR",
        "qos": "2",
        "datatype": "json",
        "broker": "69f5a3df.5a8b0c",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 160,
        "y": 1220,
        "wires": [
            [
                "7b37f4d0.653aa4"
            ]
        ]
    },
    {
        "id": "7b37f4d0.653aa4",
        "type": "function",
        "z": "76c778b95ae3572e",
        "g": "cee831a055a4415c",
        "name": "To influxdb format",
        "func": "time = msg.payload.Time;\ndata = msg.payload.ENERGY;\n\nmsg.measurement = \"solar_power3\";\nmsg.payload = {\n  value: data.Power,\n  power: data.Power,\n  apparent_power: data.ApparentPower,\n  reactive_power: data.ReactivePower,\n  voltage: data.Voltage,\n  current: data.Current,\n  factor: data.Factor,\n  total_start_time: data.TotalStartTime,\n  total: data.Total,\n  today: data.Today,\n  yesterday: data.Yesterday,\n  time: new Date(time).getTime()\n};\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 430,
        "y": 1220,
        "wires": [
            [
                "cf463c2c.d0c398"
            ]
        ]
    },
    {
        "id": "cf463c2c.d0c398",
        "type": "influxdb out",
        "z": "76c778b95ae3572e",
        "g": "cee831a055a4415c",
        "influxdb": "9e729019.2637e",
        "name": "",
        "measurement": "",
        "precision": "",
        "retentionPolicy": "",
        "database": "database",
        "precisionV18FluxV20": "ms",
        "retentionPolicyV18Flux": "",
        "org": "phin-home",
        "bucket": "home_db/autogen",
        "x": 750,
        "y": 1160,
        "wires": []
    },
    {
        "id": "0b3731705511f2d3",
        "type": "debug",
        "z": "76c778b95ae3572e",
        "g": "326cb0c425d84f87",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 990,
        "y": 1380,
        "wires": []
    },
    {
        "id": "33235cb24294f9cc",
        "type": "function",
        "z": "76c778b95ae3572e",
        "g": "326cb0c425d84f87",
        "name": "Parse frame",
        "func": "var buffer = context.get('buffer');\nconst payload = Buffer.from(msg.payload, \"hex\");\n\nif(!buffer) {\n    buffer = payload;\n} else {\n    buffer = Buffer.concat([buffer, payload]);\n}\n\nmsg = [];\n\nwhile(buffer.length >= 64) {\n    if(buffer[0] == 0x02) {\n        // Start byte found\n        if(buffer[1] == 0x41 && buffer[2] == 0x06) {\n            // Request found\n            var length = buffer[3] + 2;\n            if(length <= buffer.length) {\n                if(buffer[4] == 0x02 && buffer[5] == 0x00) {\n                    // Sample found\n                    if(buffer[length - 1] == 0x03) {\n                        var crc = buffer[length - 2];\n     \n                        var csum = 0;\n                        for (var val of buffer.slice(1, length-2)) {\n                            csum ^= val;\n                        }                        \n                        if(crc == csum) {\n                            msg.push({\n                                payload: buffer.slice(6, length-2)\n                            });\n                            buffer = buffer.slice(length);\n                            continue;\n                        }\n                    }\n                }\n            }\n        }\n    }\n    buffer = buffer.slice(1);\n}\n\ncontext.set('buffer', buffer);\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 1380,
        "wires": [
            [
                "2d7af49fbb9d5cb8",
                "2dd30816124478db"
            ]
        ]
    },
    {
        "id": "2d7af49fbb9d5cb8",
        "type": "function",
        "z": "76c778b95ae3572e",
        "g": "326cb0c425d84f87",
        "name": "Parse sample",
        "func": "function getBit(number, bitPosition) {\n  return (number & (1 << bitPosition)) === 0 ? 0 : 1;\n}\n\nfunction sgn(value) {\n    return value > 0x7FFF ? value - 0x10000 : value;\n}\n\nfunction FormatNumber(value, format, min, max, minText, maxText) {\n    if(value < min) {\n        return minText ? minText : min.toString();\n    } else if(value > max) {\n        return maxText ? maxText : max.toString();\n    }\n\n    if(format === \"0\") {\n        return value.toFixed(0)\n    } else if(format === \"0.0\") {\n        return value.toFixed(1)\n    } else if(format === \"0.00\") {\n        return value.toFixed(2)\n    } else {\n        return \"Unexpected format: \" + format;\n    }\n}\n\nfunction NoYesCodeString(value) {\n    switch(value) {\n        case 0:\n            return \"no\";\n        case 1:\n            return \"yes\";\n    }\n}\n\nfunction StatusCodeString(value) {\n    switch(value) {\n        case 0:\n            return \"0:Off-position, no heat demand\";\n        case 1:\n            return \"1:Pre-vent./post-ventilation\";\n        case 2:\n            return \"2:Ignition\";\n        case 3:\n            return \"3:Running for CH\";\n        case 4:\n            return \"4:Running for DHW\";\n        case 5:\n            return \"5:Anti hunting time CH\";\n        case 6:\n            return \"6:Post pump time CH\";\n        case 7:\n            return \"7:Post pump time DHW\";\n        case 8:\n            return \"8:Control stop\";\n        case 9:\n            return \"9:Shut down\";\n        case 10:\n            return \"10:Ventingcycle\";\n        case 11:\n            return \"11:Forced burner low flame\";\n        case 12:\n            return \"12:Forced burner high CH\";\n        case 13:\n            return \"13:Forced burner high DHW\";\n        case 15:\n            return \"15:Manual heat demand\";\n        default:\n            return \"Unknown State (\" + value + \")\";\n    }\n}\n\nfunction LockingCodeString(value) {\n    switch(value) {\n        case 0:\n            return \"E00: Sensor error\";\n        case 1:\n            return \"E01: Flow > Tmax.\";\n        case 2:\n            return \"E02: Return > Flow\";\n        case 3:\n            return \"E03: Earthing fault\";\n        case 4:\n            return \"E04: No flame\";\n        case 5:\n            return \"E05: >5 start failures\";\n        case 6:\n            return \"E06: Flame simulation\";\n        case 7:\n            return \"E07: Water pressure to low\";\n        case 8:\n            return \"E08: Fan error\";\n        case 9:\n            return \"E09: Low hydraulic pressure\";\n        case 10:\n            return \"E10: insufficient deairation\";\n        case 11:\n            return \"E11: Airbox temp. > max.\";\n        case 12:\n            return \"E12: Error checking HRU\";\n        case 13:\n            return \"E13: fuse\";\n        case 43:\n            return \"E43: Parameter bounds\";\n        case 44:\n            return \"E44: Parameter checksum\";\n        case 45:\n            return \"E45: Default parameters\";\n        case 46:\n            return \"E46: dF/dU table error\";\n        default:\n            return \"Unknown locking code (\" + value + \")\";\n    }\n}\n\nfunction BlockingCodeString(value) {\n    switch(value) {\n        case 40:\n            return \"B40: Boiler codes unknown\";\n        case 80:\n            return \"B80: shut down input\";\n        case 81:\n            return \"B81: error checking HRU\";\n        case 82:\n            return \"B82:Solar boiler warm, DHW off\";\n        case 83:\n            return \"B83: Calorifier sensor error\";\n        case 90:\n            return \"B90: temperaure increase\";\n        case 91:\n            return \"B91: deltaT to big\";\n        case 92:\n            return \"B92: insufficient flow\";\n        default:\n            return \"Unknown blocking code (\" + value + \")\";\n    }\n}\n\nfunction OffOnCodeString(value) {\n    switch(value) {\n        case 0:\n            return \"Off\";\n        case 1:\n            return \"On\";\n    }\n}\n\nfunction ClosedOpenCodeString(value) {\n    switch(value) {\n        case 0:\n            return \"Closed\";\n        case 1:\n            return \"Open\";\n    }\n}\n\nfunction OpenClosedCodeString(value) {\n    switch(value) {\n        case 0:\n            return \"Open\";\n        case 1:\n            return \"Closed\";\n    }\n}\n\nvar result = {};\nvar buffer = msg.payload;\n\n// State, Group: 0\nresult[\"State\"] = StatusCodeString(buffer[40]);\n// Lock-out, Group: 0\nresult[\"Lock-out\"] = LockingCodeString(buffer[41]);\n// Shutdown, Group: 0\nresult[\"Shutdown\"] = BlockingCodeString(buffer[42]);\n// Flow temperature, Group: 1\nresult[\"Flow temp. [\u00b0C]\"] = FormatNumber(sgn(buffer[0] + (buffer[1] << 8)) * 0.01, \"0.00\", -25, 150, \"Open\", \"Closed\");\n// Return temperature, Group: 1\nresult[\"Return temp. [\u00b0C]\"] = FormatNumber(sgn(buffer[2] + (buffer[3] << 8)) * 0.01, \"0.00\", -25, 150, \"Open\", \"Closed\");\n// DHW temperature, Group: 1\nresult[\"DHW temp. [\u00b0C]\"] = FormatNumber(sgn(buffer[4] + (buffer[5] << 8)) * 0.01, \"0.00\", -25, 150, \"Open\", \"Closed\");\n// Internal setpoint, Group: 1\nresult[\"Internal setpoint [\u00b0C]\"] = FormatNumber(sgn(buffer[27] + (buffer[28] << 8)) * 0.01, \"0.00\", 0, 100, \"Open\", \"Closed\");\n// Setpoint for CH mode, Group: 1\nresult[\"CH Setpoint [\u00b0C]\"] = FormatNumber(sgn(buffer[16] + (buffer[17] << 8)) * 0.01, \"0.00\", 0, 100, \"Open\", \"Closed\");\n// Flow temp setpoint DHW mode, Group: 1\nresult[\"DHW Setpoint [\u00b0C]\"] = FormatNumber(sgn(buffer[18] + (buffer[19] << 8)) * 0.01, \"0.00\", 0, 100, \"Open\", \"Closed\");\n// Room temperature OpenTherm controller, Group: 1\nresult[\"Room temp. [\u00b0C]\"] = FormatNumber(sgn(buffer[14] + (buffer[15] << 8)) * 0.01, \"0.00\", -25, 150, \"Open\", \"Closed\");\n// Room temp setpointOpenTherm controller, Group: 1\nresult[\"Room temp setpoint [\u00b0C]\"] = FormatNumber(sgn(buffer[20] + (buffer[21] << 8)) * 0.01, \"0.00\", 0, 100, \"Open\", \"Closed\");\n// Temp. boiler control, Group: 1\nresult[\"Boiler Control temp. [\u00b0C]\"] = FormatNumber(sgn(buffer[12] + (buffer[13] << 8)) * 0.01, \"0.00\", -25, 150, \"Open\", \"Closed\");\n// Setpoint fanspeed, Group: 2\nresult[\"Fanspeed setpoint [Rpm]\"] = FormatNumber(buffer[22] + (buffer[23] << 8), \"0\", 0, 7000);\n// Fan speed, Group: 2\nresult[\"Fan speed [Rpm]\"] = FormatNumber(buffer[24] + (buffer[25] << 8), \"0\", 0, 7000);\n// Ionisation current, Group: 2\nresult[\"Ionisation current [uA]\"] = FormatNumber(buffer[26] * 0.1, \"0.0\", 0, 10);\n// Pomp speed, Group: 2\nresult[\"Pump [%]\"] = FormatNumber(buffer[30], \"0\", 0, 100);\n// Output, Group: 2\nresult[\"Available power [%]\"] = FormatNumber(buffer[29], \"0\", 0, 100);\n// Actual power from boiler, Group: 2\nresult[\"Actual power [%]\"] = FormatNumber(buffer[33], \"0\", 0, 100);\n// From controller desired max power, Group: 2\nresult[\"Required output [%]\"] = FormatNumber(buffer[32], \"0\", 0, 100);\n// Gas valve, Group: 3\nresult[\"Gas valve\"] = ClosedOpenCodeString(getBit(buffer[38], 0) === 0 ? 1 : 0);\n// Ignition, Group: 3\nresult[\"Ignition\"] = OffOnCodeString(getBit(buffer[38], 2));\n// Ionisation, Group: 3\nresult[\"Ionisation\"] = NoYesCodeString(getBit(buffer[37], 2));\n// Three way valve, Group: 3\nresult[\"Three way valve\"] = OffOnCodeString(getBit(buffer[38], 3));\n// Pump, Group: 3\nresult[\"Pump\"] = OffOnCodeString(getBit(buffer[39], 0));\n// Heat demand from modulating controller, Group: 3\nresult[\"Mod. heat demand\"] = NoYesCodeString(getBit(buffer[36], 1));\n// Heatdemand from on/off controller, Group: 3\nresult[\"On/off heat demand\"] = NoYesCodeString(getBit(buffer[36], 2));\n// DHW eco, boiler not kept warm, Group: 3\nresult[\"DHW eco\"] = NoYesCodeString(getBit(buffer[36], 4) === 0 ? 1 : 0);\n// DHW heat demand, Group: 3\nresult[\"DHW heat demand\"] = NoYesCodeString(getBit(buffer[36], 7));\n// Flow switch for detecting DHW, Group: 3\nresult[\"Flow switch\"] = OffOnCodeString(getBit(buffer[37], 3));\n// shut down input or HRU test, Group: 3\nresult[\"Shut down input\"] = OpenClosedCodeString(getBit(buffer[37], 0));\n// Modulating controller connected, Group: 3\nresult[\"Mod. controller\"] = NoYesCodeString(getBit(buffer[36], 0));\n\nreturn {\n    payload: result\n};\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 780,
        "y": 1380,
        "wires": [
            [
                "0b3731705511f2d3"
            ]
        ]
    },
    {
        "id": "6fad1f83889df6a8",
        "type": "inject",
        "z": "76c778b95ae3572e",
        "g": "326cb0c425d84f87",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "1",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 180,
        "y": 1540,
        "wires": [
            [
                "3bc1ecc2b79435ae"
            ]
        ]
    },
    {
        "id": "3bc1ecc2b79435ae",
        "type": "function",
        "z": "76c778b95ae3572e",
        "g": "326cb0c425d84f87",
        "name": "Remeha Request",
        "func": "var request = 0x0552;\nvar reply   = 0x0641;\n\nvar identify   = 0x010B;\nvar sample     = 0x0200;\nvar eepromRead = 0x1000;\n\nvar type = request;\nvar func = sample;\n\nvar buffer = Buffer.from(\n    [0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03]\n);\n\nbuffer[1] = (type >> 0) & 0xff;\nbuffer[2] = (type >> 8) & 0xff;\n\nbuffer[4] = (func >> 8) & 0xff;\nbuffer[5] = (func >> 0) & 0xff;\n\nbuffer[3] = buffer.length - 2;\n\nvar csum = 0;\nfor (var val of buffer.slice(1, buffer.length - 2)) {\n    csum ^= val;\n}                        \nbuffer[buffer.length-2] = csum;\n\n\nmsg.payload = buffer.toString('hex');\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 1540,
        "wires": [
            [
                "7782fcdd5ce50be7"
            ]
        ]
    },
    {
        "id": "2dd30816124478db",
        "type": "function",
        "z": "76c778b95ae3572e",
        "g": "326cb0c425d84f87",
        "name": "Parse sample",
        "func": "function getBit(number, bitPosition) {\n  return (number & (1 << bitPosition)) === 0 ? 0 : 1;\n}\n\nfunction sgn(value) {\n    return value > 0x7FFF ? value - 0x10000 : value;\n}\n\nvar result = {};\nvar buffer = msg.payload;\n\nreturn {\n    measurement: \"central_heating_diag\",\n    payload: {\n        state: buffer[40],\n        lock_out: buffer[41],\n        shutdown: buffer[42],\n        flow_temp: (sgn(buffer[0] + (buffer[1] << 8)) * (1000 * 0.01)) / 1000,\n        return_temp: (sgn(buffer[2] + (buffer[3] << 8)) * (1000 * 0.01)) / 1000,\n        dhw_temp: (sgn(buffer[4] + (buffer[5] << 8)) * (1000 * 0.01)) / 1000,\n        internal_setpoint: (sgn(buffer[27] + (buffer[28] << 8)) * (1000 * 0.01)) / 1000,\n        ch_setpoint: (sgn(buffer[16] + (buffer[17] << 8)) * (1000 * 0.01)) / 1000,\n        dhw_setpoint: (sgn(buffer[18] + (buffer[19] << 8)) * (1000 * 0.01)) / 1000,\n        room_temp: (sgn(buffer[14] + (buffer[15] << 8)) * (1000 * 0.01)) / 1000,\n        room_temp_setpoint: (sgn(buffer[20] + (buffer[21] << 8)) * (1000 * 0.01)) / 1000,\n        boiler_control_temp: (sgn(buffer[12] + (buffer[13] << 8)) * (1000 * 0.01)) / 1000,\n        fanspeed_setpoint: buffer[22] + (buffer[23] << 8),\n        fan_speed: buffer[24] + (buffer[25] << 8),\n        ionisation_current: (buffer[26] * (1000 * 0.1)) / 1000,\n        pump_speed: buffer[30],\n        available_power: buffer[29],\n        actual_power: buffer[33],\n        required_output: buffer[32],\n        gas_valve: getBit(buffer[38], 0) === 0 ? 1 : 0,\n        ignition: getBit(buffer[38], 2),\n        ionisation: getBit(buffer[37], 2),\n        three_way_valve: getBit(buffer[38], 3),\n        pump: getBit(buffer[39], 0),\n        mod_heat_demand: getBit(buffer[36], 1),\n        on_off_heat_demand: getBit(buffer[36], 2),\n        dhw_eco: getBit(buffer[36], 4) === 0 ? 1 : 0,\n        dhw_heat_demand: getBit(buffer[36], 7),\n        flow_switch: getBit(buffer[37], 3),\n        shut_down_input: getBit(buffer[37], 0),\n        mod_controller: getBit(buffer[36], 0),\n        time: new Date().getTime()\n    }\n};\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 780,
        "y": 1460,
        "wires": [
            [
                "f467169fa32ae12e"
            ]
        ]
    },
    {
        "id": "f467169fa32ae12e",
        "type": "influxdb out",
        "z": "76c778b95ae3572e",
        "g": "326cb0c425d84f87",
        "influxdb": "9e729019.2637e",
        "name": "",
        "measurement": "",
        "precision": "",
        "retentionPolicy": "",
        "database": "database",
        "precisionV18FluxV20": "ms",
        "retentionPolicyV18Flux": "",
        "org": "phin-home",
        "bucket": "home_db/autogen",
        "x": 1010,
        "y": 1460,
        "wires": []
    },
    {
        "id": "7782fcdd5ce50be7",
        "type": "mqtt out",
        "z": "76c778b95ae3572e",
        "g": "326cb0c425d84f87",
        "name": "CH serial out",
        "topic": "cmnd/tasmota_9BAD48/SSerialSend5",
        "qos": "2",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "69f5a3df.5a8b0c",
        "x": 590,
        "y": 1540,
        "wires": []
    },
    {
        "id": "dc1cb9593c2db61c",
        "type": "mqtt in",
        "z": "76c778b95ae3572e",
        "g": "326cb0c425d84f87",
        "name": "CH serial in",
        "topic": "tele/tasmota_9BAD48/RESULT",
        "qos": "2",
        "datatype": "utf8",
        "broker": "69f5a3df.5a8b0c",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 170,
        "y": 1340,
        "wires": [
            [
                "62f946eab6ef55b4"
            ]
        ]
    },
    {
        "id": "62f946eab6ef55b4",
        "type": "json",
        "z": "76c778b95ae3572e",
        "g": "326cb0c425d84f87",
        "name": "",
        "property": "payload",
        "action": "obj",
        "pretty": false,
        "x": 330,
        "y": 1340,
        "wires": [
            [
                "4d2cce54441b0f6a"
            ]
        ]
    },
    {
        "id": "4d2cce54441b0f6a",
        "type": "change",
        "z": "76c778b95ae3572e",
        "g": "326cb0c425d84f87",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "msg.payload.SSerialReceived",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 360,
        "y": 1380,
        "wires": [
            [
                "33235cb24294f9cc"
            ]
        ]
    },
    {
        "id": "d2baeb97d466f9c2",
        "type": "mqtt in",
        "z": "76c778b95ae3572e",
        "g": "245c6352e67871c3",
        "name": "Humidity-A",
        "topic": "tele/tasmota_521590/SENSOR",
        "qos": "2",
        "datatype": "json",
        "broker": "69f5a3df.5a8b0c",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 140,
        "y": 1660,
        "wires": [
            [
                "291797345c53722b"
            ]
        ]
    },
    {
        "id": "291797345c53722b",
        "type": "function",
        "z": "76c778b95ae3572e",
        "g": "245c6352e67871c3",
        "name": "To influxdb format",
        "func": "time = msg.payload.Time;\ndata = msg.payload.SHT3X;\n\nmsg.measurement = \"humidity1\";\nmsg.payload = {\n  temperature: data.Temperature,\n  humidity: data.Humidity,\n  dew_point: data.DewPoint,\n  time: new Date(time).getTime()\n};\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 470,
        "y": 1660,
        "wires": [
            [
                "ec4f6398910cefaa"
            ]
        ]
    },
    {
        "id": "ec4f6398910cefaa",
        "type": "influxdb out",
        "z": "76c778b95ae3572e",
        "g": "245c6352e67871c3",
        "influxdb": "9e729019.2637e",
        "name": "",
        "measurement": "",
        "precision": "",
        "retentionPolicy": "",
        "database": "database",
        "precisionV18FluxV20": "ms",
        "retentionPolicyV18Flux": "",
        "org": "phin-home",
        "bucket": "home_db/autogen",
        "x": 770,
        "y": 1720,
        "wires": []
    },
    {
        "id": "411f279796897c37",
        "type": "mqtt in",
        "z": "76c778b95ae3572e",
        "g": "245c6352e67871c3",
        "name": "Humidity-B",
        "topic": "tele/tasmota_95F224/SENSOR",
        "qos": "2",
        "datatype": "json",
        "broker": "69f5a3df.5a8b0c",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 140,
        "y": 1720,
        "wires": [
            [
                "65fd0d1e9908923b"
            ]
        ]
    },
    {
        "id": "65fd0d1e9908923b",
        "type": "function",
        "z": "76c778b95ae3572e",
        "g": "245c6352e67871c3",
        "name": "To influxdb format",
        "func": "time = msg.payload.Time;\ndata = msg.payload.SHT3X;\n\nmsg.measurement = \"humidity2\";\nmsg.payload = {\n  temperature: data.Temperature,\n  humidity: data.Humidity,\n  dew_point: data.DewPoint,\n  time: new Date(time).getTime()\n};\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 470,
        "y": 1720,
        "wires": [
            [
                "ec4f6398910cefaa"
            ]
        ]
    },
    {
        "id": "997545a4b06e810a",
        "type": "mqtt in",
        "z": "76c778b95ae3572e",
        "g": "245c6352e67871c3",
        "name": "Humidity-C",
        "topic": "tele/tasmota_0C7410/SENSOR",
        "qos": "2",
        "datatype": "json",
        "broker": "69f5a3df.5a8b0c",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 140,
        "y": 1780,
        "wires": [
            [
                "bf6daca12632d79c"
            ]
        ]
    },
    {
        "id": "bf6daca12632d79c",
        "type": "function",
        "z": "76c778b95ae3572e",
        "g": "245c6352e67871c3",
        "name": "To influxdb format",
        "func": "time = msg.payload.Time;\ndata = msg.payload.SHT3X;\n\nmsg.measurement = \"humidity3\";\nmsg.payload = {\n  temperature: data.Temperature,\n  humidity: data.Humidity,\n  dew_point: data.DewPoint,\n  time: new Date(time).getTime()\n};\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 470,
        "y": 1780,
        "wires": [
            [
                "ec4f6398910cefaa"
            ]
        ]
    },
    {
        "id": "540ac6a89690e985",
        "type": "mqtt in",
        "z": "76c778b95ae3572e",
        "g": "245c6352e67871c3",
        "name": "Temp-1",
        "topic": "tele/tasmota_5162C4/SENSOR",
        "qos": "2",
        "datatype": "json",
        "broker": "69f5a3df.5a8b0c",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 130,
        "y": 1860,
        "wires": [
            [
                "e5385a494ece704a"
            ]
        ]
    },
    {
        "id": "e5385a494ece704a",
        "type": "function",
        "z": "76c778b95ae3572e",
        "g": "245c6352e67871c3",
        "name": "To influxdb format",
        "func": "const time = msg.payload.Time;\nconst data = msg.payload.DS18B20;\n\nmsg.measurement = \"temp1\";\nmsg.payload = {\n  temperature: data.Temperature,\n  time: new Date(time).getTime()\n};\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 470,
        "y": 1860,
        "wires": [
            [
                "ec4f6398910cefaa"
            ]
        ]
    },
    {
        "id": "96da407e.693bd",
        "type": "ui_slider",
        "z": "9122054e.29969",
        "name": "",
        "label": "NeoPixels brightness",
        "group": "c8a54de6.369ff",
        "order": 3,
        "width": "",
        "height": "",
        "passthru": true,
        "topic": "control",
        "min": 0,
        "max": "1000",
        "step": "",
        "x": 580,
        "y": 680,
        "wires": [
            [
                "916ff53a.0cf9",
                "6b6427a5.2800c8"
            ]
        ]
    },
    {
        "id": "c7b94c19.990b2",
        "type": "mqtt out",
        "z": "9122054e.29969",
        "name": "Lightshow brightness set",
        "topic": "control/lightshow/brightness/set",
        "qos": "2",
        "retain": "false",
        "broker": "69f5a3df.5a8b0c",
        "x": 990,
        "y": 680,
        "wires": []
    },
    {
        "id": "76d31ffb.217c88",
        "type": "mqtt in",
        "z": "9122054e.29969",
        "name": "Lightshow brightness",
        "topic": "control/lightshow/brightness",
        "qos": "2",
        "datatype": "auto",
        "broker": "69f5a3df.5a8b0c",
        "inputs": 0,
        "x": 120,
        "y": 680,
        "wires": [
            [
                "abc768.a7798098",
                "84ccb865.9d687",
                "6b6427a5.2800c8"
            ]
        ]
    },
    {
        "id": "abc768.a7798098",
        "type": "ui_text",
        "z": "9122054e.29969",
        "group": "c8a54de6.369ff",
        "order": 4,
        "width": "",
        "height": "",
        "name": "",
        "label": "NeoPixels brightness",
        "format": "{{msg.payload}}",
        "layout": "",
        "x": 580,
        "y": 740,
        "wires": []
    },
    {
        "id": "916ff53a.0cf9",
        "type": "rbe",
        "z": "9122054e.29969",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "x": 790,
        "y": 680,
        "wires": [
            [
                "c7b94c19.990b2"
            ]
        ]
    },
    {
        "id": "bcf8dcb6.286228",
        "type": "mqtt in",
        "z": "9122054e.29969",
        "name": "Switches",
        "topic": "devices/receiver/+/+",
        "qos": "2",
        "datatype": "auto",
        "broker": "69f5a3df.5a8b0c",
        "inputs": 0,
        "x": 80,
        "y": 320,
        "wires": [
            [
                "cfdf0ee.92e14f"
            ]
        ]
    },
    {
        "id": "cfdf0ee.92e14f",
        "type": "switch",
        "z": "9122054e.29969",
        "name": "Topic switch",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "devices/receiver/sw1/pulse_on",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "devices/receiver/sw1/pulse_off",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "devices/receiver/sw2/pulse_on",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "devices/receiver/sw2/pulse_off",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "devices/receiver/sw3/pulse_on",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "devices/receiver/sw3/pulse_off",
                "vt": "str"
            }
        ],
        "checkall": "false",
        "outputs": 6,
        "x": 290,
        "y": 320,
        "wires": [
            [],
            [],
            [
                "ed72dcb2.f574e8"
            ],
            [
                "5856ee01.86b508"
            ],
            [
                "ea531c98.d9c8"
            ],
            [
                "e316f32b.1c3e98"
            ]
        ]
    },
    {
        "id": "ed72dcb2.f574e8",
        "type": "delay",
        "z": "9122054e.29969",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "2",
        "nbRateUnits": "",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 510,
        "y": 220,
        "wires": [
            [
                "7ab5ba66.a60f8c"
            ]
        ]
    },
    {
        "id": "5856ee01.86b508",
        "type": "delay",
        "z": "9122054e.29969",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "2",
        "nbRateUnits": "",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 510,
        "y": 280,
        "wires": [
            [
                "7ab5ba66.a60f8c"
            ]
        ]
    },
    {
        "id": "d06c9c5d.fe3d7",
        "type": "mqtt in",
        "z": "9122054e.29969",
        "name": "Modes",
        "topic": "control/lightshow/mode/available",
        "qos": "2",
        "broker": "69f5a3df.5a8b0c",
        "inputs": 0,
        "x": 590,
        "y": 160,
        "wires": [
            [
                "7ab5ba66.a60f8c"
            ]
        ]
    },
    {
        "id": "7ab5ba66.a60f8c",
        "type": "function",
        "z": "9122054e.29969",
        "name": "Mode selector",
        "func": "if(msg.topic == \"control/lightshow/mode/available\") {\n    context.lightshow_modes = msg.payload;\n} else {\n    if(!context.lightshow_modes) {\n        return;\n    }\n\n    if(!context.lightshow_mode) {\n        context.lightshow_mode = 0;\n    }\n\n    var modes = context.lightshow_modes.split(\",\"); \n\n    if(msg.topic == \"devices/receiver/sw2/pulse_on\") {\n        context.lightshow_mode--;\n    } else if(msg.topic == \"devices/receiver/sw2/pulse_off\") {\n        context.lightshow_mode++;\n    }\n    \n    if(context.lightshow_mode >= modes.length) {\n        context.lightshow_mode = modes.length - 1;\n    }\n    if(context.lightshow_mode < 0) {\n        context.lightshow_mode = 0;\n    }\n\n    return { \n        payload: modes[context.lightshow_mode],\n        topic: \"mode\" \n    }\n\n}\n",
        "outputs": 1,
        "noerr": 0,
        "x": 780,
        "y": 260,
        "wires": [
            [
                "4c4ca351.b7673c"
            ]
        ]
    },
    {
        "id": "4c4ca351.b7673c",
        "type": "mqtt out",
        "z": "9122054e.29969",
        "name": "Mode set",
        "topic": "control/lightshow/mode/set",
        "qos": "2",
        "retain": "false",
        "broker": "69f5a3df.5a8b0c",
        "x": 1000,
        "y": 260,
        "wires": []
    },
    {
        "id": "84ccb865.9d687",
        "type": "function",
        "z": "9122054e.29969",
        "name": "Brightness",
        "func": "if(msg.topic == \"control/lightshow/brightness\") {\n    context.lightshow_brightness = Number(msg.payload);\n} else {\n    if(!context.lightshow_brightness) {\n        context.lightshow_brightness = 0;\n    }\n\n    if(msg.topic == \"devices/receiver/sw3/pulse_on\") {\n        context.lightshow_brightness -= 50;\n    } else if(msg.topic == \"devices/receiver/sw3/pulse_off\") {\n        context.lightshow_brightness += 50;\n    }\n    \n    if(context.lightshow_brightness > 1000) {\n        context.lightshow_brightness = 1000;\n    }\n    if(context.lightshow_brightness < 0) {\n        context.lightshow_brightness = 0;\n    }\n\n    return { \n        payload: context.lightshow_brightness,\n        topic: \"brightness\" \n    }\n\n}\n",
        "outputs": 1,
        "noerr": 0,
        "x": 590,
        "y": 480,
        "wires": [
            [
                "c7b94c19.990b2"
            ]
        ]
    },
    {
        "id": "e316f32b.1c3e98",
        "type": "delay",
        "z": "9122054e.29969",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "4",
        "nbRateUnits": "",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 510,
        "y": 400,
        "wires": [
            [
                "84ccb865.9d687"
            ]
        ]
    },
    {
        "id": "ea531c98.d9c8",
        "type": "delay",
        "z": "9122054e.29969",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "4",
        "nbRateUnits": "",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 510,
        "y": 360,
        "wires": [
            [
                "84ccb865.9d687"
            ]
        ]
    },
    {
        "id": "58ce017f.25cf98",
        "type": "function",
        "z": "9122054e.29969",
        "name": "DIV/1000",
        "func": "msg.payload = msg.payload / 1000;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 300,
        "y": 900,
        "wires": [
            [
                "ca477a98.62fb98"
            ]
        ]
    },
    {
        "id": "8cdd6b92.5f4b9",
        "type": "mqtt in",
        "z": "9122054e.29969",
        "name": "Lightshow period",
        "topic": "control/lightshow/period",
        "qos": "2",
        "datatype": "auto",
        "broker": "69f5a3df.5a8b0c",
        "inputs": 0,
        "x": 100,
        "y": 900,
        "wires": [
            [
                "58ce017f.25cf98"
            ]
        ]
    },
    {
        "id": "a4bb9eac.deacf",
        "type": "ui_slider",
        "z": "9122054e.29969",
        "name": "",
        "label": "Neopixels period",
        "group": "c8a54de6.369ff",
        "order": 5,
        "width": "",
        "height": "",
        "passthru": true,
        "topic": "control",
        "min": "4",
        "max": "1000",
        "step": "",
        "x": 590,
        "y": 900,
        "wires": [
            [
                "d419c385.5ddb88",
                "d56a4401.f3bf68",
                "ca477a98.62fb98"
            ]
        ]
    },
    {
        "id": "d419c385.5ddb88",
        "type": "rbe",
        "z": "9122054e.29969",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "x": 530,
        "y": 980,
        "wires": [
            [
                "c21b7cad.94af88"
            ]
        ]
    },
    {
        "id": "d56a4401.f3bf68",
        "type": "ui_text",
        "z": "9122054e.29969",
        "group": "c8a54de6.369ff",
        "order": 6,
        "width": "",
        "height": "",
        "name": "",
        "label": "NeoPixels period",
        "format": "{{msg.payload}} ms",
        "layout": "",
        "x": 910,
        "y": 900,
        "wires": []
    },
    {
        "id": "c21b7cad.94af88",
        "type": "function",
        "z": "9122054e.29969",
        "name": "MUL*1000",
        "func": "msg.payload = msg.payload * 1000;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 690,
        "y": 980,
        "wires": [
            [
                "f4047c92.152c1"
            ]
        ]
    },
    {
        "id": "f4047c92.152c1",
        "type": "mqtt out",
        "z": "9122054e.29969",
        "name": "Lightshow period set",
        "topic": "control/lightshow/period/set",
        "qos": "2",
        "retain": "false",
        "broker": "69f5a3df.5a8b0c",
        "x": 900,
        "y": 980,
        "wires": []
    },
    {
        "id": "cf41f475.a86388",
        "type": "mqtt in",
        "z": "9122054e.29969",
        "name": "Switch 1",
        "topic": "devices/receiver/sw1/on",
        "qos": "2",
        "broker": "69f5a3df.5a8b0c",
        "inputs": 0,
        "x": 100,
        "y": 1180,
        "wires": [
            [
                "6952c8aa.dc7d6"
            ]
        ]
    },
    {
        "id": "6952c8aa.dc7d6",
        "type": "mqtt out",
        "z": "9122054e.29969",
        "name": "NeoPixels on set",
        "topic": "devices/0003376b/light/on/set",
        "qos": "2",
        "retain": "false",
        "broker": "69f5a3df.5a8b0c",
        "x": 970,
        "y": 1180,
        "wires": []
    },
    {
        "id": "e9e43a0f.2b041",
        "type": "mqtt in",
        "z": "9122054e.29969",
        "name": "NeoPixels uptime",
        "topic": "devices/0003376b/$uptime",
        "qos": "2",
        "datatype": "auto",
        "broker": "69f5a3df.5a8b0c",
        "inputs": 0,
        "x": 100,
        "y": 80,
        "wires": [
            [
                "aec9db8e.b966a"
            ]
        ]
    },
    {
        "id": "aec9db8e.b966a",
        "type": "function",
        "z": "9122054e.29969",
        "name": "Format seconds",
        "func": "var s = msg.payload;\nvar m = Math.floor(s / 60);\nvar s = s % 60;\nvar h = Math.floor(m / 60);\nvar  m = m % 60;\nvar  d = Math.floor(h / 24);\nvar  h = h % 24;\nmsg.payload = d +\"d \";\nmsg.payload += h + \"h \";\nmsg.payload += m + \"m \";\nmsg.payload += s + \"s\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 360,
        "y": 80,
        "wires": [
            [
                "bdc2750a.19d32"
            ]
        ]
    },
    {
        "id": "bdc2750a.19d32",
        "type": "ui_text",
        "z": "9122054e.29969",
        "group": "c8a54de6.369ff",
        "order": 8,
        "width": "",
        "height": "",
        "name": "",
        "label": "NeoPixels uptime",
        "format": "{{msg.payload}}",
        "layout": "",
        "x": 630,
        "y": 80,
        "wires": []
    },
    {
        "id": "ca16c2ed.464bd8",
        "type": "mqtt in",
        "z": "9122054e.29969",
        "name": "NeoPixels onine",
        "topic": "devices/0003376b/$online",
        "qos": "2",
        "datatype": "auto",
        "broker": "69f5a3df.5a8b0c",
        "inputs": 0,
        "x": 100,
        "y": 40,
        "wires": [
            [
                "8aae44ac.f2ab7"
            ]
        ]
    },
    {
        "id": "8aae44ac.f2ab7",
        "type": "ui_text",
        "z": "9122054e.29969",
        "group": "c8a54de6.369ff",
        "order": 2,
        "width": "",
        "height": "",
        "name": "",
        "label": "NeoPixels online",
        "format": "{{msg.payload}}",
        "layout": "",
        "x": 640,
        "y": 40,
        "wires": []
    },
    {
        "id": "2c680e99.70e122",
        "type": "ui_switch",
        "z": "9122054e.29969",
        "name": "",
        "label": "NeoPixels On",
        "group": "c8a54de6.369ff",
        "order": 1,
        "width": "",
        "height": "",
        "passthru": true,
        "decouple": "false",
        "topic": "control",
        "onvalue": "true",
        "onvalueType": "str",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "str",
        "officon": "",
        "offcolor": "",
        "x": 540,
        "y": 1340,
        "wires": [
            [
                "28f1fc7b.ad001c",
                "267712fa.70c8ee"
            ]
        ]
    },
    {
        "id": "3657984a.46d8b8",
        "type": "mqtt in",
        "z": "9122054e.29969",
        "name": "NeoPixels state",
        "topic": "devices/0003376b/light/on",
        "qos": "2",
        "datatype": "auto",
        "broker": "69f5a3df.5a8b0c",
        "inputs": 0,
        "x": 120,
        "y": 1340,
        "wires": [
            [
                "267712fa.70c8ee"
            ]
        ]
    },
    {
        "id": "8ff7841b.88307",
        "type": "mqtt out",
        "z": "9122054e.29969",
        "name": "NeoPixels on set",
        "topic": "devices/0003376b/light/on/set",
        "qos": "2",
        "retain": "false",
        "broker": "69f5a3df.5a8b0c",
        "x": 970,
        "y": 1340,
        "wires": []
    },
    {
        "id": "28f1fc7b.ad001c",
        "type": "rbe",
        "z": "9122054e.29969",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "x": 750,
        "y": 1340,
        "wires": [
            [
                "8ff7841b.88307"
            ]
        ]
    },
    {
        "id": "267712fa.70c8ee",
        "type": "subflow:f7c3f5b1.15af3",
        "z": "9122054e.29969",
        "name": "",
        "x": 540,
        "y": 1260,
        "wires": [
            [
                "2c680e99.70e122"
            ]
        ]
    },
    {
        "id": "6b6427a5.2800c8",
        "type": "subflow:f7c3f5b1.15af3",
        "z": "9122054e.29969",
        "name": "",
        "x": 580,
        "y": 600,
        "wires": [
            [
                "96da407e.693bd"
            ]
        ]
    },
    {
        "id": "ca477a98.62fb98",
        "type": "subflow:f7c3f5b1.15af3",
        "z": "9122054e.29969",
        "name": "",
        "x": 580,
        "y": 840,
        "wires": [
            [
                "a4bb9eac.deacf"
            ]
        ]
    },
    {
        "id": "4f604ef9.95e5f",
        "type": "ui_text",
        "z": "9122054e.29969",
        "group": "c8a54de6.369ff",
        "order": 7,
        "width": "",
        "height": "",
        "name": "",
        "label": "NeoPixels mode",
        "format": "{{msg.payload}}",
        "layout": "",
        "x": 980,
        "y": 380,
        "wires": []
    },
    {
        "id": "a8a2f458.a6a0a8",
        "type": "mqtt in",
        "z": "9122054e.29969",
        "name": "",
        "topic": "control/lightshow/mode",
        "qos": "2",
        "broker": "69f5a3df.5a8b0c",
        "inputs": 0,
        "x": 740,
        "y": 380,
        "wires": [
            [
                "4f604ef9.95e5f"
            ]
        ]
    },
    {
        "id": "604cef75.b38078",
        "type": "ui_text",
        "z": "459a3a0f.cadb4c",
        "group": "ddd0fc4c.8a5e8",
        "order": 1,
        "width": "",
        "height": "",
        "name": "",
        "label": "Inside temperature",
        "format": "{{msg.payload}} &deg;",
        "layout": "",
        "x": 1030,
        "y": 660,
        "wires": []
    },
    {
        "id": "3cbd8bbc.be75a4",
        "type": "ui_text",
        "z": "459a3a0f.cadb4c",
        "group": "ddd0fc4c.8a5e8",
        "order": 2,
        "width": "",
        "height": "",
        "name": "",
        "label": "Outside temperature",
        "format": "{{msg.payload}} &deg;",
        "layout": "",
        "x": 1020,
        "y": 720,
        "wires": []
    },
    {
        "id": "a40ae4f5.d4a528",
        "type": "ui_text",
        "z": "459a3a0f.cadb4c",
        "group": "ddd0fc4c.8a5e8",
        "order": 4,
        "width": "",
        "height": "",
        "name": "",
        "label": "Window",
        "format": "{{msg.payload}}",
        "layout": "",
        "x": 1060,
        "y": 280,
        "wires": []
    },
    {
        "id": "83ac489b.6336",
        "type": "mqtt in",
        "z": "459a3a0f.cadb4c",
        "name": "Bedroom window state",
        "topic": "control/window/status",
        "qos": "2",
        "datatype": "auto",
        "broker": "69f5a3df.5a8b0c",
        "inputs": 0,
        "x": 120,
        "y": 300,
        "wires": [
            [
                "a40ae4f5.d4a528"
            ]
        ]
    },
    {
        "id": "5917594a.b2888",
        "type": "function",
        "z": "459a3a0f.cadb4c",
        "name": "Get temp diff",
        "func": "if(msg.topic == \"bedroom_inside\") {\n    context.temp_inside = msg.payload;\n}\nif(msg.topic == \"bedroom_outside\") {\n    context.temp_outside = msg.payload;\n}\nreturn { \n    payload: context.temp_outside - context.temp_inside,\n    topic: \"bedroom_diff\" \n}\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "x": 410,
        "y": 460,
        "wires": [
            [
                "f6b45c8d.dbadf"
            ]
        ]
    },
    {
        "id": "f6b45c8d.dbadf",
        "type": "ui_text",
        "z": "459a3a0f.cadb4c",
        "group": "ddd0fc4c.8a5e8",
        "order": 3,
        "width": "",
        "height": "",
        "name": "",
        "label": "Temperature difference",
        "format": "{{msg.payload}} &deg;",
        "layout": "",
        "x": 1010,
        "y": 400,
        "wires": []
    },
    {
        "id": "f97ef03a.7bc198",
        "type": "function",
        "z": "459a3a0f.cadb4c",
        "name": "Rename topic",
        "func": "if(msg.topic == \"011581E788FF\") {\n    msg.topic = \"bedroom_inside\";\n}\nif(msg.topic == \"devices/0085b208/f6011581e788ff28/temperature\") {\n    msg.topic = \"bedroom_inside\";\n}\nif(msg.topic == \"0119363CACBD\") {\n    msg.topic = \"bedroom_outside\";\n}\nif(msg.topic == \"devices/00d39493/0f041654733cff28/temperature\") {\n    msg.topic = \"new1\";\n}\nif(msg.topic == \"devices/00d39493/f6041653f20bff28/temperature\") {\n    msg.topic = \"new2\";\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 120,
        "y": 560,
        "wires": [
            [
                "9fcacdd2.81043",
                "5917594a.b2888",
                "3763749a.0336c4"
            ]
        ]
    },
    {
        "id": "c7709fe7.534e8",
        "type": "mqtt in",
        "z": "459a3a0f.cadb4c",
        "name": "Temps",
        "topic": "devices/+/+/temperature",
        "qos": "2",
        "datatype": "auto",
        "broker": "69f5a3df.5a8b0c",
        "inputs": 0,
        "x": 70,
        "y": 460,
        "wires": [
            [
                "f97ef03a.7bc198"
            ]
        ]
    },
    {
        "id": "9fcacdd2.81043",
        "type": "switch",
        "z": "459a3a0f.cadb4c",
        "name": "Topic switch",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "bedroom_inside",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "bedroom_outside",
                "vt": "str"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 130,
        "y": 700,
        "wires": [
            [
                "604cef75.b38078",
                "286c7c9.fa72604",
                "fbf9e851.048aa",
                "5f2324b3.478a74"
            ],
            [
                "3cbd8bbc.be75a4",
                "5fcb77f4.ed6328"
            ]
        ]
    },
    {
        "id": "10ab9a18.c4d2fe",
        "type": "mqtt in",
        "z": "459a3a0f.cadb4c",
        "name": "Sensors online",
        "topic": "devices/0085b208/$online",
        "qos": "2",
        "datatype": "auto",
        "broker": "69f5a3df.5a8b0c",
        "inputs": 0,
        "x": 100,
        "y": 40,
        "wires": [
            [
                "19e5bc30.506174"
            ]
        ]
    },
    {
        "id": "19e5bc30.506174",
        "type": "ui_text",
        "z": "459a3a0f.cadb4c",
        "group": "ddd0fc4c.8a5e8",
        "order": 6,
        "width": "",
        "height": "",
        "name": "",
        "label": "Sensors online",
        "format": "{{msg.payload}}",
        "layout": "",
        "x": 1040,
        "y": 40,
        "wires": []
    },
    {
        "id": "36ff733.e6e650c",
        "type": "mqtt in",
        "z": "459a3a0f.cadb4c",
        "name": "Bedroom fan state",
        "topic": "devices/0081b173/light/on",
        "qos": "2",
        "datatype": "auto",
        "broker": "69f5a3df.5a8b0c",
        "inputs": 0,
        "x": 110,
        "y": 220,
        "wires": [
            [
                "99fbff09.f2e09"
            ]
        ]
    },
    {
        "id": "99fbff09.f2e09",
        "type": "ui_text",
        "z": "459a3a0f.cadb4c",
        "group": "ddd0fc4c.8a5e8",
        "order": 5,
        "width": "",
        "height": "",
        "name": "",
        "label": "Fan on",
        "format": "{{msg.payload}}",
        "layout": "",
        "x": 1060,
        "y": 220,
        "wires": []
    },
    {
        "id": "d399f16f.11c548",
        "type": "mqtt in",
        "z": "459a3a0f.cadb4c",
        "name": "Sensors uptime",
        "topic": "devices/0085b208/$uptime",
        "qos": "2",
        "datatype": "auto",
        "broker": "69f5a3df.5a8b0c",
        "inputs": 0,
        "x": 100,
        "y": 100,
        "wires": [
            [
                "1eebc888.9549bf"
            ]
        ]
    },
    {
        "id": "1eebc888.9549bf",
        "type": "function",
        "z": "459a3a0f.cadb4c",
        "name": "Format seconds",
        "func": "var s = msg.payload;\nvar m = Math.floor(s / 60);\nvar s = s % 60;\nvar h = Math.floor(m / 60);\nvar  m = m % 60;\nvar  d = Math.floor(h / 24);\nvar  h = h % 24;\nmsg.payload = d +\"d \";\nmsg.payload += h + \"h \";\nmsg.payload += m + \"m \";\nmsg.payload += s + \"s\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 340,
        "y": 100,
        "wires": [
            [
                "e3b5c7ad.27665"
            ]
        ]
    },
    {
        "id": "e3b5c7ad.27665",
        "type": "ui_text",
        "z": "459a3a0f.cadb4c",
        "group": "ddd0fc4c.8a5e8",
        "order": 7,
        "width": "",
        "height": "",
        "name": "",
        "label": "Sensors uptime",
        "format": "{{msg.payload}}",
        "layout": "",
        "x": 1040,
        "y": 100,
        "wires": []
    },
    {
        "id": "5be6727d.bd676c",
        "type": "mqtt in",
        "z": "459a3a0f.cadb4c",
        "name": "Bedroom fan online",
        "topic": "devices/0081b173/$online",
        "qos": "2",
        "datatype": "auto",
        "broker": "69f5a3df.5a8b0c",
        "inputs": 0,
        "x": 110,
        "y": 160,
        "wires": [
            [
                "2d116991.e72a16"
            ]
        ]
    },
    {
        "id": "2d116991.e72a16",
        "type": "ui_text",
        "z": "459a3a0f.cadb4c",
        "group": "ddd0fc4c.8a5e8",
        "order": 8,
        "width": "",
        "height": "",
        "name": "",
        "label": "Relay online",
        "format": "{{msg.payload}}",
        "layout": "",
        "x": 1050,
        "y": 160,
        "wires": []
    },
    {
        "id": "462ae5be.8a045c",
        "type": "credentials",
        "z": "459a3a0f.cadb4c",
        "name": "Openweathermap API key",
        "props": [
            {
                "value": "openweather_api_key",
                "type": "msg"
            }
        ],
        "x": 350,
        "y": 920,
        "wires": [
            [
                "8ded4e0b.24ee58"
            ]
        ]
    },
    {
        "id": "46c47065.e8d9b",
        "type": "inject",
        "z": "459a3a0f.cadb4c",
        "name": "Every 5 min",
        "repeat": "300",
        "crontab": "",
        "once": true,
        "onceDelay": "0.0",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 920,
        "wires": [
            [
                "462ae5be.8a045c"
            ]
        ]
    },
    {
        "id": "8ded4e0b.24ee58",
        "type": "http request",
        "z": "459a3a0f.cadb4c",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": false,
        "url": "http://api.openweathermap.org/data/2.5/weather?q=Landsmeer,nl&units=metric&appid={{openweather_api_key}}",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 570,
        "y": 920,
        "wires": [
            [
                "deeb61a7.33ece8"
            ]
        ]
    },
    {
        "id": "88237972.7eca18",
        "type": "ui_text",
        "z": "459a3a0f.cadb4c",
        "group": "ddd0fc4c.8a5e8",
        "order": 2,
        "width": "",
        "height": "",
        "name": "",
        "label": "Outside temperature(api)",
        "format": "{{msg.payload}} &deg;",
        "layout": "",
        "x": 1010,
        "y": 840,
        "wires": []
    },
    {
        "id": "deeb61a7.33ece8",
        "type": "json",
        "z": "459a3a0f.cadb4c",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 590,
        "y": 840,
        "wires": [
            [
                "29f31f7d.91605"
            ]
        ]
    },
    {
        "id": "29f31f7d.91605",
        "type": "change",
        "z": "459a3a0f.cadb4c",
        "name": "Get temp",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.main.temp",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "bedroom_outside_api",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 740,
        "y": 840,
        "wires": [
            [
                "88237972.7eca18",
                "286c7c9.fa72604",
                "3cbd8bbc.be75a4",
                "fbf9e851.048aa",
                "4d5a50d4.1d35b8",
                "3763749a.0336c4"
            ]
        ]
    },
    {
        "id": "286c7c9.fa72604",
        "type": "function",
        "z": "459a3a0f.cadb4c",
        "name": "Outside diff",
        "func": "if(msg.topic == \"bedroom_inside\") {\n    context.temp_inside = msg.payload;\n}\nif(msg.topic == \"bedroom_outside_api\") {\n    context.temp_outside = msg.payload;\n}\nreturn { \n    payload: context.temp_outside - context.temp_inside,\n    topic: \"bedroom_diff\" \n}\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "x": 790,
        "y": 1000,
        "wires": [
            [
                "39649088.9e1208",
                "f6b45c8d.dbadf"
            ]
        ]
    },
    {
        "id": "3bc54bde.1413ac",
        "type": "inject",
        "z": "459a3a0f.cadb4c",
        "name": "Open",
        "props": [
            {
                "p": "payload",
                "v": "",
                "vt": "date"
            },
            {
                "p": "topic",
                "v": "",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 390,
        "y": 1160,
        "wires": [
            [
                "6f726c2.3989694"
            ]
        ]
    },
    {
        "id": "60835a40.3fd5f4",
        "type": "inject",
        "z": "459a3a0f.cadb4c",
        "name": "Close",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 390,
        "y": 1260,
        "wires": [
            [
                "20492d95.5756aa"
            ]
        ]
    },
    {
        "id": "11e5daad.4b931d",
        "type": "inject",
        "z": "459a3a0f.cadb4c",
        "name": "Every 5 sec",
        "repeat": "5",
        "crontab": "",
        "once": true,
        "onceDelay": "3",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 410,
        "y": 1320,
        "wires": [
            [
                "deb7a328.2db828"
            ]
        ]
    },
    {
        "id": "b60fc641.bbc1e8",
        "type": "change",
        "z": "459a3a0f.cadb4c",
        "name": "'open'",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "Open",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 390,
        "y": 1000,
        "wires": [
            [
                "a40ae4f5.d4a528"
            ]
        ]
    },
    {
        "id": "a0363f35.4589e8",
        "type": "change",
        "z": "459a3a0f.cadb4c",
        "name": "'closed'",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "Closed",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 400,
        "y": 1040,
        "wires": [
            [
                "a40ae4f5.d4a528"
            ]
        ]
    },
    {
        "id": "67cd37a1.f6fb6",
        "type": "ui_text",
        "z": "459a3a0f.cadb4c",
        "group": "ddd0fc4c.8a5e8",
        "order": 4,
        "width": "",
        "height": "",
        "name": "",
        "label": "Window target",
        "format": "{{msg.payload}}",
        "layout": "",
        "x": 640,
        "y": 1580,
        "wires": []
    },
    {
        "id": "39ed0882.fb485",
        "type": "switch",
        "z": "459a3a0f.cadb4c",
        "name": "== 'closed'",
        "property": "window_target",
        "propertyType": "flow",
        "rules": [
            {
                "t": "eq",
                "v": "closed",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 410,
        "y": 1220,
        "wires": [
            [
                "20492d95.5756aa"
            ]
        ]
    },
    {
        "id": "14f70808.37a748",
        "type": "switch",
        "z": "459a3a0f.cadb4c",
        "name": "== 'open'",
        "property": "window_target",
        "propertyType": "flow",
        "rules": [
            {
                "t": "eq",
                "v": "open",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 400,
        "y": 1120,
        "wires": [
            [
                "6f726c2.3989694"
            ]
        ]
    },
    {
        "id": "629b989f.9d90b",
        "type": "within-time-switch",
        "z": "459a3a0f.cadb4c",
        "name": "",
        "nameInt": "",
        "positionConfig": "b9ef850f.12a2",
        "startTime": "7:40",
        "startTimeType": "entered",
        "startOffset": 0,
        "startOffsetType": "none",
        "startOffsetMultiplier": 60000,
        "endTime": "12:00",
        "endTimeType": "entered",
        "endOffset": 0,
        "endOffsetType": "none",
        "endOffsetMultiplier": 60000,
        "timeDays": "*",
        "timeOnlyOddDays": false,
        "timeOnlyEvenDays": false,
        "timeMonths": "*",
        "timedatestart": "",
        "timedateend": "",
        "propertyStart": "",
        "propertyStartType": "none",
        "propertyStartCompare": "true",
        "propertyStartThreshold": "",
        "propertyStartThresholdType": "num",
        "startTimeAlt": "",
        "startTimeAltType": "entered",
        "startOffsetAlt": 0,
        "startOffsetAltType": "none",
        "startOffsetAltMultiplier": 60000,
        "propertyEnd": "",
        "propertyEndType": "none",
        "propertyEndCompare": "true",
        "propertyEndThreshold": "",
        "propertyEndThresholdType": "num",
        "endTimeAlt": "",
        "endTimeAltType": "entered",
        "endOffsetAlt": 0,
        "endOffsetAltType": "none",
        "endOffsetAltMultiplier": 60000,
        "tsCompare": "0",
        "x": 410,
        "y": 1400,
        "wires": [
            [],
            []
        ]
    },
    {
        "id": "120b3fd7.78f3c",
        "type": "inject",
        "z": "459a3a0f.cadb4c",
        "name": "Every 30 sec",
        "repeat": "30",
        "crontab": "",
        "once": true,
        "onceDelay": "10",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 200,
        "y": 1400,
        "wires": [
            [
                "629b989f.9d90b"
            ]
        ]
    },
    {
        "id": "1275a2b9.0d5345",
        "type": "change",
        "z": "459a3a0f.cadb4c",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "window_target",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 660,
        "y": 1520,
        "wires": [
            []
        ]
    },
    {
        "id": "c1ec2f58.72581",
        "type": "switch",
        "z": "459a3a0f.cadb4c",
        "name": "Temp diff action",
        "property": "temp_diff",
        "propertyType": "flow",
        "rules": [
            {
                "t": "gt",
                "v": "0.0",
                "vt": "num"
            },
            {
                "t": "lt",
                "v": "-0.75",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 420,
        "y": 1460,
        "wires": [
            [],
            []
        ]
    },
    {
        "id": "39649088.9e1208",
        "type": "change",
        "z": "459a3a0f.cadb4c",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "temp_diff",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 990,
        "y": 1000,
        "wires": [
            []
        ]
    },
    {
        "id": "3cd341cb.92b7fe",
        "type": "mqtt in",
        "z": "459a3a0f.cadb4c",
        "name": "",
        "topic": "tele/+/SENSOR",
        "qos": "2",
        "datatype": "json",
        "broker": "69f5a3df.5a8b0c",
        "inputs": 0,
        "x": 100,
        "y": 400,
        "wires": [
            [
                "8965c4c.bc1e1b8"
            ]
        ]
    },
    {
        "id": "fbf9e851.048aa",
        "type": "link out",
        "z": "459a3a0f.cadb4c",
        "name": "temps",
        "links": [
            "e86fa4f8.ce18e8",
            "33f8b039.6e3cb"
        ],
        "x": 815,
        "y": 920,
        "wires": []
    },
    {
        "id": "8965c4c.bc1e1b8",
        "type": "function",
        "z": "459a3a0f.cadb4c",
        "name": "Get readings",
        "func": "var messages = [];\nfor(index = 0;; index ++) {\n    var prop = \"DS18B20\";\n    if(index > 0) {\n        prop += \"-\" + index;    \n        if (!msg.payload.hasOwnProperty(prop)){\n            break;\n        }\n    } else {\n        if (!msg.payload.hasOwnProperty(prop)){\n            continue;\n        }\n    }\n    messages.push({\n        topic: msg.payload[prop].Id,\n        payload: msg.payload[prop].Temperature\n    });\n}\n\nreturn [messages];\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 310,
        "y": 400,
        "wires": [
            [
                "f97ef03a.7bc198"
            ]
        ]
    },
    {
        "id": "5fcb77f4.ed6328",
        "type": "change",
        "z": "459a3a0f.cadb4c",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "bedroom_outside",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1010,
        "y": 920,
        "wires": [
            []
        ]
    },
    {
        "id": "5f2324b3.478a74",
        "type": "change",
        "z": "459a3a0f.cadb4c",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "bedroom_inside",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1010,
        "y": 880,
        "wires": [
            []
        ]
    },
    {
        "id": "4d5a50d4.1d35b8",
        "type": "change",
        "z": "459a3a0f.cadb4c",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "bedroom_outside_api",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1030,
        "y": 960,
        "wires": [
            []
        ]
    },
    {
        "id": "1bcb56d.8254929",
        "type": "inject",
        "z": "459a3a0f.cadb4c",
        "name": "Every 30 sec",
        "props": [
            {
                "p": "payload",
                "v": "",
                "vt": "date"
            },
            {
                "p": "topic",
                "v": "",
                "vt": "string"
            }
        ],
        "repeat": "30",
        "crontab": "",
        "once": true,
        "onceDelay": "10",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 200,
        "y": 1560,
        "wires": [
            [
                "6822911b.ffc2c"
            ]
        ]
    },
    {
        "id": "6822911b.ffc2c",
        "type": "function",
        "z": "459a3a0f.cadb4c",
        "name": "",
        "func": "// Inside below 19 Close\n// Inside between 19 and 21, and outside above 21, and open: close\n// Inside above 21 and cooler outside and close: Open\n// Inside above 21 and warmer outside and open: close\n\n\nvar bedroom_inside = flow.get(\"bedroom_inside\");\nvar bedroom_outside = flow.get(\"bedroom_outside\");\nvar bedroom_outside_api = flow.get(\"bedroom_outside_api\");\n\nif(bedroom_inside < 18.0) {\n    // Too cold, just keep it closed\n    return {topic: \"target\", payload: \"closed\"}\n} else if(bedroom_inside > 22.0) {\n    // Too hot, cool if possible\n    var diff = bedroom_outside - bedroom_inside;\n    if( diff < -0.5 ) {\n        return {topic: \"target\", payload: \"open\"}\n    }\n    // Close at 0 difference, to prevent not noticing room\n    // and outside are keeping the same temp\n    // TODO: PID?\n    if( diff > 0.0 ) {\n        return {topic: \"target\", payload: \"closed\"}\n    }\n} else {\n    // Inbetween, close if outside above 21, otherwise hold\n    if(bedroom_outside > 22.0) {\n        return {topic: \"target\", payload: \"closed\"}\n    }\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 400,
        "y": 1560,
        "wires": [
            [
                "67cd37a1.f6fb6",
                "1275a2b9.0d5345"
            ]
        ]
    },
    {
        "id": "6f726c2.3989694",
        "type": "link out",
        "z": "459a3a0f.cadb4c",
        "name": "open",
        "links": [
            "7bd79c90.f19984",
            "50b19175.72032"
        ],
        "x": 535,
        "y": 1120,
        "wires": []
    },
    {
        "id": "20492d95.5756aa",
        "type": "link out",
        "z": "459a3a0f.cadb4c",
        "name": "close",
        "links": [
            "8300a6ed.9959b8"
        ],
        "x": 535,
        "y": 1220,
        "wires": []
    },
    {
        "id": "deb7a328.2db828",
        "type": "link out",
        "z": "459a3a0f.cadb4c",
        "name": "status",
        "links": [
            "b0f74837.6f49d8"
        ],
        "x": 535,
        "y": 1320,
        "wires": []
    },
    {
        "id": "fe48bc28.777df8",
        "type": "link in",
        "z": "459a3a0f.cadb4c",
        "name": "is open",
        "links": [
            "be50a951.ae3498",
            "d96f7ea8.8779b"
        ],
        "x": 235,
        "y": 1000,
        "wires": [
            [
                "39ed0882.fb485",
                "b60fc641.bbc1e8"
            ]
        ]
    },
    {
        "id": "14ceb8e1.7a757f",
        "type": "link in",
        "z": "459a3a0f.cadb4c",
        "name": "is closed",
        "links": [
            "6dea83fa.9e1924",
            "e4bef279.11e6d8"
        ],
        "x": 235,
        "y": 1040,
        "wires": [
            [
                "a0363f35.4589e8",
                "14f70808.37a748"
            ]
        ]
    },
    {
        "id": "3763749a.0336c4",
        "type": "function",
        "z": "459a3a0f.cadb4c",
        "name": "To influxdb format",
        "func": "msg.measurement = \"temp_\" + msg.topic;\nmsg.payload = {\n  value: msg.payload,\n  time: new Date().getTime()\n};\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 370,
        "y": 560,
        "wires": [
            [
                "c6dfcb23.ac3a58"
            ]
        ]
    },
    {
        "id": "c6dfcb23.ac3a58",
        "type": "influxdb out",
        "z": "459a3a0f.cadb4c",
        "influxdb": "9e729019.2637e",
        "name": "",
        "measurement": "",
        "precision": "",
        "retentionPolicy": "",
        "database": "database",
        "precisionV18FluxV20": "ms",
        "retentionPolicyV18Flux": "",
        "org": "phin-home",
        "bucket": "home_db/autogen",
        "x": 610,
        "y": 560,
        "wires": []
    },
    {
        "id": "3dc24e9b406e15a3",
        "type": "ui_button",
        "z": "459a3a0f.cadb4c",
        "name": "",
        "group": "ffd321ee.bc6a68",
        "order": 14,
        "width": 2,
        "height": 1,
        "passthru": false,
        "label": "Open",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "open",
        "payloadType": "str",
        "topic": "",
        "topicType": "str",
        "x": 190,
        "y": 1180,
        "wires": [
            [
                "6f726c2.3989694"
            ]
        ]
    },
    {
        "id": "870d924632d0b4a3",
        "type": "ui_button",
        "z": "459a3a0f.cadb4c",
        "name": "",
        "group": "ffd321ee.bc6a68",
        "order": 14,
        "width": 2,
        "height": 1,
        "passthru": false,
        "label": "Close",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "close",
        "payloadType": "str",
        "topic": "",
        "topicType": "str",
        "x": 190,
        "y": 1260,
        "wires": [
            [
                "20492d95.5756aa"
            ]
        ]
    },
    {
        "id": "67ba4266.02fbfc",
        "type": "mqtt in",
        "z": "fe7297a4.e6dc1",
        "name": "Playback state",
        "topic": "kodi/status/playbackstate",
        "qos": "2",
        "datatype": "json",
        "broker": "69f5a3df.5a8b0c",
        "inputs": 0,
        "x": 140,
        "y": 160,
        "wires": [
            [
                "b6a7cac0.c4a028"
            ]
        ]
    },
    {
        "id": "ba4c26e.96afb58",
        "type": "mqtt out",
        "z": "fe7297a4.e6dc1",
        "name": "Stop",
        "topic": "kodi/command/playbackstate",
        "qos": "2",
        "retain": "false",
        "broker": "69f5a3df.5a8b0c",
        "x": 1070,
        "y": 100,
        "wires": []
    },
    {
        "id": "b6a7cac0.c4a028",
        "type": "switch",
        "z": "fe7297a4.e6dc1",
        "name": "filter",
        "property": "payload.kodi_state",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "started",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "stopped",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ended",
                "vt": "str"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 3,
        "x": 330,
        "y": 160,
        "wires": [
            [
                "a16f372f.63e558"
            ],
            [
                "4e8ef854.13f1b",
                "747a48e3.c4d07"
            ],
            [
                "d1c75dfe.c88f2",
                "4e8ef854.13f1b"
            ]
        ]
    },
    {
        "id": "4e8ef854.13f1b",
        "type": "trigger",
        "z": "fe7297a4.e6dc1",
        "name": "",
        "op1": "",
        "op2": "true",
        "op1type": "nul",
        "op2type": "bool",
        "duration": "5",
        "extend": false,
        "units": "min",
        "reset": "",
        "bytopic": "all",
        "outputs": 1,
        "x": 570,
        "y": 260,
        "wires": [
            []
        ]
    },
    {
        "id": "a16f372f.63e558",
        "type": "change",
        "z": "fe7297a4.e6dc1",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "reset",
                "pt": "msg",
                "to": "true",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 580,
        "y": 180,
        "wires": [
            [
                "4e8ef854.13f1b"
            ]
        ]
    },
    {
        "id": "fa5aaf92.c00ec8",
        "type": "mqtt out",
        "z": "fe7297a4.e6dc1",
        "name": "Play",
        "topic": "kodi/command/play",
        "qos": "2",
        "retain": "false",
        "broker": "69f5a3df.5a8b0c",
        "x": 1070,
        "y": 260,
        "wires": []
    },
    {
        "id": "75b8c639.72a8b",
        "type": "change",
        "z": "fe7297a4.e6dc1",
        "name": "payload = stop",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "stop",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 900,
        "y": 100,
        "wires": [
            [
                "ba4c26e.96afb58"
            ]
        ]
    },
    {
        "id": "c91d19f8.d1691",
        "type": "change",
        "z": "fe7297a4.e6dc1",
        "name": "payload = dronezone",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "plugin://plugin.audio.somafm/dronezone",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 880,
        "y": 260,
        "wires": [
            [
                "fa5aaf92.c00ec8"
            ]
        ]
    },
    {
        "id": "81b0737b.76fef",
        "type": "inject",
        "z": "fe7297a4.e6dc1",
        "name": "Play",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "true",
        "payloadType": "bool",
        "x": 670,
        "y": 80,
        "wires": [
            [
                "c91d19f8.d1691"
            ]
        ]
    },
    {
        "id": "eb0a573.e21c828",
        "type": "inject",
        "z": "fe7297a4.e6dc1",
        "name": "Stop",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "true",
        "payloadType": "bool",
        "x": 670,
        "y": 40,
        "wires": [
            [
                "75b8c639.72a8b"
            ]
        ]
    },
    {
        "id": "dd001859.bcca98",
        "type": "mqtt in",
        "z": "fe7297a4.e6dc1",
        "name": "Title",
        "topic": "kodi/status/playertitle",
        "qos": "2",
        "datatype": "json",
        "broker": "69f5a3df.5a8b0c",
        "inputs": 0,
        "x": 110,
        "y": 400,
        "wires": [
            [
                "6e2a574f.5a841"
            ]
        ]
    },
    {
        "id": "a6549fca.fa5c18",
        "type": "ui_text",
        "z": "fe7297a4.e6dc1",
        "group": "9677c439.5fa54",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Title",
        "format": "{{msg.payload}}",
        "layout": "col-center",
        "x": 510,
        "y": 400,
        "wires": []
    },
    {
        "id": "6e2a574f.5a841",
        "type": "change",
        "z": "fe7297a4.e6dc1",
        "name": "Get payload.val",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "msg.payload.val",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 320,
        "y": 400,
        "wires": [
            [
                "a6549fca.fa5c18"
            ]
        ]
    },
    {
        "id": "747a48e3.c4d07",
        "type": "change",
        "z": "fe7297a4.e6dc1",
        "name": "payload = stopped",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "[Stopped]",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 310,
        "y": 300,
        "wires": [
            [
                "a6549fca.fa5c18"
            ]
        ]
    },
    {
        "id": "d1c75dfe.c88f2",
        "type": "change",
        "z": "fe7297a4.e6dc1",
        "name": "payload = ended",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "[Ended]",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 310,
        "y": 340,
        "wires": [
            [
                "a6549fca.fa5c18"
            ]
        ]
    },
    {
        "id": "37ec19c2667a1f90",
        "type": "comment",
        "z": "fe7297a4.e6dc1",
        "name": "Disabled for now ^",
        "info": "",
        "x": 670,
        "y": 320,
        "wires": []
    },
    {
        "id": "ea0c094e.6e9b",
        "type": "mqtt in",
        "z": "53214520.af847c",
        "name": "P1 input",
        "topic": "tele/tasmota_012311/RESULT",
        "qos": "2",
        "datatype": "utf8",
        "broker": "69f5a3df.5a8b0c",
        "inputs": 0,
        "x": 130,
        "y": 160,
        "wires": [
            [
                "91a54f37.f20998"
            ]
        ]
    },
    {
        "id": "1c2f7155.83a77f",
        "type": "function",
        "z": "53214520.af847c",
        "name": "Get header/data",
        "func": "var res = msg.payload.match(/(.+?)(\\(.+)/);\n\nif (res === null) {\n    return null;\n}\n\nmsg.topic = res[1];\nmsg.payload = res[2];\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "x": 500,
        "y": 260,
        "wires": [
            [
                "d884a3d7.e75d9"
            ]
        ]
    },
    {
        "id": "d884a3d7.e75d9",
        "type": "switch",
        "z": "53214520.af847c",
        "name": "Get current power",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "1-0:1.7.0",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "1-0:2.7.0",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "1-0:1.8.1",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "1-0:1.8.2",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "1-0:2.8.1",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "1-0:2.8.2",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 6,
        "x": 490,
        "y": 340,
        "wires": [
            [
                "2767f59a.0aa2a2"
            ],
            [
                "96383f7.8c883c"
            ],
            [
                "ed5eb5fe.63efd8"
            ],
            [
                "667ccb31.a889b4"
            ],
            [
                "f49a0d16.460bd8"
            ],
            [
                "29394d7e.fe0202"
            ]
        ]
    },
    {
        "id": "2767f59a.0aa2a2",
        "type": "function",
        "z": "53214520.af847c",
        "name": "Watt in",
        "func": "var res = msg.payload.match(/\\((\\d\\d\\.\\d\\d\\d)\\*kW\\)/);\n\nif (res === null) {\n    return null;\n}\n\nmsg.payload = parseFloat(res[1]) * 1000;\nmsg.topic = \"Watt in\"\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "x": 750,
        "y": 300,
        "wires": [
            [
                "6de2dae7.04f41c",
                "6cacd492.26010c"
            ]
        ]
    },
    {
        "id": "96383f7.8c883c",
        "type": "function",
        "z": "53214520.af847c",
        "name": "Watt out",
        "func": "var res = msg.payload.match(/\\((\\d\\d\\.\\d\\d\\d)\\*kW\\)/);\n\nif (res === null) {\n    return null;\n}\n\nmsg.payload = parseFloat(res[1]) * -1000;\nmsg.topic = \"Watt out\"\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "x": 760,
        "y": 420,
        "wires": [
            [
                "2a70fa85.6933e6"
            ]
        ]
    },
    {
        "id": "3b09687b.0e773",
        "type": "comment",
        "z": "53214520.af847c",
        "name": "Small chart, numbers above, only last .. ?",
        "info": "",
        "x": 940,
        "y": 760,
        "wires": []
    },
    {
        "id": "91a54f37.f20998",
        "type": "function",
        "z": "53214520.af847c",
        "name": "Remove CR/LF",
        "func": "msg.payload = msg.payload.replace(/[\\r\\n]/, '');\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "x": 300,
        "y": 160,
        "wires": [
            [
                "f903af0b.e2c008"
            ]
        ]
    },
    {
        "id": "f903af0b.e2c008",
        "type": "json",
        "z": "53214520.af847c",
        "name": "",
        "property": "payload",
        "action": "obj",
        "pretty": false,
        "x": 270,
        "y": 200,
        "wires": [
            [
                "e3a2b6af.ecbe5"
            ]
        ]
    },
    {
        "id": "e3a2b6af.ecbe5",
        "type": "change",
        "z": "53214520.af847c",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "msg.payload.SerialReceived",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 300,
        "y": 240,
        "wires": [
            [
                "1c2f7155.83a77f",
                "4c769910.a231d"
            ]
        ]
    },
    {
        "id": "ed5eb5fe.63efd8",
        "type": "function",
        "z": "53214520.af847c",
        "name": "kWh Received T1",
        "func": "var res = msg.payload.match(/\\((\\d{6}\\.\\d{3})\\*kWh\\)/);\n\nif (res === null) {\n    return null;\n}\n\nmsg.payload = parseFloat(res[1]);\nmsg.topic = \"kWh Received T1\"\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "x": 750,
        "y": 560,
        "wires": [
            [
                "35173762.b4c95"
            ]
        ]
    },
    {
        "id": "667ccb31.a889b4",
        "type": "function",
        "z": "53214520.af847c",
        "name": "kWh Received T2",
        "func": "var res = msg.payload.match(/\\((\\d{6}\\.\\d{3})\\*kWh\\)/);\n\nif (res === null) {\n    return null;\n}\n\nmsg.payload = parseFloat(res[1]);\nmsg.topic = \"kWh Received T2\"\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "x": 750,
        "y": 600,
        "wires": [
            [
                "36f4d085.5b5e08"
            ]
        ]
    },
    {
        "id": "f49a0d16.460bd8",
        "type": "function",
        "z": "53214520.af847c",
        "name": "kWh Sent T1",
        "func": "var res = msg.payload.match(/\\((\\d{6}\\.\\d{3})\\*kWh\\)/);\n\nif (res === null) {\n    return null;\n}\n\nmsg.payload = parseFloat(res[1]);\nmsg.topic = \"kWh Sent T1\"\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "x": 730,
        "y": 640,
        "wires": [
            [
                "46e4ff24.111bd"
            ]
        ]
    },
    {
        "id": "29394d7e.fe0202",
        "type": "function",
        "z": "53214520.af847c",
        "name": "kWh Sent T2",
        "func": "var res = msg.payload.match(/\\((\\d{6}\\.\\d{3})\\*kWh\\)/);\n\nif (res === null) {\n    return null;\n}\n\nmsg.payload = parseFloat(res[1]);\nmsg.topic = \"kWh Sent T2\"\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "x": 730,
        "y": 680,
        "wires": [
            [
                "4e2cffa9.40b838"
            ]
        ]
    },
    {
        "id": "6de2dae7.04f41c",
        "type": "ui_text",
        "z": "53214520.af847c",
        "group": "42b6ae00.90b7d4",
        "order": 2,
        "width": "",
        "height": "",
        "name": "",
        "label": "Power usage",
        "format": "{{msg.payload}} Watt",
        "layout": "",
        "x": 450,
        "y": 740,
        "wires": []
    },
    {
        "id": "b2b0f8a7.992778",
        "type": "ui_text",
        "z": "53214520.af847c",
        "group": "42b6ae00.90b7d4",
        "order": 7,
        "width": "",
        "height": "",
        "name": "",
        "label": "Gas usage ???",
        "format": "{{msg.payload}} M<sup>3</sup>",
        "layout": "",
        "x": 440,
        "y": 800,
        "wires": []
    },
    {
        "id": "35173762.b4c95",
        "type": "ui_text",
        "z": "53214520.af847c",
        "group": "42b6ae00.90b7d4",
        "order": 4,
        "width": "",
        "height": "",
        "name": "",
        "label": "kWh in night",
        "format": "{{msg.payload}} kWh",
        "layout": "",
        "x": 990,
        "y": 560,
        "wires": []
    },
    {
        "id": "36f4d085.5b5e08",
        "type": "ui_text",
        "z": "53214520.af847c",
        "group": "42b6ae00.90b7d4",
        "order": 3,
        "width": "",
        "height": "",
        "name": "",
        "label": "kWh in day",
        "format": "{{msg.payload}} kWh",
        "layout": "",
        "x": 990,
        "y": 600,
        "wires": []
    },
    {
        "id": "46e4ff24.111bd",
        "type": "ui_text",
        "z": "53214520.af847c",
        "group": "42b6ae00.90b7d4",
        "order": 6,
        "width": "",
        "height": "",
        "name": "",
        "label": "kWh out night",
        "format": "{{msg.payload}} kWh",
        "layout": "",
        "x": 1000,
        "y": 640,
        "wires": []
    },
    {
        "id": "4e2cffa9.40b838",
        "type": "ui_text",
        "z": "53214520.af847c",
        "group": "42b6ae00.90b7d4",
        "order": 5,
        "width": "",
        "height": "",
        "name": "",
        "label": "kWh out day",
        "format": "{{msg.payload}} kWh",
        "layout": "",
        "x": 990,
        "y": 680,
        "wires": []
    },
    {
        "id": "ac6b5349.cbcd7",
        "type": "function",
        "z": "53214520.af847c",
        "name": "To influxdb format",
        "func": "const data = msg.payload\n\nmsg.measurement = \"house_power\";\nmsg.payload = {\n  current_w_received: data.current_w_received,\n  current_w_delivered: data.current_w_delivered,\n  total_kwh_received_t1: data.total_kwh_received_t1,\n  total_kwh_received_t2: data.total_kwh_received_t2,\n  total_kwh_delivered_t1: data.total_kwh_delivered_t1,\n  total_kwh_delivered_t2: data.total_kwh_delivered_t2,\n  total_gas_m3_received: data.total_gas_m3_received,\n  time: new Date(data.timestamp).getTime()\n};\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 690,
        "y": 40,
        "wires": [
            [
                "2b375b56.872754"
            ]
        ]
    },
    {
        "id": "4c769910.a231d",
        "type": "function",
        "z": "53214520.af847c",
        "name": "Combine parts",
        "func": "if(flow.serial_input === undefined) {\n    flow.serial_input = \"\";\n}\nflow.serial_input += msg.payload +\"\\r\\n\";\n\nif(msg.payload.startsWith(\"!\")) {\n    msg = {\n        topic: \"P1 input\",\n        payload: flow.serial_input\n    }\n    flow.serial_input = \"\";\n    return msg;\n}\n",
        "outputs": 1,
        "noerr": 0,
        "x": 540,
        "y": 160,
        "wires": [
            [
                "bab94a0f.921b38"
            ]
        ]
    },
    {
        "id": "bab94a0f.921b38",
        "type": "function",
        "z": "53214520.af847c",
        "name": "Convert",
        "func": "var result = {};\n\nmsg.payload.split(/\\r?\\n/).forEach(line => {\n    var lineParsed = line.match(/(.+?)(\\(.+)/);\n    if (lineParsed === null) {\n        return;\n    }\n\n    const key = lineParsed[1];\n    const value = lineParsed[2];\n\n    var res;\n    if (key === \"0-0:1.0.0\") {\n        res = value.match(/\\((\\d{2})(\\d{2})(\\d{2})(\\d{2})(\\d{2})(\\d{2})([SW])\\)/);\n        if (res === null) {\n            return;\n        }\n        const year = parseInt(res[1]) + 2000;\n        const month = parseInt(res[2]) - 1;\n        const day = parseInt(res[3]);\n        const hours = parseInt(res[4]);\n        const minutes = parseInt(res[5]);\n        const seconds = parseInt(res[6]);\n        const dst = res[7] === \"W\";\n        const timestamp = new Date(year, month, day, hours, minutes, seconds);\n        result.timestamp = timestamp.toISOString();\n    } else if (key === \"1-0:1.7.0\") {\n        res = value.match(/\\((\\d{2}\\.\\d{3})\\*kW\\)/);\n        if (res === null) {\n            return;\n        }\n        result.current_w_received = parseFloat(res[1]) * 1000;\n    } else if (key === \"1-0:2.7.0\") {\n        res = value.match(/\\((\\d{2}\\.\\d{3})\\*kW\\)/);\n        if (res === null) {\n            return;\n        }\n        result.current_w_delivered = parseFloat(res[1]) * 1000;\n    } else if (key === \"1-0:1.8.1\") {\n        res = value.match(/\\((\\d{6}\\.\\d{3})\\*kWh\\)/);\n        if (res === null) {\n            return;\n        }\n        result.total_kwh_received_t1 = parseFloat(res[1]);\n    } else if (key === \"1-0:1.8.2\") {\n        res = value.match(/\\((\\d{6}\\.\\d{3})\\*kWh\\)/);\n        if (res === null) {\n            return;\n        }\n        result.total_kwh_received_t2 = parseFloat(res[1]);\n    } else if (key === \"1-0:2.8.1\") {\n        res = value.match(/\\((\\d{6}\\.\\d{3})\\*kWh\\)/);\n        if (res === null) {\n            return;\n        }\n        result.total_kwh_delivered_t1 = parseFloat(res[1]);\n    } else if (key === \"1-0:2.8.2\") {\n        res = value.match(/\\((\\d{6}\\.\\d{3})\\*kWh\\)/);\n        if (res === null) {\n            return;\n        }\n        result.total_kwh_delivered_t2 = parseFloat(res[1]);\n    } else if (key === \"0-1:24.2.1\") {\n        res = value.match(/\\(\\d{12}[SW]\\)\\((\\d{5}\\.\\d{3})\\*m3\\)/);\n        if (res === null) {\n            return;\n        }\n        result.total_gas_m3_received = parseFloat(res[1]);\n    }\n    return;\n});\n\nmsg.payload = result;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 40,
        "wires": [
            [
                "ac6b5349.cbcd7"
            ]
        ]
    },
    {
        "id": "2b375b56.872754",
        "type": "influxdb out",
        "z": "53214520.af847c",
        "influxdb": "9e729019.2637e",
        "name": "",
        "measurement": "",
        "precision": "",
        "retentionPolicy": "",
        "database": "database",
        "precisionV18FluxV20": "ms",
        "retentionPolicyV18Flux": "",
        "org": "phin-home",
        "bucket": "home_db/autogen",
        "x": 910,
        "y": 40,
        "wires": []
    },
    {
        "id": "6cacd492.26010c",
        "type": "link out",
        "z": "53214520.af847c",
        "name": "Watt in",
        "links": [
            "d6ec2ac3.24f5f"
        ],
        "x": 1175,
        "y": 200,
        "wires": []
    },
    {
        "id": "2a70fa85.6933e6",
        "type": "link out",
        "z": "53214520.af847c",
        "name": "Watt out",
        "links": [
            "dac9fcf5.4f3058"
        ],
        "x": 1175,
        "y": 260,
        "wires": []
    },
    {
        "id": "cb6c01da.86161",
        "type": "mqtt out",
        "z": "dd00ef6b.1ab33",
        "name": "Serial out",
        "topic": "cmnd/tasmota_85B208/SerialSend3",
        "qos": "2",
        "retain": "false",
        "broker": "69f5a3df.5a8b0c",
        "x": 560,
        "y": 320,
        "wires": []
    },
    {
        "id": "c8d2fde4.4da09",
        "type": "change",
        "z": "dd00ef6b.1ab33",
        "name": "[SPACE]",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "\\s",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 220,
        "y": 60,
        "wires": [
            [
                "cb6c01da.86161",
                "38d45dc9.9d7152"
            ]
        ]
    },
    {
        "id": "1074edfe.e111e2",
        "type": "change",
        "z": "dd00ef6b.1ab33",
        "name": "[OPEN\\n]",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "OPEN\\n",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 220,
        "y": 180,
        "wires": [
            [
                "cb6c01da.86161"
            ]
        ]
    },
    {
        "id": "38d45dc9.9d7152",
        "type": "delay",
        "z": "dd00ef6b.1ab33",
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "outputs": 1,
        "x": 230,
        "y": 120,
        "wires": [
            [
                "1074edfe.e111e2"
            ]
        ]
    },
    {
        "id": "29ddccaa.2032ac",
        "type": "change",
        "z": "dd00ef6b.1ab33",
        "name": "[CLOSE\\n]",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "CLOSE\\n",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 230,
        "y": 380,
        "wires": [
            [
                "cb6c01da.86161"
            ]
        ]
    },
    {
        "id": "1bac8483.5b41e3",
        "type": "change",
        "z": "dd00ef6b.1ab33",
        "name": "[SPACE]",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "\\s",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 220,
        "y": 260,
        "wires": [
            [
                "465b7c11.db5664",
                "cb6c01da.86161"
            ]
        ]
    },
    {
        "id": "465b7c11.db5664",
        "type": "delay",
        "z": "dd00ef6b.1ab33",
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "outputs": 1,
        "x": 230,
        "y": 320,
        "wires": [
            [
                "29ddccaa.2032ac"
            ]
        ]
    },
    {
        "id": "b7c33600.a676f8",
        "type": "change",
        "z": "dd00ef6b.1ab33",
        "name": "[STATUS\\n]",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "STATUS\\n",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 230,
        "y": 580,
        "wires": [
            [
                "cb6c01da.86161"
            ]
        ]
    },
    {
        "id": "d85699b2.c04788",
        "type": "change",
        "z": "dd00ef6b.1ab33",
        "name": "[SPACE]",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "\\s",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 220,
        "y": 460,
        "wires": [
            [
                "1f6c944a.1edc34",
                "cb6c01da.86161"
            ]
        ]
    },
    {
        "id": "1f6c944a.1edc34",
        "type": "delay",
        "z": "dd00ef6b.1ab33",
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "outputs": 1,
        "x": 230,
        "y": 520,
        "wires": [
            [
                "b7c33600.a676f8"
            ]
        ]
    },
    {
        "id": "aba5fd44.09bea8",
        "type": "comment",
        "z": "dd00ef6b.1ab33",
        "name": "Settings",
        "info": "SerialConfig 8N2\nBaudrate 19200\nSerialDelimiter 10\n\nRule1 ON system#boot DO Backlog SerialConfig 8N2; Baudrate 19200 ; SerialDelimiter 10 ENDON\nRule1 1\n",
        "x": 560,
        "y": 260,
        "wires": []
    },
    {
        "id": "50b19175.72032",
        "type": "link in",
        "z": "dd00ef6b.1ab33",
        "name": "open",
        "links": [
            "6f726c2.3989694"
        ],
        "x": 115,
        "y": 60,
        "wires": [
            [
                "c8d2fde4.4da09"
            ]
        ]
    },
    {
        "id": "8300a6ed.9959b8",
        "type": "link in",
        "z": "dd00ef6b.1ab33",
        "name": "close",
        "links": [
            "20492d95.5756aa"
        ],
        "x": 115,
        "y": 260,
        "wires": [
            [
                "1bac8483.5b41e3"
            ]
        ]
    },
    {
        "id": "b0f74837.6f49d8",
        "type": "link in",
        "z": "dd00ef6b.1ab33",
        "name": "status",
        "links": [
            "deb7a328.2db828"
        ],
        "x": 115,
        "y": 460,
        "wires": [
            [
                "d85699b2.c04788"
            ]
        ]
    },
    {
        "id": "7762f97.8b30e08",
        "type": "mqtt in",
        "z": "dd00ef6b.1ab33",
        "name": "",
        "topic": "tele/tasmota_85B208/RESULT",
        "qos": "2",
        "datatype": "utf8",
        "broker": "69f5a3df.5a8b0c",
        "inputs": 0,
        "x": 230,
        "y": 660,
        "wires": [
            [
                "c90ce5c1.288b4"
            ]
        ]
    },
    {
        "id": "8d51290.8a48d58",
        "type": "switch",
        "z": "dd00ef6b.1ab33",
        "name": "Handle serial in",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "200  OK",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "210 UnLocked",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "211 Strong Locked",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 360,
        "y": 760,
        "wires": [
            [],
            [
                "d96f7ea8.8779b"
            ],
            [
                "e4bef279.11e6d8"
            ]
        ]
    },
    {
        "id": "c90ce5c1.288b4",
        "type": "function",
        "z": "dd00ef6b.1ab33",
        "name": "Remove CR/LF",
        "func": "msg.payload = msg.payload.replace(/[\\r\\n]/, '');\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 460,
        "y": 660,
        "wires": [
            [
                "6c54f86.54a4888"
            ]
        ]
    },
    {
        "id": "6c54f86.54a4888",
        "type": "json",
        "z": "dd00ef6b.1ab33",
        "name": "",
        "property": "payload",
        "action": "obj",
        "pretty": false,
        "x": 610,
        "y": 660,
        "wires": [
            [
                "1e84724e.698e56"
            ]
        ]
    },
    {
        "id": "1e84724e.698e56",
        "type": "change",
        "z": "dd00ef6b.1ab33",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "msg.payload.SerialReceived",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 180,
        "y": 760,
        "wires": [
            [
                "8d51290.8a48d58"
            ]
        ]
    },
    {
        "id": "d96f7ea8.8779b",
        "type": "link out",
        "z": "dd00ef6b.1ab33",
        "name": "is open",
        "links": [
            "fe48bc28.777df8"
        ],
        "x": 515,
        "y": 740,
        "wires": []
    },
    {
        "id": "e4bef279.11e6d8",
        "type": "link out",
        "z": "dd00ef6b.1ab33",
        "name": "is closed",
        "links": [
            "14ceb8e1.7a757f"
        ],
        "x": 515,
        "y": 780,
        "wires": []
    },
    {
        "id": "27c52d4.458b452",
        "type": "mqtt out",
        "z": "47b85eed.4f8768",
        "name": "Send",
        "topic": "devices/3c71bf10840c/ir/send",
        "qos": "2",
        "retain": "false",
        "broker": "69f5a3df.5a8b0c",
        "x": 630,
        "y": 300,
        "wires": []
    },
    {
        "id": "663db002.d44848",
        "type": "ui_button",
        "z": "47b85eed.4f8768",
        "name": "",
        "group": "ffd321ee.bc6a68",
        "order": 3,
        "width": 2,
        "height": 1,
        "passthru": false,
        "label": "Vol +",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "{\"genre1\":4,\"genre2\":1,\"func\":368,\"id\":0}",
        "payloadType": "json",
        "topic": "",
        "topicType": "str",
        "x": 150,
        "y": 200,
        "wires": [
            [
                "c2afa7fa.ffa0e"
            ]
        ]
    },
    {
        "id": "308add3a.dd0ad2",
        "type": "ui_button",
        "z": "47b85eed.4f8768",
        "name": "",
        "group": "ffd321ee.bc6a68",
        "order": 5,
        "width": 2,
        "height": 1,
        "passthru": false,
        "label": "Vol -",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "{\"genre1\":4,\"genre2\":1,\"func\":369,\"id\":0}",
        "payloadType": "json",
        "topic": "",
        "topicType": "str",
        "x": 150,
        "y": 160,
        "wires": [
            [
                "c2afa7fa.ffa0e"
            ]
        ]
    },
    {
        "id": "6b315fd.fc335a",
        "type": "ui_button",
        "z": "47b85eed.4f8768",
        "name": "",
        "group": "ffd321ee.bc6a68",
        "order": 1,
        "width": 2,
        "height": 1,
        "passthru": false,
        "label": "Power",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "fa-power-off ",
        "payload": "{\"genre1\":4,\"genre2\":1,\"func\":5,\"id\":0}",
        "payloadType": "json",
        "topic": "",
        "topicType": "str",
        "x": 150,
        "y": 80,
        "wires": [
            [
                "c2afa7fa.ffa0e"
            ]
        ]
    },
    {
        "id": "3047d665.00345a",
        "type": "ui_button",
        "z": "47b85eed.4f8768",
        "name": "",
        "group": "ffd321ee.bc6a68",
        "order": 7,
        "width": 2,
        "height": 1,
        "passthru": false,
        "label": "Fav 1",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "{\"genre1\":4,\"genre2\":1,\"func\":242,\"id\":0}",
        "payloadType": "json",
        "topic": "",
        "topicType": "str",
        "x": 150,
        "y": 260,
        "wires": [
            [
                "c2afa7fa.ffa0e"
            ]
        ]
    },
    {
        "id": "ef439224.3fe148",
        "type": "ui_button",
        "z": "47b85eed.4f8768",
        "name": "",
        "group": "ffd321ee.bc6a68",
        "order": 8,
        "width": 2,
        "height": 1,
        "passthru": false,
        "label": "Fav 2",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "{\"genre1\":4,\"genre2\":1,\"func\":243,\"id\":0}",
        "payloadType": "json",
        "topic": "",
        "topicType": "str",
        "x": 150,
        "y": 300,
        "wires": [
            [
                "c2afa7fa.ffa0e"
            ]
        ]
    },
    {
        "id": "480789f3.80ec28",
        "type": "ui_button",
        "z": "47b85eed.4f8768",
        "name": "",
        "group": "ffd321ee.bc6a68",
        "order": 9,
        "width": 2,
        "height": 1,
        "passthru": false,
        "label": "Fav 3",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "{\"genre1\":4,\"genre2\":1,\"func\":244,\"id\":0}",
        "payloadType": "json",
        "topic": "",
        "topicType": "str",
        "x": 150,
        "y": 340,
        "wires": [
            [
                "c2afa7fa.ffa0e"
            ]
        ]
    },
    {
        "id": "810f7e64.88fd88",
        "type": "ui_button",
        "z": "47b85eed.4f8768",
        "name": "",
        "group": "ffd321ee.bc6a68",
        "order": 10,
        "width": 2,
        "height": 1,
        "passthru": false,
        "label": "CoreELEC",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "{\"genre1\":4,\"genre2\":1,\"func\":720,\"id\":0}",
        "payloadType": "json",
        "topic": "",
        "topicType": "str",
        "x": 170,
        "y": 420,
        "wires": [
            [
                "c2afa7fa.ffa0e"
            ]
        ]
    },
    {
        "id": "98f96afe.f0e1b",
        "type": "ui_button",
        "z": "47b85eed.4f8768",
        "name": "",
        "group": "ffd321ee.bc6a68",
        "order": 11,
        "width": 2,
        "height": 1,
        "passthru": false,
        "label": "TV AUDIO",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "{\"genre1\":4,\"genre2\":1,\"func\":722,\"id\":0}",
        "payloadType": "json",
        "topic": "",
        "topicType": "str",
        "x": 170,
        "y": 460,
        "wires": [
            [
                "c2afa7fa.ffa0e"
            ]
        ]
    },
    {
        "id": "c2afa7fa.ffa0e",
        "type": "function",
        "z": "47b85eed.4f8768",
        "name": "",
        "func": "const manufacturer = 0x2A4C;\n\n\nconst manufacturerBin = bin2(manufacturer, 16);\nconst manufacturerParBin = bin2(manufacturer.toString(16)\n    .split(\"\")\n    .reduce((tot,val) => tot ^ parseInt(val,15))\n  , 4);\n\nfunction bin(value, length) {\n  return value.toString(2).padStart(length, '0')\n    .split(\"\").reverse().join(\"\");\n}\nfunction bin2(value, length) {\n  return value.toString(2).padStart(length, '0');\n}\n\nconst funcBin = bin(msg.payload.func, 10);\nconst idBin = bin(msg.payload.id, 2);\n\nconst par1 = manufacturerParBin + bin(msg.payload.genre1, 4);\nconst par2 = bin(msg.payload.genre2, 4) + funcBin.substr(0,4);\nconst par3 = funcBin.substr(4,6) + idBin;\n\nconst par = parseInt( par1, 2 ) ^ parseInt( par2, 2 ) ^ parseInt( par3, 2 );\n\nmsg.payload = manufacturerBin + par1 + par2 + par3 + bin2(par, 8);\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 480,
        "y": 300,
        "wires": [
            [
                "27c52d4.458b452"
            ]
        ]
    },
    {
        "id": "e9450668.fd1058",
        "type": "ui_button",
        "z": "47b85eed.4f8768",
        "name": "",
        "group": "ffd321ee.bc6a68",
        "order": 12,
        "width": 2,
        "height": 1,
        "passthru": false,
        "label": "PC",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "{\"genre1\":4,\"genre2\":1,\"func\":721,\"id\":0}",
        "payloadType": "json",
        "topic": "",
        "topicType": "str",
        "x": 150,
        "y": 500,
        "wires": [
            [
                "c2afa7fa.ffa0e"
            ]
        ]
    },
    {
        "id": "463fb6d1e44553aa",
        "type": "ui_button",
        "z": "47b85eed.4f8768",
        "name": "",
        "group": "ffd321ee.bc6a68",
        "order": 14,
        "width": 2,
        "height": 1,
        "passthru": false,
        "label": "Desk light",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "toggle",
        "payloadType": "str",
        "topic": "",
        "topicType": "str",
        "x": 160,
        "y": 580,
        "wires": [
            [
                "2586f1da0a82b2c2"
            ]
        ]
    },
    {
        "id": "2586f1da0a82b2c2",
        "type": "mqtt out",
        "z": "47b85eed.4f8768",
        "name": "Desk light",
        "topic": "cmnd/tasmota_81B55D/Power",
        "qos": "2",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "69f5a3df.5a8b0c",
        "x": 640,
        "y": 580,
        "wires": []
    },
    {
        "id": "1e78788b.d1f907",
        "type": "mqtt in",
        "z": "1ce9f9b0.4eb196",
        "name": "",
        "topic": "devices/083af27d53d4/display/value",
        "qos": "2",
        "datatype": "utf8",
        "broker": "69f5a3df.5a8b0c",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 180,
        "y": 260,
        "wires": [
            [
                "1e288f7c.8ffe09"
            ]
        ]
    },
    {
        "id": "1e288f7c.8ffe09",
        "type": "function",
        "z": "1ce9f9b0.4eb196",
        "name": "Decode",
        "func": "var result = '';\nconst parts = msg.payload.split(':')\nmainloop:\nfor(var pos = 0 ; pos < 16; pos++) {\n    const val = parts[1].substr(2*pos, 2);\n    if(val == '20') {\n        result += ' ';\n        continue;\n    }\n    if(val == '2e') {\n        result += '.';\n        continue;\n    }\n    for(var index = 0 ; index < 10 ; index++) {\n        if(parseInt(val, 16) == parseInt('30', 16) + index) {\n            result += index;\n            continue mainloop;\n        }\n    }\n    // 41 + 26 -> A-Z\n    for(var index = 0 ; index < 26 ; index++) {\n        if(parseInt(val, 16) == parseInt('41', 16) + index) {\n            result +=  String.fromCharCode(65 + index);\n            continue mainloop;\n        }\n    }\n    // 61 + 26 -> a-z\n    for(var index = 0 ; index < 26 ; index++) {\n        if(parseInt(val, 16) == parseInt('61', 16) + index) {\n            result +=  String.fromCharCode(97 + index);\n            continue mainloop;\n        }\n    }\n    \n    result += '[' + val + ']';\n}\nif(parts[0] == '80') {\n    msg.line = 0;\n}\nif(parts[0] == 'c0') {\n    msg.line = 1;\n}\nmsg.payload = result;\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 420,
        "y": 260,
        "wires": [
            [
                "ade62bfd.db7c8"
            ]
        ]
    },
    {
        "id": "ade62bfd.db7c8",
        "type": "switch",
        "z": "1ce9f9b0.4eb196",
        "name": "On line",
        "property": "line",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "1",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 560,
        "y": 260,
        "wires": [
            [
                "a457e85f.e51fa8",
                "a0c5623a.e6642"
            ],
            [
                "272e8d50.e61bd2",
                "824f02f6.fa838"
            ]
        ]
    },
    {
        "id": "a0c5623a.e6642",
        "type": "ui_text",
        "z": "1ce9f9b0.4eb196",
        "group": "c2fe2d52.ecd92",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Line 1",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "x": 710,
        "y": 200,
        "wires": []
    },
    {
        "id": "272e8d50.e61bd2",
        "type": "ui_text",
        "z": "1ce9f9b0.4eb196",
        "group": "c2fe2d52.ecd92",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Line 2",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "x": 710,
        "y": 300,
        "wires": []
    },
    {
        "id": "a457e85f.e51fa8",
        "type": "switch",
        "z": "1ce9f9b0.4eb196",
        "name": "Is valid A/V",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "regex",
                "v": "^[ 0-9]{3}[0-9]\\.[0-9]{2}A  [ 0-9]{2}\\.[0-9]{2}V$",
                "vt": "str",
                "case": false
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 850,
        "y": 160,
        "wires": [
            [
                "ddde7a52.eb0518",
                "6329b497.9a20ac"
            ],
            [
                "53dbd41a.10de64"
            ]
        ]
    },
    {
        "id": "ddde7a52.eb0518",
        "type": "function",
        "z": "1ce9f9b0.4eb196",
        "name": "A",
        "func": "msg.payload = msg.payload.substr(0, 7).trim();\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1090,
        "y": 140,
        "wires": [
            [
                "c2ebf962.4edf28",
                "adce4d19.4dcec8",
                "25fdbc490fea8383"
            ]
        ]
    },
    {
        "id": "c2ebf962.4edf28",
        "type": "ui_text",
        "z": "1ce9f9b0.4eb196",
        "group": "5228a8eb.6285a8",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Current",
        "format": "{{msg.payload}}A",
        "layout": "row-spread",
        "x": 1260,
        "y": 140,
        "wires": []
    },
    {
        "id": "6329b497.9a20ac",
        "type": "function",
        "z": "1ce9f9b0.4eb196",
        "name": "V",
        "func": "msg.payload = msg.payload.substr(10, 5).trim();\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1090,
        "y": 180,
        "wires": [
            [
                "41f1fac5.5110ac",
                "c399dd18.dcec5",
                "a56ab27fee88d3b5",
                "c68da9dd79bd9368"
            ]
        ]
    },
    {
        "id": "41f1fac5.5110ac",
        "type": "ui_text",
        "z": "1ce9f9b0.4eb196",
        "group": "5228a8eb.6285a8",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Voltage",
        "format": "{{msg.payload}}V",
        "layout": "row-spread",
        "x": 1260,
        "y": 180,
        "wires": []
    },
    {
        "id": "17fd1d58.45a60b",
        "type": "function",
        "z": "1ce9f9b0.4eb196",
        "name": "W",
        "func": "msg.payload = msg.payload.substr(10, 5).trim();\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1090,
        "y": 220,
        "wires": [
            [
                "73e2489a.455ee",
                "a9b366ec.c12228"
            ]
        ]
    },
    {
        "id": "73e2489a.455ee",
        "type": "ui_text",
        "z": "1ce9f9b0.4eb196",
        "group": "5228a8eb.6285a8",
        "order": 3,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Power",
        "format": "{{msg.payload}}W",
        "layout": "row-spread",
        "x": 1250,
        "y": 220,
        "wires": []
    },
    {
        "id": "108a73ba.eecb8c",
        "type": "function",
        "z": "1ce9f9b0.4eb196",
        "name": "Ap",
        "func": "msg.payload = msg.payload.substr(0, 7).trim();\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1090,
        "y": 300,
        "wires": [
            [
                "58e2fcf8.db7a2c",
                "23bbdf4b.3e74b"
            ]
        ]
    },
    {
        "id": "58e2fcf8.db7a2c",
        "type": "ui_text",
        "z": "1ce9f9b0.4eb196",
        "group": "5228a8eb.6285a8",
        "order": 6,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Peak current",
        "format": "{{msg.payload}}A",
        "layout": "row-spread",
        "x": 1270,
        "y": 300,
        "wires": []
    },
    {
        "id": "b937a2bb.ac9638",
        "type": "function",
        "z": "1ce9f9b0.4eb196",
        "name": "Vm",
        "func": "msg.payload = msg.payload.substr(0, 7).trim();\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1090,
        "y": 260,
        "wires": [
            [
                "4236e731.58ea6",
                "4036f06a.f14628"
            ]
        ]
    },
    {
        "id": "4236e731.58ea6",
        "type": "ui_text",
        "z": "1ce9f9b0.4eb196",
        "group": "5228a8eb.6285a8",
        "order": 8,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Minimum voltage",
        "format": "{{msg.payload}}V",
        "layout": "row-spread",
        "x": 1290,
        "y": 260,
        "wires": []
    },
    {
        "id": "853a1d6c.7b6d3",
        "type": "function",
        "z": "1ce9f9b0.4eb196",
        "name": "Wp",
        "func": "msg.payload = msg.payload.substr(0, 7).trim();\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1090,
        "y": 340,
        "wires": [
            [
                "bf651858.991aa",
                "ad67320b.5d1a48"
            ]
        ]
    },
    {
        "id": "bf651858.991aa",
        "type": "ui_text",
        "z": "1ce9f9b0.4eb196",
        "group": "5228a8eb.6285a8",
        "order": 7,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Peak power",
        "format": "{{msg.payload}}W",
        "layout": "row-spread",
        "x": 1270,
        "y": 340,
        "wires": []
    },
    {
        "id": "9adb1873.b41018",
        "type": "function",
        "z": "1ce9f9b0.4eb196",
        "name": "Wh",
        "func": "msg.payload = msg.payload.substr(0, 7).trim();\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1090,
        "y": 380,
        "wires": [
            [
                "5fad6bad.f095bc",
                "b74c4fb.64b333"
            ]
        ]
    },
    {
        "id": "5fad6bad.f095bc",
        "type": "ui_text",
        "z": "1ce9f9b0.4eb196",
        "group": "5228a8eb.6285a8",
        "order": 5,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Total power",
        "format": "{{msg.payload}}Wh",
        "layout": "row-spread",
        "x": 1270,
        "y": 380,
        "wires": []
    },
    {
        "id": "8e9e0cd1.584b78",
        "type": "function",
        "z": "1ce9f9b0.4eb196",
        "name": "Ah",
        "func": "msg.payload = msg.payload.substr(0, 7).trim();\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1090,
        "y": 420,
        "wires": [
            [
                "35ea8416.963c64",
                "aefc79b3.831a78"
            ]
        ]
    },
    {
        "id": "35ea8416.963c64",
        "type": "ui_text",
        "z": "1ce9f9b0.4eb196",
        "group": "5228a8eb.6285a8",
        "order": 4,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Total current",
        "format": "{{msg.payload}}Ah",
        "layout": "row-spread",
        "x": 1270,
        "y": 420,
        "wires": []
    },
    {
        "id": "adce4d19.4dcec8",
        "type": "function",
        "z": "1ce9f9b0.4eb196",
        "name": "To influxdb format - current",
        "func": "data = parseFloat(msg.payload);\n\nmsg.measurement = \"watt_meter\";\nmsg.payload = {\n  current: data,\n  time: new Date().getTime()\n};\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1060,
        "y": 580,
        "wires": [
            [
                "11e27e3d.41afba"
            ]
        ]
    },
    {
        "id": "11e27e3d.41afba",
        "type": "influxdb out",
        "z": "1ce9f9b0.4eb196",
        "influxdb": "9e729019.2637e",
        "name": "",
        "measurement": "",
        "precision": "",
        "retentionPolicy": "",
        "database": "database",
        "precisionV18FluxV20": "ms",
        "retentionPolicyV18Flux": "",
        "org": "phin-home",
        "bucket": "home_db/autogen",
        "x": 1390,
        "y": 700,
        "wires": []
    },
    {
        "id": "c399dd18.dcec5",
        "type": "function",
        "z": "1ce9f9b0.4eb196",
        "name": "To influxdb format - voltage",
        "func": "data = parseFloat(msg.payload);\n\nmsg.measurement = \"watt_meter\";\nmsg.payload = {\n  voltage: data,\n  time: new Date().getTime()\n};\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1060,
        "y": 620,
        "wires": [
            [
                "11e27e3d.41afba"
            ]
        ]
    },
    {
        "id": "a9b366ec.c12228",
        "type": "function",
        "z": "1ce9f9b0.4eb196",
        "name": "To influxdb format - power",
        "func": "data = parseFloat(msg.payload);\n\nmsg.measurement = \"watt_meter\";\nmsg.payload = {\n  power: data,\n  time: new Date().getTime()\n};\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1050,
        "y": 660,
        "wires": [
            [
                "11e27e3d.41afba"
            ]
        ]
    },
    {
        "id": "4036f06a.f14628",
        "type": "function",
        "z": "1ce9f9b0.4eb196",
        "name": "To influxdb format - minimum_voltage",
        "func": "data = parseFloat(msg.payload);\n\nmsg.measurement = \"watt_meter\";\nmsg.payload = {\n  minimum_voltage: data,\n  time: new Date().getTime()\n};\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1090,
        "y": 700,
        "wires": [
            [
                "11e27e3d.41afba"
            ]
        ]
    },
    {
        "id": "23bbdf4b.3e74b",
        "type": "function",
        "z": "1ce9f9b0.4eb196",
        "name": "To influxdb format - peak_current",
        "func": "data = parseFloat(msg.payload);\n\nmsg.measurement = \"watt_meter\";\nmsg.payload = {\n  peak_current: data,\n  time: new Date().getTime()\n};\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1080,
        "y": 740,
        "wires": [
            [
                "11e27e3d.41afba"
            ]
        ]
    },
    {
        "id": "ad67320b.5d1a48",
        "type": "function",
        "z": "1ce9f9b0.4eb196",
        "name": "To influxdb format - peak_power",
        "func": "data = parseFloat(msg.payload);\n\nmsg.measurement = \"watt_meter\";\nmsg.payload = {\n  peak_power: data,\n  time: new Date().getTime()\n};\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1070,
        "y": 780,
        "wires": [
            [
                "11e27e3d.41afba"
            ]
        ]
    },
    {
        "id": "b74c4fb.64b333",
        "type": "function",
        "z": "1ce9f9b0.4eb196",
        "name": "To influxdb format - total_power",
        "func": "data = parseFloat(msg.payload);\n\nmsg.measurement = \"watt_meter\";\nmsg.payload = {\n  total_power: data,\n  time: new Date().getTime()\n};\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1070,
        "y": 820,
        "wires": [
            [
                "11e27e3d.41afba"
            ]
        ]
    },
    {
        "id": "aefc79b3.831a78",
        "type": "function",
        "z": "1ce9f9b0.4eb196",
        "name": "To influxdb format - total_current",
        "func": "data = parseFloat(msg.payload);\n\nmsg.measurement = \"watt_meter\";\nmsg.payload = {\n  total_current: data,\n  time: new Date().getTime()\n};\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1080,
        "y": 860,
        "wires": [
            [
                "11e27e3d.41afba"
            ]
        ]
    },
    {
        "id": "824f02f6.fa838",
        "type": "switch",
        "z": "1ce9f9b0.4eb196",
        "name": "Determine type",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "regex",
                "v": "^[ 0-9]{3}[0-9]\\.[0-9]{2}Vm [ 0-9]{2}[0-9]\\.[0-9]W$",
                "vt": "str",
                "case": false
            },
            {
                "t": "regex",
                "v": "^[ 0-9]{3}[0-9]\\.[0-9]{2}Ap [ 0-9]{2}[0-9]\\.[0-9]W$",
                "vt": "str",
                "case": false
            },
            {
                "t": "regex",
                "v": "^[ 0-9]{4}[0-9]\\.[0-9]Wp [ 0-9]{2}[0-9]\\.[0-9]W$",
                "vt": "str",
                "case": false
            },
            {
                "t": "regex",
                "v": "^[ 0-9]{4}[0-9]\\.[0-9]Wh [ 0-9]{2}[0-9]\\.[0-9]W$",
                "vt": "str",
                "case": false
            },
            {
                "t": "regex",
                "v": "^[ 0-9]{2}[0-9]\\.[0-9]{3}Ah [ 0-9]{2}[0-9]\\.[0-9]W$",
                "vt": "str",
                "case": false
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 6,
        "x": 860,
        "y": 340,
        "wires": [
            [
                "17fd1d58.45a60b",
                "b937a2bb.ac9638"
            ],
            [
                "17fd1d58.45a60b",
                "108a73ba.eecb8c"
            ],
            [
                "17fd1d58.45a60b",
                "853a1d6c.7b6d3"
            ],
            [
                "17fd1d58.45a60b",
                "9adb1873.b41018"
            ],
            [
                "17fd1d58.45a60b",
                "8e9e0cd1.584b78"
            ],
            [
                "53dbd41a.10de64"
            ]
        ]
    },
    {
        "id": "53dbd41a.10de64",
        "type": "debug",
        "z": "1ce9f9b0.4eb196",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1110,
        "y": 480,
        "wires": []
    },
    {
        "id": "e9d48a809bc76da1",
        "type": "mqtt out",
        "z": "1ce9f9b0.4eb196",
        "name": "",
        "topic": "devices/083af27d53d4/relay/value/set",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "69f5a3df.5a8b0c",
        "x": 890,
        "y": 940,
        "wires": []
    },
    {
        "id": "bc6b1cbd8e6853d2",
        "type": "inject",
        "z": "1ce9f9b0.4eb196",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "true",
        "payloadType": "str",
        "x": 580,
        "y": 900,
        "wires": [
            [
                "e9d48a809bc76da1"
            ]
        ]
    },
    {
        "id": "472846c729ae2582",
        "type": "inject",
        "z": "1ce9f9b0.4eb196",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "false",
        "payloadType": "str",
        "x": 580,
        "y": 980,
        "wires": [
            [
                "e9d48a809bc76da1"
            ]
        ]
    },
    {
        "id": "6f3ecb22d63bda58",
        "type": "ui_slider",
        "z": "1ce9f9b0.4eb196",
        "name": "",
        "label": "Cutoff",
        "tooltip": "",
        "group": "cfb855fc5bc17af9",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": true,
        "outs": "all",
        "topic": "topic",
        "topicType": "msg",
        "min": "0",
        "max": "40",
        "step": "0.1",
        "className": "",
        "x": 170,
        "y": 920,
        "wires": [
            [
                "bb83f57ad2ebccfb",
                "494153d0722010d7"
            ]
        ]
    },
    {
        "id": "bb83f57ad2ebccfb",
        "type": "ui_text",
        "z": "1ce9f9b0.4eb196",
        "group": "cfb855fc5bc17af9",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Cutoff",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "x": 330,
        "y": 900,
        "wires": []
    },
    {
        "id": "494153d0722010d7",
        "type": "change",
        "z": "1ce9f9b0.4eb196",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "cutoff",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 360,
        "y": 940,
        "wires": [
            []
        ]
    },
    {
        "id": "a56ab27fee88d3b5",
        "type": "change",
        "z": "1ce9f9b0.4eb196",
        "name": "Cutoff",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$number(payload) <= $flowContext(\"cutoff\") ? \"false\" : undefined",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 270,
        "y": 680,
        "wires": [
            [
                "fc279ae2450c0c2d"
            ]
        ]
    },
    {
        "id": "aae79a70de0affbb",
        "type": "ui_text",
        "z": "1ce9f9b0.4eb196",
        "group": "cfb855fc5bc17af9",
        "order": 4,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Relay",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "x": 790,
        "y": 680,
        "wires": []
    },
    {
        "id": "fc279ae2450c0c2d",
        "type": "rbe",
        "z": "1ce9f9b0.4eb196",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": false,
        "property": "payload",
        "topi": "topic",
        "x": 450,
        "y": 680,
        "wires": [
            [
                "e9d48a809bc76da1",
                "9cebf3070f50cd70"
            ]
        ]
    },
    {
        "id": "1fd2ed4e12ce7cd2",
        "type": "ui_button",
        "z": "1ce9f9b0.4eb196",
        "name": "",
        "group": "cfb855fc5bc17af9",
        "order": 3,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Arm",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "true",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 130,
        "y": 840,
        "wires": [
            [
                "fc279ae2450c0c2d"
            ]
        ]
    },
    {
        "id": "9cebf3070f50cd70",
        "type": "change",
        "z": "1ce9f9b0.4eb196",
        "name": "",
        "rules": [
            {
                "t": "change",
                "p": "payload",
                "pt": "msg",
                "from": "true",
                "fromt": "str",
                "to": "On",
                "tot": "str"
            },
            {
                "t": "change",
                "p": "payload",
                "pt": "msg",
                "from": "false",
                "fromt": "str",
                "to": "Off",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 620,
        "y": 680,
        "wires": [
            [
                "aae79a70de0affbb"
            ]
        ]
    },
    {
        "id": "0298ac04433f6f2b",
        "type": "comment",
        "z": "1ce9f9b0.4eb196",
        "name": "Issues",
        "info": "Issues:\n- If the module reboots, it's back to off.\n- If the server reboots, state might be wrong one, so 'ARM' doesn't send a signal (or so..)\n",
        "x": 630,
        "y": 760,
        "wires": []
    },
    {
        "id": "afcc5f66e0926eb9",
        "type": "mqtt out",
        "z": "1ce9f9b0.4eb196",
        "name": "",
        "topic": "devices/the1602",
        "qos": "0",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "69f5a3df.5a8b0c",
        "x": 1430,
        "y": 1060,
        "wires": []
    },
    {
        "id": "985659140f197316",
        "type": "inject",
        "z": "1ce9f9b0.4eb196",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "\"Hello!\\nThere!\"",
        "payloadType": "json",
        "x": 1200,
        "y": 1060,
        "wires": [
            [
                "afcc5f66e0926eb9"
            ]
        ]
    },
    {
        "id": "25fdbc490fea8383",
        "type": "change",
        "z": "1ce9f9b0.4eb196",
        "name": "T:amps",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "amps",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1460,
        "y": 840,
        "wires": [
            [
                "2ca46fc4121aaeff",
                "d1e7267c.8a21e8"
            ]
        ]
    },
    {
        "id": "2ca46fc4121aaeff",
        "type": "join",
        "z": "1ce9f9b0.4eb196",
        "name": "",
        "mode": "custom",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": true,
        "timeout": "",
        "count": "1",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 1670,
        "y": 920,
        "wires": [
            [
                "61c2458ae4b6c47e"
            ]
        ]
    },
    {
        "id": "61c2458ae4b6c47e",
        "type": "template",
        "z": "1ce9f9b0.4eb196",
        "name": "Line1",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "{{payload.amps}}A {{payload.volts}}V {{payload.spinner}}   ",
        "output": "str",
        "x": 1490,
        "y": 980,
        "wires": [
            [
                "afcc5f66e0926eb9"
            ]
        ]
    },
    {
        "id": "c68da9dd79bd9368",
        "type": "change",
        "z": "1ce9f9b0.4eb196",
        "name": "T:volts",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "volts",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1450,
        "y": 900,
        "wires": [
            [
                "2ca46fc4121aaeff"
            ]
        ]
    },
    {
        "id": "d1e7267c.8a21e8",
        "type": "function",
        "z": "1ce9f9b0.4eb196",
        "name": "counter",
        "func": "var count = context.get(\"count\") || 0;\ncount++;\ncontext.set(\"count\", count);\n\nconst sequence = [' ', '*'];\nconst character = sequence[count % 2];\n\nnode.status({ text: character });\n\nreturn {\n    payload: character,\n    topic: \"spinner\"\n};\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1615,
        "y": 800,
        "wires": [
            [
                "2ca46fc4121aaeff"
            ]
        ],
        "icon": "node-red-dashboard/ui_numeric.png",
        "l": false
    },
    {
        "id": "290794d7.5e34f4",
        "type": "inject",
        "z": "5ecdcc0a.76574c",
        "name": "Hello dragon",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "48656c6c6f20447261676f6e21,4e6f73792065683f203a4029",
        "payloadType": "str",
        "x": 850,
        "y": 340,
        "wires": [
            [
                "8a40680c.753a38"
            ]
        ]
    },
    {
        "id": "8a40680c.753a38",
        "type": "mqtt out",
        "z": "5ecdcc0a.76574c",
        "name": "Display",
        "topic": "devices/083af2512be8/display/write",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "69f5a3df.5a8b0c",
        "x": 1040,
        "y": 400,
        "wires": []
    },
    {
        "id": "aed2dddf.60265",
        "type": "function",
        "z": "5ecdcc0a.76574c",
        "name": "To Hex",
        "func": "var result = '';\nfor(var pos = 0 ; pos < msg.payload.length; pos++) {\n    const hex = msg.payload.charCodeAt(pos).toString(16).padStart(2, '0');\n    result += hex;\n}\nmsg.payload = result;\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 420,
        "wires": [
            [
                "716991d4.a1a01"
            ]
        ]
    },
    {
        "id": "df864241.949cb8",
        "type": "moment",
        "z": "5ecdcc0a.76574c",
        "name": "",
        "topic": "time",
        "input": "",
        "inputType": "msg",
        "inTz": "Europe/Amsterdam",
        "adjAmount": 0,
        "adjType": "days",
        "adjDir": "add",
        "format": "HH:mm:ss",
        "locale": "en-US",
        "output": "",
        "outputType": "msg",
        "outTz": "Europe/Amsterdam",
        "x": 250,
        "y": 480,
        "wires": [
            [
                "6ef69076.f80fe8"
            ]
        ]
    },
    {
        "id": "d258f716.22b308",
        "type": "inject",
        "z": "5ecdcc0a.76574c",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "1",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 110,
        "y": 480,
        "wires": [
            [
                "df864241.949cb8"
            ]
        ]
    },
    {
        "id": "dac9fcf5.4f3058",
        "type": "link in",
        "z": "5ecdcc0a.76574c",
        "name": "Watt out",
        "links": [
            "2a70fa85.6933e6"
        ],
        "x": 35,
        "y": 280,
        "wires": [
            [
                "db76bd33.e27f28"
            ]
        ]
    },
    {
        "id": "33f8b039.6e3cb",
        "type": "link in",
        "z": "5ecdcc0a.76574c",
        "name": "temps",
        "links": [
            "fbf9e851.048aa"
        ],
        "x": 695,
        "y": 220,
        "wires": [
            [
                "913512d.bc0baf"
            ]
        ]
    },
    {
        "id": "d6ec2ac3.24f5f",
        "type": "link in",
        "z": "5ecdcc0a.76574c",
        "name": "Watt in",
        "links": [
            "6cacd492.26010c"
        ],
        "x": 35,
        "y": 220,
        "wires": [
            [
                "db76bd33.e27f28"
            ]
        ]
    },
    {
        "id": "913512d.bc0baf",
        "type": "switch",
        "z": "5ecdcc0a.76574c",
        "name": "",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "bedroom_outside_api",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 790,
        "y": 220,
        "wires": [
            [
                "7be92e4.ad998d"
            ]
        ]
    },
    {
        "id": "db76bd33.e27f28",
        "type": "switch",
        "z": "5ecdcc0a.76574c",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "0",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 290,
        "y": 220,
        "wires": [
            [
                "d462f40b.eef98"
            ]
        ]
    },
    {
        "id": "6ef69076.f80fe8",
        "type": "join",
        "z": "5ecdcc0a.76574c",
        "name": "",
        "mode": "custom",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": true,
        "timeout": "",
        "count": "1",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 110,
        "y": 400,
        "wires": [
            [
                "628ec9c3.499b1",
                "8b3239a0.8112e8"
            ]
        ]
    },
    {
        "id": "628ec9c3.499b1",
        "type": "template",
        "z": "5ecdcc0a.76574c",
        "name": "Line2",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "{{payload.watt}}W      :@)",
        "output": "str",
        "x": 250,
        "y": 420,
        "wires": [
            [
                "de5d8770.7ff6"
            ]
        ]
    },
    {
        "id": "8b3239a0.8112e8",
        "type": "template",
        "z": "5ecdcc0a.76574c",
        "name": "Line1",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "{{payload.time}} {{payload.temp}}\u00dfC",
        "output": "str",
        "x": 250,
        "y": 380,
        "wires": [
            [
                "c14885e9.243bf8"
            ]
        ]
    },
    {
        "id": "d3d952bf.f92338",
        "type": "function",
        "z": "5ecdcc0a.76574c",
        "name": "To Hex",
        "func": "var result = '';\nfor(var pos = 0 ; pos < msg.payload.length; pos++) {\n    const hex = msg.payload.charCodeAt(pos).toString(16).padStart(2, '0');\n    result += hex;\n}\nmsg.payload = result;\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 380,
        "wires": [
            [
                "716991d4.a1a01"
            ]
        ]
    },
    {
        "id": "1c37971b.0c9cf1",
        "type": "change",
        "z": "5ecdcc0a.76574c",
        "name": "T:watt",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "watt",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 570,
        "y": 220,
        "wires": [
            [
                "6ef69076.f80fe8"
            ]
        ]
    },
    {
        "id": "7be92e4.ad998d",
        "type": "change",
        "z": "5ecdcc0a.76574c",
        "name": "T:temp",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "temp",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 950,
        "y": 220,
        "wires": [
            [
                "6ef69076.f80fe8"
            ]
        ]
    },
    {
        "id": "3b193522.e5b63a",
        "type": "template",
        "z": "5ecdcc0a.76574c",
        "name": "Combine lines",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "{{payload.line1}},{{payload.line2}}",
        "output": "str",
        "x": 840,
        "y": 400,
        "wires": [
            [
                "8a40680c.753a38"
            ]
        ]
    },
    {
        "id": "716991d4.a1a01",
        "type": "join",
        "z": "5ecdcc0a.76574c",
        "name": "",
        "mode": "custom",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": true,
        "timeout": "",
        "count": "1",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 670,
        "y": 400,
        "wires": [
            [
                "3b193522.e5b63a"
            ]
        ]
    },
    {
        "id": "c14885e9.243bf8",
        "type": "change",
        "z": "5ecdcc0a.76574c",
        "name": "T:line1",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "line1",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 390,
        "y": 380,
        "wires": [
            [
                "d3d952bf.f92338"
            ]
        ]
    },
    {
        "id": "de5d8770.7ff6",
        "type": "change",
        "z": "5ecdcc0a.76574c",
        "name": "T:line2",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "line2",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 390,
        "y": 420,
        "wires": [
            [
                "aed2dddf.60265"
            ]
        ]
    },
    {
        "id": "d462f40b.eef98",
        "type": "function",
        "z": "5ecdcc0a.76574c",
        "name": "Pad",
        "func": "msg.payload = msg.payload.toString().padStart(4, ' ');\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 220,
        "wires": [
            [
                "1c37971b.0c9cf1"
            ]
        ]
    },
    {
        "id": "207fc735.bfaf48",
        "type": "mqtt out",
        "z": "5ecdcc0a.76574c",
        "name": "Brightness",
        "topic": "devices/083af2512be8/leds/brightness",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "69f5a3df.5a8b0c",
        "x": 1050,
        "y": 500,
        "wires": []
    },
    {
        "id": "1ecd8cf0.f37a8b",
        "type": "ui_slider",
        "z": "5ecdcc0a.76574c",
        "name": "",
        "label": "Brightness",
        "tooltip": "",
        "group": "a8db762f.1aeb8",
        "order": 4,
        "width": 0,
        "height": 0,
        "passthru": false,
        "outs": "all",
        "topic": "topic",
        "topicType": "msg",
        "min": 0,
        "max": "15",
        "step": 1,
        "x": 830,
        "y": 500,
        "wires": [
            [
                "207fc735.bfaf48"
            ]
        ]
    },
    {
        "id": "4371cadad8a6b436",
        "type": "comment",
        "z": "d8803db646ffca0f",
        "name": "Tasmota settings",
        "info": " Sbaudrate 19200\n SerialDelimiter 254\n SSerialSend5 01030001000415C9\n 21:46:40.499 MQT: tele/tasmota_64143C/RESULT = {\"SSerialReceived\":\"01030400000730F817\"}\n ",
        "x": 460,
        "y": 460,
        "wires": []
    },
    {
        "id": "4aebd05a9db257cb",
        "type": "function",
        "z": "d8803db646ffca0f",
        "name": "Parse modbus response",
        "func": "\nfunction fromBytesTo16Bits(input) {\n    return input[0] * 256 + input[1];\n}\n\nconst readHoldingRegisters = 0x03;\nconst writeSingleRegister = 0x06;\n\nconst payload = Buffer.from(msg.payload, \"hex\");\n\nconst newPayload = {};\nmsg = { payload: newPayload };\n\nconst slaveAddress = payload[0];\nconst functionCode = payload[1];\n\nnewPayload.slaveAddress = slaveAddress;\nnewPayload.functionCode = functionCode;\n\nif (functionCode == readHoldingRegisters) {\n    let byteCount = payload[2];\n    if(byteCount == 0x1e) {\n        byteCount = 18;\n    } else if (byteCount == 0x1f) {\n        byteCount = 32;\n    }\n\n    newPayload.byteCount = byteCount;\n\n    newPayload.registerValues = {};\n    for (let index = 0; index < byteCount; index++) {\n        newPayload.registerValues[index] = payload[3 + index];\n    }\n    const crcHi = payload[3 + byteCount];\n    const crcLo = payload[4 + byteCount];\n    const crc = fromBytesTo16Bits([crcHi, crcLo]);\n    // TODO: Check CRC\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 710,
        "y": 120,
        "wires": [
            [
                "68c01c0e3004fb3f"
            ]
        ]
    },
    {
        "id": "23fb96fc63aae70d",
        "type": "inject",
        "z": "d8803db646ffca0f",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "0.5",
        "topic": "",
        "payload": "uMeasure",
        "payloadType": "str",
        "x": 140,
        "y": 280,
        "wires": [
            [
                "222a094e9a126755"
            ]
        ]
    },
    {
        "id": "18d54fea54a34499",
        "type": "mqtt out",
        "z": "d8803db646ffca0f",
        "name": "KP184 output",
        "topic": "cmnd/tasmota_9BC47C/SSerialSend5",
        "qos": "2",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "69f5a3df.5a8b0c",
        "x": 840,
        "y": 320,
        "wires": []
    },
    {
        "id": "b9414cd6a10e4002",
        "type": "mqtt in",
        "z": "d8803db646ffca0f",
        "name": "KP184 input",
        "topic": "tele/tasmota_9BC47C/RESULT",
        "qos": "2",
        "datatype": "utf8",
        "broker": "69f5a3df.5a8b0c",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 150,
        "y": 120,
        "wires": [
            [
                "8e044267ca8a633a"
            ]
        ]
    },
    {
        "id": "8e044267ca8a633a",
        "type": "json",
        "z": "d8803db646ffca0f",
        "name": "",
        "property": "payload",
        "action": "obj",
        "pretty": false,
        "x": 310,
        "y": 120,
        "wires": [
            [
                "a47f016a8fbed239"
            ]
        ]
    },
    {
        "id": "a47f016a8fbed239",
        "type": "change",
        "z": "d8803db646ffca0f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "msg.payload.SSerialReceived",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 480,
        "y": 120,
        "wires": [
            [
                "4aebd05a9db257cb"
            ]
        ]
    },
    {
        "id": "7812b725.54f17",
        "type": "function",
        "z": "d8803db646ffca0f",
        "name": "CRC16-modbus",
        "func": "var CRCMaster = {\n    StringToCheck: \"\",\n    CleanedString: \"\",\n    CRCTableDNP: [],\n    init: function() {\n        this.CRCDNPInit();\n    },\n    CleanString: function(inputType) {\n        if (inputType == \"ASCII\") {\n            this.CleanedString = this.StringToCheck;\n        } else {\n            if (this.StringToCheck.match(/^[0-9A-F \\t]+$/gi) !== null) {\n                this.CleanedString = this._hexStringToString(this.StringToCheck.toUpperCase().replace(/[\\t ]/g, ''));\n            } else {\n                node.warn(\"String doesn't seem to be a valid Hex input.\");\n                return false;\n            }\n        }\n        return true;\n    },\n    CRCDNPInit: function() {\n        var i, j, crc, c;\n        for (i = 0; i < 256; i++) {\n            crc = 0;\n            c = i;\n            for (j = 0; j < 8; j++) {\n                if ((crc ^ c) & 0x0001) crc = (crc >> 1) ^ 0xA6BC;\n                else crc = crc >> 1;\n                c = c >> 1;\n            }\n            this.CRCTableDNP[i] = crc;\n        }\n    },\n    CRC16Modbus: function() {\n        var crc = 0xFFFF;\n        var str = this.CleanedString;\n        for (var pos = 0; pos < str.length; pos++) {\n            crc ^= str.charCodeAt(pos);\n            for (var i = 8; i !== 0; i--) {\n                if ((crc & 0x0001) !== 0) {\n                    crc >>= 1;\n                    crc ^= 0xA001;\n                } else\n                    crc >>= 1;\n            }\n        }\n        return crc;\n    },\n    _stringToBytes: function(str) {\n        var ch, st, re = [];\n        for (var i = 0; i < str.length; i++) {\n            ch = str.charCodeAt(i); // get char\n            st = []; // set up \"stack\"\n            do {\n                st.push(ch & 0xFF); // push byte to stack\n                ch = ch >> 8; // shift value down by 1 byte\n            }\n            while (ch);\n            // add stack contents to result\n            // done because chars have \"wrong\" endianness\n            re = re.concat(st.reverse());\n        }\n        // return an array of bytes\n        return re;\n    },\n    _hexStringToString: function(inputstr) {\n        var hex = inputstr.toString(); //force conversion\n        var str = '';\n        for (var i = 0; i < hex.length; i += 2)\n            str += String.fromCharCode(parseInt(hex.substr(i, 2), 16));\n        return str;\n    },\n    Calculate: function(str, inputType) {\n        this.StringToCheck = str;\n        if (this.CleanString(inputType)) {\n            crcinputcrc16modbus=this.CRC16Modbus().toString(16).toUpperCase();\n            crcinputcrc16modbus=crcinputcrc16modbus.substr(2) + crcinputcrc16modbus.substr(0, 2); //swap bytes\n   \n        }\n    }\n};\n\nCRCMaster.init();\n\nvar inputType = \"HEX\";\nvar crcinputcrc16modbus;\nvar crcinput = msg.payload;\n\nCRCMaster.Calculate(crcinput, inputType);\n\nmsg.payload = crcinput + crcinputcrc16modbus;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 640,
        "y": 320,
        "wires": [
            [
                "18d54fea54a34499"
            ]
        ]
    },
    {
        "id": "222a094e9a126755",
        "type": "function",
        "z": "d8803db646ffca0f",
        "name": "Send modbus request",
        "func": "function from16BitsToBytes(input) {\n    return [(input >> 8) & 0xff, input & 0xff];\n}\n\nconst readHoldingRegisters = 0x03;\nconst writeSingleRegister = 0x06;\n\nconst startingAddresses = {\n    id: 0x0001, // 4 R   1840      1840 in decimal identifies a Kunkin KP184\n    loadOnOff: 0x010e, // 4 R/W 0,1       Load switch is 1, the load is ON; load switch is 0, the load isOFF.\n    loadMode: 0x0110, // 4 R/W 0-3       CR,3-CW, when the load is ON, loading mode cannot be shifted\n    cvSetting: 0x0112, // 4 R/W 0-150000  Loaded voltage value, unit mV\n    ccSetting: 0x0116, // 4 R/W 0-30000   Loaded load value, unit mA\n    ceSetting: 0x011a, // 4 R/W 0-80000   Loaded resistance value, unit Ohm\n    cwSetting: 0x011e, // 4 R/W 0-2500    Loaded power value, unit 0.1W\n    uMeasure: 0x0122, // 4 R   0-150000  Measured voltage value, unit mA\n    iMeasure: 0x0126, // 4 R   0-30000   Measured current value, unit mA\n    readAll: 0x0300,\n    readAllBatteryTest: 0x0301\n}\n\nconst slaveAddress = 0x01;\nconst functionCode = readHoldingRegisters;\n\nconst startingAddress = startingAddresses[msg.payload];\nlet quantityOfRegisters;\nif (msg.payload === 'readAllBatteryTest' ||\n    msg.payload === 'readAll') {\n    // Seems to have no impact on response,\n    // unless set to 4, which gives 4 bytes data\n    quantityOfRegisters = 0x0000;\n} else {\n    quantityOfRegisters = 0x0004;\n}\n\nconst data = [...from16BitsToBytes(startingAddress), ...from16BitsToBytes(quantityOfRegisters)];\n\nconst buffer = Buffer.from([slaveAddress, functionCode, ...data]);\n\nmsg.payload = buffer.toString('hex');\n\nflow.set(\"lastRequest\", {\n    \"slaveAddress\": slaveAddress,\n    \"functionCode\": functionCode,\n    \"startingAddress\": startingAddress,\n    \"quantityOfRegisters\": quantityOfRegisters\n});\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 420,
        "y": 320,
        "wires": [
            [
                "7812b725.54f17",
                "a59fe8e6a0114d72"
            ]
        ]
    },
    {
        "id": "c120157aea0cd035",
        "type": "comment",
        "z": "d8803db646ffca0f",
        "name": "Tasmota modbus (didn't work)",
        "info": "No work:\n\nhttps://github.com/arendst/Tasmota/discussions/15703\nhttps://tasmota.github.io/docs/Modbus-Bridge/#introduction\n\n\nModBusSerialConfig 3\nModbusBaudrate 9600\n\nModbusSend {\"deviceAddress\": 1, \"functionCode\": 3, \"startAddress\": 1, \"type\": \"hex\", \"count\": 4}\nModbusSend {\"deviceAddress\": 1, \"functionCode\": 3, \"startAddress\": 1, \"type\": \"hex\", \"count\": 4, \"endian\": \"msb\"}\nModbusSend {\"deviceAddress\": 1, \"functionCode\": 3, \"startAddress\": 1, \"type\": \"hex\", \"count\": 4, \"endian\": \"lsb\"}\n\n",
        "x": 500,
        "y": 500,
        "wires": []
    },
    {
        "id": "68c01c0e3004fb3f",
        "type": "function",
        "z": "d8803db646ffca0f",
        "name": "Pair to request",
        "func": "const request = flow.get(\"lastRequest\");\nconst response = msg.payload;\n\nif (request.slaveAddress != response.slaveAddress ||\n    request.functionCode != response.functionCode) {\n    node.warn(\"Request/response mismatch\");\n    return null;\n}\n\nmsg = {\n    payload: {\n        request: request,\n        response: response\n    }\n};\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 940,
        "y": 120,
        "wires": [
            [
                "9dd964a777779cfa"
            ]
        ]
    },
    {
        "id": "9dd964a777779cfa",
        "type": "switch",
        "z": "d8803db646ffca0f",
        "name": "",
        "property": "payload.response.functionCode",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "3",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "6",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1110,
        "y": 120,
        "wires": [
            [
                "a2f74b58dd3fb401",
                "5599120ce8713704"
            ],
            []
        ]
    },
    {
        "id": "a2f74b58dd3fb401",
        "type": "function",
        "z": "d8803db646ffca0f",
        "name": "Handle read holding registers response",
        "func": "function toValue(bytes, offset, length) {\n    let result = 0;\n    let multiplier = 1;\n    for (let index = 0; index < length; index++) {\n        result += multiplier * bytes[offset + (length - (index + 1))];\n        multiplier *= 256;\n    }\n    return result;\n}\n\nconst startingAddresses = {\n    id: 0x0001, // 4 R   1840      1840 in decimal identifies a Kunkin KP184\n    loadOnOff: 0x010e, // 4 R/W 0,1       Load switch is 1, the load is ON; load switch is 0, the load isOFF.\n    loadMode: 0x0110, // 4 R/W 0-3       CR,3-CW, when the load is ON, loading mode cannot be shifted\n    cvSetting: 0x0112, // 4 R/W 0-150000  Loaded voltage value, unit mV\n    ccSetting: 0x0116, // 4 R/W 0-30000   Loaded load value, unit mA\n    ceSetting: 0x011a, // 4 R/W 0-80000   Loaded resistance value, unit Ohm\n    cwSetting: 0x011e, // 4 R/W 0-2500    Loaded power value, unit 0.1W\n    uMeasure: 0x0122, // 4 R   0-150000  Measured voltage value, unit mA\n    iMeasure: 0x0126, // 4 R   0-30000   Measured current value, unit mA\n    readAll: 0x0300,\n    readAllBatteryTest: 0x0301\n}\n\nconst request = msg.payload.request;\nconst response = msg.payload.response;\n\nmsg = { payload: {} }\n\nconst startingAddress = request.startingAddress;\nconst byteCount = response.byteCount;\nconst registerValues = response.registerValues;\n\nif (startingAddress == startingAddresses.uMeasure && byteCount == 0x04) {\n    // 0 - 150000  Measured voltage value, unit mV\n    msg.payload.measuredVoltage = toValue(registerValues, 0, 4) / 1000;\n} else if (startingAddress == startingAddresses.iMeasure && byteCount == 0x04) {\n    // 0 - 30000   Measured current value, unit mA\n    msg.payload.measuredCurrent = toValue(registerValues, 0, 4) / 1000;\n} else if ((startingAddress == startingAddresses.readAll ||\n            startingAddress == startingAddresses.readAllBatteryTest) &&\n            byteCount >= 18) {\n    const status1 = registerValues[0];\n    msg.payload.overPowerProtection = (status1 & 0x80) > 0;\n    msg.payload.overVoltageProtection = (status1 & 0x40) > 0;\n    msg.payload.overTemperatureProtectionProbe2 = (status1 & 0x20) > 0;\n    msg.payload.overTemperatureProtectionProbe1 = (status1 & 0x10) > 0;\n    msg.payload.senseOn = (status1 & 0x08) > 0;\n    // Load mode: 0 = CV, 1 = CC, 2 = CR, 3 = CW\t\t\n    msg.payload.loadMode = (status1 & 0x06) >> 1;\n    msg.payload.loadOn = (status1 & 0x01) > 0;\n\n    const status2 = registerValues[1];\n    msg.payload.overcurrentProtectionTestFunction = (status2 & 0x40) > 0;\n    msg.payload.comparisonTestFunction = (status2 & 0x20) > 0;\n    msg.payload.dynamicTestFunction = (status2 & 0x08) > 0;\n    msg.payload.batteryTestFunction = (status2 & 0x04) > 0;\n    msg.payload.loadShortCircuitFunction = (status2 & 0x02) > 0;\n    msg.payload.powerOnLoadingFunction = (status2 & 0x01) > 0;\n\n    msg.payload.measuredVoltage = toValue(registerValues, 2, 3) / 1000;\n    msg.payload.measuredCurrent = toValue(registerValues, 5, 3) / 1000;\n    if(msg.payload.loadMode == 0) {\n        msg.payload.constantVoltage = toValue(registerValues, 8, 3) / 1000;\n    } else if (msg.payload.loadMode == 1) {\n        msg.payload.constantCurrent = toValue(registerValues, 8, 3) / 1000;\n    } else if (msg.payload.loadMode == 2) {\n        msg.payload.constantResistance = toValue(registerValues, 8, 3) / 10;\n    } else if (msg.payload.loadMode == 3) {\n        msg.payload.constantWatt = toValue(registerValues, 8, 3) / 100;\n    }\n    msg.payload.risingSlope = toValue(registerValues, 11, 2) / 10;\n    msg.payload.fallingSlope = toValue(registerValues, 13, 2) / 10;\n    msg.payload.loadThreshold = toValue(registerValues, 15, 3) / 1000;\n\n    if (startingAddress == startingAddresses.readAllBatteryTest && byteCount == 32) {\n        msg.payload.halfCurrentDischargeEnable = registerValues[18];\n        msg.payload.capacityCalculationUnit = registerValues[19];\n        msg.payload.dischargeEndPromptSignal = registerValues[20];\n        msg.payload.dischargeTerminationVoltage = toValue(registerValues, 21, 3) / 1000;\n        msg.payload.testCapacityAH = toValue(registerValues, 24, 4) / (60 * 60 * 1000);\n        msg.payload.testCapacityWH = toValue(registerValues, 28, 4) / (60 * 60 * 1000);\n    } \n} else {\n    return null;\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1420,
        "y": 100,
        "wires": [
            [
                "d57f2cebdcf3edd4"
            ]
        ]
    },
    {
        "id": "8c8ba6e891002f7c",
        "type": "inject",
        "z": "d8803db646ffca0f",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "iMeasure",
        "payloadType": "str",
        "x": 140,
        "y": 340,
        "wires": [
            [
                "222a094e9a126755"
            ]
        ]
    },
    {
        "id": "a59fe8e6a0114d72",
        "type": "trigger",
        "z": "d8803db646ffca0f",
        "name": "",
        "op1": "",
        "op2": "readAllBatteryTest",
        "op1type": "nul",
        "op2type": "str",
        "duration": "1",
        "extend": true,
        "overrideDelay": false,
        "units": "s",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 1,
        "x": 420,
        "y": 400,
        "wires": [
            [
                "222a094e9a126755"
            ]
        ]
    },
    {
        "id": "5599120ce8713704",
        "type": "function",
        "z": "d8803db646ffca0f",
        "name": "function 1",
        "func": "const startingAddresses = {\n    id: 0x0001, // 4 R   1840      1840 in decimal identifies a Kunkin KP184\n    loadOnOff: 0x010e, // 4 R/W 0,1       Load switch is 1, the load is ON; load switch is 0, the load isOFF.\n    loadMode: 0x0110, // 4 R/W 0-3       CR,3-CW, when the load is ON, loading mode cannot be shifted\n    cvSetting: 0x0112, // 4 R/W 0-150000  Loaded voltage value, unit mV\n    ccSetting: 0x0116, // 4 R/W 0-30000   Loaded load value, unit mA\n    ceSetting: 0x011a, // 4 R/W 0-80000   Loaded resistance value, unit Ohm\n    cwSetting: 0x011e, // 4 R/W 0-2500    Loaded power value, unit 0.1W\n    uMeasure: 0x0122, // 4 R   0-150000  Measured voltage value, unit mA\n    iMeasure: 0x0126, // 4 R   0-30000   Measured current value, unit mA\n    readAll: 0x0300,\n    readAllBatteryTest: 0x0301\n}\n\nconst next = {};\n// next[startingAddresses[\"uMeasure\"]] = \"iMeasure\";\n// next[startingAddresses[\"iMeasure\"]] = \"uMeasure\";\nnext[startingAddresses[\"readAllBatteryTest\"]] = \"readAllBatteryTest\";\n\n\nreturn {\n    payload: msg.payload.request ?\n        next[msg.payload.request.startingAddress] :\n        \"readAllBatteryTest\"\n};",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 660,
        "y": 220,
        "wires": [
            [
                "222a094e9a126755"
            ]
        ]
    },
    {
        "id": "2fd46efc04b66ad0",
        "type": "influxdb out",
        "z": "d8803db646ffca0f",
        "influxdb": "9e729019.2637e",
        "name": "",
        "measurement": "",
        "precision": "",
        "retentionPolicy": "",
        "database": "database",
        "precisionV18FluxV20": "ms",
        "retentionPolicyV18Flux": "",
        "org": "phin-home",
        "bucket": "home_db/autogen",
        "x": 1610,
        "y": 180,
        "wires": []
    },
    {
        "id": "d57f2cebdcf3edd4",
        "type": "function",
        "z": "d8803db646ffca0f",
        "name": "To influxdb format",
        "func": "const payload = {\n  time: new Date().getTime()\n};\n\nif (!isNaN(msg.payload.measuredVoltage)) {\n  payload.voltage = msg.payload.measuredVoltage;\n}\n\nif (!isNaN(msg.payload.measuredCurrent)) {\n  payload.current = msg.payload.measuredCurrent;\n}\n\nif (!isNaN(msg.payload.testCapacityWH)) {\n  payload.total_power = msg.payload.testCapacityWH;\n}\n\nif (!isNaN(msg.payload.testCapacityAH)) {\n  payload.total_current = msg.payload.testCapacityAH;\n}\n\nif (!isNaN(msg.payload.measuredVoltage) &&\n    !isNaN(msg.payload.measuredCurrent)) {\n  payload.power = msg.payload.measuredCurrent * msg.payload.measuredVoltage;\n}\n\nreturn {\n  measurement: \"kp184\",\n  payload: payload\n};",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1370,
        "y": 180,
        "wires": [
            [
                "2fd46efc04b66ad0"
            ]
        ]
    },
    {
        "id": "b9b05bfe92541296",
        "type": "inject",
        "z": "d8803db646ffca0f",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "readAll",
        "payloadType": "str",
        "x": 130,
        "y": 400,
        "wires": [
            [
                "222a094e9a126755"
            ]
        ]
    },
    {
        "id": "c09ba17b57cbf681",
        "type": "inject",
        "z": "d8803db646ffca0f",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "0.5",
        "topic": "",
        "payload": "readAllBatteryTest",
        "payloadType": "str",
        "x": 170,
        "y": 460,
        "wires": [
            [
                "222a094e9a126755"
            ]
        ]
    },
    {
        "id": "2b9273fec733f646",
        "type": "inject",
        "z": "d8803db646ffca0f",
        "name": "Starter",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "0.5",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 140,
        "y": 220,
        "wires": [
            [
                "5599120ce8713704"
            ]
        ]
    }
]
