[
    {
        "id": "5d39f6e8.677b6",
        "label": "Flow 1",
        "type": "tab"
    },
    {
        "disabled": false,
        "id": "8986fa08.d4999",
        "info": "",
        "label": "Doorbell",
        "type": "tab"
    },
    {
        "disabled": false,
        "id": "9122054e.29969",
        "info": "",
        "label": "Neopixels",
        "type": "tab"
    },
    {
        "disabled": false,
        "id": "459a3a0f.cadb4c",
        "info": "",
        "label": "Temperature control",
        "type": "tab"
    },
    {
        "disabled": false,
        "id": "fe7297a4.e6dc1",
        "info": "",
        "label": "Kodi",
        "type": "tab"
    },
    {
        "disabled": false,
        "id": "307f8b6a.ec1714",
        "info": "",
        "label": "Solar",
        "type": "tab"
    },
    {
        "disabled": false,
        "id": "53214520.af847c",
        "info": "",
        "label": "P1",
        "type": "tab"
    },
    {
        "disabled": false,
        "id": "da818f88.a776d",
        "info": "",
        "label": "Power graphs",
        "type": "tab"
    },
    {
        "disabled": false,
        "id": "dd00ef6b.1ab33",
        "info": "",
        "label": "AXA",
        "type": "tab"
    },
    {
        "disabled": false,
        "id": "47b85eed.4f8768",
        "info": "",
        "label": "AMP IR",
        "type": "tab"
    },
    {
        "disabled": false,
        "id": "1ce9f9b0.4eb196",
        "info": "",
        "label": "Power",
        "type": "tab"
    },
    {
        "disabled": false,
        "id": "5ecdcc0a.76574c",
        "info": "",
        "label": "LCD",
        "type": "tab"
    },
    {
        "disabled": false,
        "env": [],
        "id": "6c54caeefbfa8e69",
        "info": "",
        "label": "Bike",
        "type": "tab"
    },
    {
        "disabled": false,
        "env": [],
        "id": "d40a49d02a4e326f",
        "info": "",
        "label": "Central heating",
        "type": "tab"
    },
    {
        "disabled": false,
        "env": [],
        "id": "be8ec646a7f94614",
        "info": "",
        "label": "Humidity",
        "type": "tab"
    },
    {
        "id": "f7c3f5b1.15af3",
        "in": [
            {
                "wires": [
                    {
                        "id": "ea4d6784.fc38b"
                    }
                ],
                "x": 40,
                "y": 180
            }
        ],
        "info": "Connect both the external input and\nthe control output to the input.\nMake sure the control has topic 'control'\nThe output should be connected to the input\nof the control.",
        "name": "BufferFlow",
        "out": [
            {
                "wires": [
                    {
                        "id": "230bc5d2.7396a2",
                        "port": 0
                    }
                ],
                "x": 880,
                "y": 180
            }
        ],
        "type": "subflow"
    },
    {
        "id": "df7451c1.bfdb28",
        "site": {
            "allowSwipe": "false",
            "dateFormat": "DD/MM/YYYY",
            "hideToolbar": "false",
            "lockMenu": "false",
            "name": "Node-RED Dashboard",
            "sizes": {
                "cx": 6,
                "cy": 6,
                "gx": 6,
                "gy": 6,
                "px": 0,
                "py": 0,
                "sx": 48,
                "sy": 48
            }
        },
        "theme": {
            "angularTheme": {
                "accents": "blue",
                "background": "grey",
                "palette": "light",
                "primary": "indigo",
                "warn": "red"
            },
            "customTheme": {
                "baseColor": "#4B7930",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "default": "#4B7930",
                "name": "Untitled Theme 1"
            },
            "darkTheme": {
                "baseColor": "#097479",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "default": "#097479",
                "edited": false,
                "reset": false
            },
            "lightTheme": {
                "baseColor": "#0094CE",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "default": "#0094CE",
                "edited": true,
                "reset": false
            },
            "name": "theme-dark",
            "themeState": {
                "base-color": {
                    "default": "#097479",
                    "edited": true,
                    "value": "#097479"
                },
                "base-font": {
                    "value": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
                },
                "group-backgroundColor": {
                    "edited": false,
                    "value": "#333333"
                },
                "group-borderColor": {
                    "edited": false,
                    "value": "#555555"
                },
                "group-textColor": {
                    "edited": false,
                    "value": "#0eb8c0"
                },
                "page-backgroundColor": {
                    "edited": false,
                    "value": "#111111"
                },
                "page-sidebar-backgroundColor": {
                    "edited": false,
                    "value": "#333333"
                },
                "page-titlebar-backgroundColor": {
                    "edited": false,
                    "value": "#097479"
                },
                "widget-backgroundColor": {
                    "edited": false,
                    "value": "#097479"
                },
                "widget-borderColor": {
                    "edited": false,
                    "value": "#333333"
                },
                "widget-textColor": {
                    "edited": false,
                    "value": "#eeeeee"
                }
            }
        },
        "type": "ui_base"
    },
    {
        "icon": "dashboard",
        "id": "5cee9693.358b08",
        "name": "Temps",
        "order": 3,
        "type": "ui_tab"
    },
    {
        "disp": true,
        "id": "58ffad67.aac28c",
        "name": "Bedroom",
        "order": 1,
        "tab": "5cee9693.358b08",
        "type": "ui_group",
        "width": "24"
    },
    {
        "birthPayload": "",
        "birthQos": "0",
        "birthTopic": "",
        "broker": "raspberrypi.fritz.box",
        "cleansession": true,
        "clientid": "",
        "closePayload": "",
        "closeQos": "0",
        "closeTopic": "",
        "compatmode": true,
        "id": "69f5a3df.5a8b0c",
        "keepalive": "60",
        "name": "PI",
        "port": "1883",
        "type": "mqtt-broker",
        "usetls": false,
        "willPayload": "",
        "willQos": "0",
        "willTopic": ""
    },
    {
        "icon": "dashboard",
        "id": "b47e83d3.de77e",
        "name": "Dashboard",
        "order": 1,
        "type": "ui_tab"
    },
    {
        "disp": true,
        "id": "ddd0fc4c.8a5e8",
        "name": "Bedroom",
        "order": 3,
        "tab": "b47e83d3.de77e",
        "type": "ui_group",
        "width": "6"
    },
    {
        "collapse": false,
        "disp": true,
        "id": "42b6ae00.90b7d4",
        "name": "Home",
        "order": 4,
        "tab": "b47e83d3.de77e",
        "type": "ui_group",
        "width": "6"
    },
    {
        "disp": true,
        "id": "c8a54de6.369ff",
        "name": "NeoPixels",
        "order": 5,
        "tab": "b47e83d3.de77e",
        "type": "ui_group",
        "width": "6"
    },
    {
        "disp": true,
        "id": "2d022f29.4a0f6",
        "name": "Switches",
        "order": 6,
        "tab": "b47e83d3.de77e",
        "type": "ui_group",
        "width": "6"
    },
    {
        "disp": true,
        "id": "a8db762f.1aeb8",
        "name": "Desk",
        "order": 1,
        "tab": "b47e83d3.de77e",
        "type": "ui_group",
        "width": "6"
    },
    {
        "collapse": false,
        "disp": true,
        "id": "9677c439.5fa54",
        "name": "Kodi",
        "order": 7,
        "tab": "b47e83d3.de77e",
        "type": "ui_group",
        "width": "6"
    },
    {
        "angleType": "deg",
        "id": "b9ef850f.12a2",
        "isValide": "true",
        "latitude": "0",
        "longitude": "0",
        "name": "Home2",
        "stateDateFormat": "12",
        "stateTimeFormat": "3",
        "timeZoneDST": 0,
        "timeZoneOffset": 99,
        "type": "position-config"
    },
    {
        "disabled": false,
        "hidden": false,
        "icon": "fa-plug",
        "id": "8f71738d.39f7d8",
        "name": "Power",
        "order": 4,
        "type": "ui_tab"
    },
    {
        "collapse": false,
        "disp": false,
        "id": "4159afe3.bd0fe",
        "name": "Solar graphs",
        "order": 2,
        "tab": "8f71738d.39f7d8",
        "type": "ui_group",
        "width": "18"
    },
    {
        "collapse": false,
        "disp": false,
        "id": "e5757e69.82094",
        "name": "Solar info",
        "order": 1,
        "tab": "8f71738d.39f7d8",
        "type": "ui_group",
        "width": "6"
    },
    {
        "disabled": false,
        "hidden": false,
        "icon": "dashboard",
        "id": "3c71ce20.73a8c2",
        "name": "Solar only",
        "order": 5,
        "type": "ui_tab"
    },
    {
        "collapse": false,
        "disp": false,
        "id": "78fa6592.1d0d3c",
        "name": "Solar only",
        "order": 1,
        "tab": "3c71ce20.73a8c2",
        "type": "ui_group",
        "width": "18"
    },
    {
        "disabled": false,
        "hidden": false,
        "icon": "dashboard",
        "id": "38eddcdf.4bf11c",
        "name": "Home power",
        "order": 6,
        "type": "ui_tab"
    },
    {
        "collapse": false,
        "disp": false,
        "id": "c13636b9.13657",
        "name": "Home power",
        "order": 1,
        "tab": "38eddcdf.4bf11c",
        "type": "ui_group",
        "width": "18"
    },
    {
        "disabled": false,
        "hidden": false,
        "icon": "dashboard",
        "id": "3ecae79f.798258",
        "name": "AMP",
        "order": 6,
        "type": "ui_tab"
    },
    {
        "collapse": false,
        "disp": false,
        "id": "ffd321ee.bc6a68",
        "name": "AMP",
        "order": 1,
        "tab": "3ecae79f.798258",
        "type": "ui_group",
        "width": "6"
    },
    {
        "group": "ffd321ee.bc6a68",
        "height": 1,
        "id": "5a94b1ee.ca1428",
        "name": "spacer",
        "order": 2,
        "type": "ui_spacer",
        "width": 2
    },
    {
        "group": "ffd321ee.bc6a68",
        "height": 1,
        "id": "57d529e4.de3f58",
        "name": "spacer",
        "order": 4,
        "type": "ui_spacer",
        "width": 4
    },
    {
        "group": "ffd321ee.bc6a68",
        "height": 1,
        "id": "e756cac3.f4dce",
        "name": "spacer",
        "order": 6,
        "type": "ui_spacer",
        "width": 6
    },
    {
        "group": "ffd321ee.bc6a68",
        "height": "1",
        "id": "5d5caac3.0a752c",
        "name": "spacer",
        "order": 13,
        "type": "ui_spacer",
        "width": "6"
    },
    {
        "database": "database",
        "hostname": "127.0.0.1",
        "id": "9e729019.2637e",
        "influxdbVersion": "2.0",
        "name": "InfluxDB-Flux",
        "port": "8086",
        "protocol": "http",
        "rejectUnauthorized": true,
        "tls": "",
        "type": "influxdb",
        "url": "http://debian.fritz.box:8086",
        "usetls": false
    },
    {
        "disabled": false,
        "hidden": false,
        "icon": "dashboard",
        "id": "b3110722.bd5e3",
        "name": "Watt Meter",
        "type": "ui_tab"
    },
    {
        "collapse": false,
        "disp": true,
        "id": "c2fe2d52.ecd92",
        "name": "Display",
        "order": 1,
        "tab": "b3110722.bd5e3",
        "type": "ui_group",
        "width": "6"
    },
    {
        "collapse": false,
        "disp": true,
        "id": "5228a8eb.6285a8",
        "name": "Values",
        "order": 2,
        "tab": "b3110722.bd5e3",
        "type": "ui_group",
        "width": "6"
    },
    {
        "collapse": false,
        "disp": true,
        "id": "cfb855fc5bc17af9",
        "name": "Control",
        "order": 3,
        "tab": "b3110722.bd5e3",
        "type": "ui_group",
        "width": "6"
    },
    {
        "action": "",
        "from": "",
        "id": "c5472008.083cd8",
        "name": "",
        "property": "",
        "reg": false,
        "rules": [
            {
                "p": "topic",
                "pt": "msg",
                "t": "set",
                "to": "trigger",
                "tot": "str"
            }
        ],
        "to": "",
        "type": "change",
        "wires": [
            [
                "267878a1.6cb448"
            ]
        ],
        "x": 370,
        "y": 240,
        "z": "f7c3f5b1.15af3"
    },
    {
        "bytopic": "all",
        "duration": "1000",
        "extend": true,
        "id": "267878a1.6cb448",
        "name": "",
        "op1": "true",
        "op1type": "str",
        "op2": "false",
        "op2type": "str",
        "outputs": 1,
        "reset": "",
        "type": "trigger",
        "units": "ms",
        "wires": [
            [
                "230bc5d2.7396a2"
            ]
        ],
        "x": 560,
        "y": 240,
        "z": "f7c3f5b1.15af3"
    },
    {
        "func": "// Message from trigger\n// The trigger sends true, then false after 1s\nif(msg.topic == \"trigger\") {\n    context.set('wait', msg.payload);\n    if(msg.payload == 'true') {\n        // Trigger started, wait...\n        return null;\n    }\n\n    // Get and remove buffered value, then send it\n    var buffered = context.get('buf');\n    if(typeof buffered !== 'undefined' &&\n       buffered !== null) {\n        context.set('buf', null);\n        return {payload: buffered};\n    }\n    return null;\n}\n\n// Message from external input\nif(context.get('wait') == 'true') {\n    // Trigger active, store value\n    context.set('buf', msg.payload);\n    return null;\n}\n\n// Trigger not active, pass on value\nreturn {payload: msg.payload};\n",
        "id": "230bc5d2.7396a2",
        "name": "buffer",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            []
        ],
        "x": 750,
        "y": 180,
        "z": "f7c3f5b1.15af3"
    },
    {
        "checkall": "true",
        "id": "ea4d6784.fc38b",
        "name": "Extract control",
        "outputs": 2,
        "property": "topic",
        "propertyType": "msg",
        "repair": false,
        "rules": [
            {
                "t": "neq",
                "v": "control",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "type": "switch",
        "wires": [
            [
                "230bc5d2.7396a2"
            ],
            [
                "c5472008.083cd8"
            ]
        ],
        "x": 180,
        "y": 180,
        "z": "f7c3f5b1.15af3"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "datatype": "auto",
        "id": "e3a35269.f0e2a8",
        "inputs": 0,
        "name": "ADC value",
        "qos": "2",
        "topic": "devices/0003376b/adc/value",
        "type": "mqtt in",
        "wires": [
            [
                "e3c53bf6.59b448"
            ]
        ],
        "x": 120,
        "y": 60,
        "z": "5d39f6e8.677b6"
    },
    {
        "func": "var value = msg.payload / 1024.0;\nmsg.payload = value.toFixed(3);\nreturn msg;\n",
        "id": "e3c53bf6.59b448",
        "name": "Convert ADC int to float",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "d60f5408.6fe028"
            ]
        ],
        "x": 390,
        "y": 60,
        "z": "5d39f6e8.677b6"
    },
    {
        "format": "{{msg.payload}}",
        "group": "a8db762f.1aeb8",
        "height": "",
        "id": "d60f5408.6fe028",
        "label": "LDR",
        "layout": "",
        "name": "",
        "order": 1,
        "type": "ui_text",
        "width": "",
        "wires": [],
        "x": 670,
        "y": 60,
        "z": "5d39f6e8.677b6"
    },
    {
        "decouple": "false",
        "group": "a8db762f.1aeb8",
        "height": "",
        "id": "d73bac27.181e08",
        "label": "LDR Updating",
        "name": "",
        "offcolor": "",
        "officon": "",
        "offvalue": "0",
        "offvalueType": "str",
        "oncolor": "",
        "onicon": "",
        "onvalue": "250",
        "onvalueType": "str",
        "order": 2,
        "passthru": true,
        "tooltip": "",
        "topic": "control",
        "type": "ui_switch",
        "width": "",
        "wires": [
            [
                "df07bff5.7a5ea8",
                "12f0a97b.0a7c87"
            ]
        ],
        "x": 480,
        "y": 200,
        "z": "5d39f6e8.677b6"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "id": "8bd14e77.90b08",
        "name": "ADC interval set",
        "qos": "2",
        "retain": "false",
        "topic": "devices/0003376b/adc/interval/set",
        "type": "mqtt out",
        "wires": [],
        "x": 980,
        "y": 200,
        "z": "5d39f6e8.677b6"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "datatype": "auto",
        "id": "ae05073.99dba78",
        "inputs": 0,
        "name": "ADC interval",
        "qos": "2",
        "topic": "devices/0003376b/adc/interval",
        "type": "mqtt in",
        "wires": [
            [
                "12f0a97b.0a7c87"
            ]
        ],
        "x": 130,
        "y": 120,
        "z": "5d39f6e8.677b6"
    },
    {
        "func": "rbe",
        "gap": "",
        "id": "df07bff5.7a5ea8",
        "inout": "out",
        "name": "",
        "property": "payload",
        "start": "",
        "type": "rbe",
        "wires": [
            [
                "8bd14e77.90b08"
            ]
        ],
        "x": 690,
        "y": 200,
        "z": "5d39f6e8.677b6"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "datatype": "auto",
        "id": "2d574a7d.3068e6",
        "inputs": 0,
        "name": "Switches",
        "qos": "2",
        "topic": "devices/receiver/+/on",
        "type": "mqtt in",
        "wires": [
            [
                "f5fea1c9.e5474"
            ]
        ],
        "x": 120,
        "y": 420,
        "z": "5d39f6e8.677b6"
    },
    {
        "checkall": "false",
        "id": "f5fea1c9.e5474",
        "name": "Topic switch",
        "outputs": 5,
        "property": "topic",
        "propertyType": "msg",
        "repair": false,
        "rules": [
            {
                "t": "eq",
                "v": "devices/receiver/sw1/on",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "devices/receiver/sw2/on",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "devices/receiver/sw3/on",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "devices/receiver/sw4/on",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "devices/receiver/sw5/on",
                "vt": "str"
            }
        ],
        "type": "switch",
        "wires": [
            [
                "6d313151.b68358"
            ],
            [
                "8d733835.2e0dd"
            ],
            [
                "39503b8b.6da1dc"
            ],
            [
                "a5682b97.6461a"
            ],
            [
                "1ff61dd2.9b6d7a"
            ]
        ],
        "x": 430,
        "y": 420,
        "z": "5d39f6e8.677b6"
    },
    {
        "format": "{{msg.payload}}",
        "group": "2d022f29.4a0f6",
        "height": "",
        "id": "6d313151.b68358",
        "label": "Switch 1",
        "layout": "",
        "name": "",
        "order": 1,
        "type": "ui_text",
        "width": "",
        "wires": [],
        "x": 780,
        "y": 340,
        "z": "5d39f6e8.677b6"
    },
    {
        "format": "{{msg.payload}}",
        "group": "2d022f29.4a0f6",
        "height": "",
        "id": "8d733835.2e0dd",
        "label": "Switch 2",
        "layout": "",
        "name": "",
        "order": 2,
        "type": "ui_text",
        "width": "",
        "wires": [],
        "x": 780,
        "y": 380,
        "z": "5d39f6e8.677b6"
    },
    {
        "format": "{{msg.payload}}",
        "group": "2d022f29.4a0f6",
        "height": "",
        "id": "39503b8b.6da1dc",
        "label": "Switch 3",
        "layout": "",
        "name": "",
        "order": 3,
        "type": "ui_text",
        "width": "",
        "wires": [],
        "x": 780,
        "y": 420,
        "z": "5d39f6e8.677b6"
    },
    {
        "format": "{{msg.payload}}",
        "group": "2d022f29.4a0f6",
        "height": "",
        "id": "a5682b97.6461a",
        "label": "Switch 4",
        "layout": "",
        "name": "",
        "order": 4,
        "type": "ui_text",
        "width": "",
        "wires": [],
        "x": 780,
        "y": 460,
        "z": "5d39f6e8.677b6"
    },
    {
        "format": "{{msg.payload}}",
        "group": "2d022f29.4a0f6",
        "height": "",
        "id": "1ff61dd2.9b6d7a",
        "label": "Switch 5",
        "layout": "",
        "name": "",
        "order": 5,
        "type": "ui_text",
        "width": "",
        "wires": [],
        "x": 780,
        "y": 500,
        "z": "5d39f6e8.677b6"
    },
    {
        "env": [],
        "id": "12f0a97b.0a7c87",
        "name": "",
        "type": "subflow:f7c3f5b1.15af3",
        "wires": [
            [
                "d73bac27.181e08"
            ]
        ],
        "x": 480,
        "y": 120,
        "z": "5d39f6e8.677b6"
    },
    {
        "group": "a8db762f.1aeb8",
        "height": 0,
        "id": "98327496.bfed28",
        "label": "LED strip",
        "max": "2047",
        "min": 0,
        "name": "",
        "order": 5,
        "outs": "all",
        "passthru": true,
        "step": 1,
        "tooltip": "",
        "topic": "",
        "type": "ui_slider",
        "width": 0,
        "wires": [
            [
                "5d56d136.f96c18"
            ]
        ],
        "x": 180,
        "y": 620,
        "z": "5d39f6e8.677b6"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "id": "5d56d136.f96c18",
        "name": "",
        "qos": "2",
        "retain": "false",
        "topic": "/ledstrip1/value/set",
        "type": "mqtt out",
        "wires": [],
        "x": 510,
        "y": 620,
        "z": "5d39f6e8.677b6"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "id": "dbbe7721.83f838",
        "name": "",
        "qos": "2",
        "retain": "false",
        "topic": "/ledstrip1/update",
        "type": "mqtt out",
        "wires": [],
        "x": 510,
        "y": 740,
        "z": "5d39f6e8.677b6"
    },
    {
        "crontab": "",
        "id": "463deb53.e62e44",
        "name": "Update",
        "once": false,
        "onceDelay": 0.1,
        "payload": "true",
        "payloadType": "str",
        "repeat": "",
        "topic": "",
        "type": "inject",
        "wires": [
            [
                "dbbe7721.83f838"
            ]
        ],
        "x": 170,
        "y": 740,
        "z": "5d39f6e8.677b6"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "datatype": "auto",
        "id": "c4d84721.57b068",
        "inputs": 0,
        "name": "Doorbell",
        "qos": "2",
        "topic": "devices/receiver/doorbell/pushed",
        "type": "mqtt in",
        "wires": [
            [
                "6c6af118.4fa65",
                "2c24143f99311a94",
                "5c49c2feef282033"
            ]
        ],
        "x": 140,
        "y": 60,
        "z": "8986fa08.d4999"
    },
    {
        "dname": "",
        "id": "a9244488.d9968",
        "name": "",
        "port": "465",
        "secure": true,
        "server": "smtp.gmail.com",
        "tls": false,
        "type": "e-mail",
        "wires": [],
        "x": 1090,
        "y": 760,
        "z": "8986fa08.d4999"
    },
    {
        "crontab": "",
        "id": "14fe4241.fdab76",
        "name": "Test",
        "once": false,
        "onceDelay": 0.1,
        "payload": "true",
        "payloadType": "str",
        "props": [
            {
                "p": "payload",
                "v": "true",
                "vt": "str"
            },
            {
                "p": "topic",
                "v": "",
                "vt": "str"
            }
        ],
        "repeat": "",
        "topic": "",
        "type": "inject",
        "wires": [
            [
                "3b9016f1.6d2232"
            ]
        ],
        "x": 170,
        "y": 200,
        "z": "8986fa08.d4999"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "id": "3b9016f1.6d2232",
        "name": "",
        "qos": "2",
        "retain": "false",
        "topic": "devices/receiver/doorbell/pushed",
        "type": "mqtt out",
        "wires": [],
        "x": 440,
        "y": 200,
        "z": "8986fa08.d4999"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "id": "c03904e8.eae328",
        "name": "",
        "qos": "2",
        "retain": "true",
        "topic": "devices/3c71bf0c0ad4/display/header/set",
        "type": "mqtt out",
        "wires": [],
        "x": 900,
        "y": 600,
        "z": "8986fa08.d4999"
    },
    {
        "crontab": "",
        "id": "72c315d3.7abf64",
        "name": "",
        "once": false,
        "onceDelay": 0.1,
        "payload": "Hello dragon!",
        "payloadType": "str",
        "repeat": "",
        "topic": "",
        "type": "inject",
        "wires": [
            [
                "c03904e8.eae328"
            ]
        ],
        "x": 490,
        "y": 600,
        "z": "8986fa08.d4999"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "datatype": "utf8",
        "id": "88d8c6a6.33ee2",
        "inputs": 0,
        "name": "Bedroom temp inside",
        "qos": "2",
        "topic": "devices/0085b208/f6011581e788ff28/temperature",
        "type": "mqtt in",
        "wires": [
            [
                "cbc9b8e1.8d4d2"
            ]
        ],
        "x": 180,
        "y": 380,
        "z": "8986fa08.d4999"
    },
    {
        "crontab": "",
        "id": "4dc22ed0.90af3",
        "name": "",
        "once": false,
        "onceDelay": 0.1,
        "payload": "Squeee!",
        "payloadType": "str",
        "repeat": "",
        "topic": "",
        "type": "inject",
        "wires": [
            [
                "c03904e8.eae328"
            ]
        ],
        "x": 480,
        "y": 700,
        "z": "8986fa08.d4999"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "datatype": "utf8",
        "id": "eb748fda.fbcb88",
        "inputs": 0,
        "name": "Bedroom temp outside",
        "qos": "2",
        "topic": "devices/0085b208/c480000003e30d28/temperature",
        "type": "mqtt in",
        "wires": [
            [
                "cbc9b8e1.8d4d2"
            ]
        ],
        "x": 180,
        "y": 480,
        "z": "8986fa08.d4999"
    },
    {
        "func": "if(msg.topic == \"devices/0085b208/f6011581e788ff28/temperature\") {\n    msg.topic = \"bedroom_inside\";\n}\nif(msg.topic == \"devices/0085b208/c480000003e30d28/temperature\") {\n    msg.topic = \"bedroom_outside\";\n}\nif(msg.topic == \"bedroom_outside_api\") {\n    msg.topic = \"bedroom_outside\";\n}\nreturn msg;",
        "id": "cbc9b8e1.8d4d2",
        "name": "Rename topic",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "98a0bd0c.674268"
            ]
        ],
        "x": 440,
        "y": 420,
        "z": "8986fa08.d4999"
    },
    {
        "func": "if(msg.topic == \"bedroom_inside\") {\n    context.temp_inside = msg.payload;\n}\nif(msg.topic == \"bedroom_outside\") {\n    context.temp_outside = msg.payload;\n}\nreturn { \n    payload:\n    Number(context.temp_inside).toFixed(2) + \n    \" / \" +\n    Number(context.temp_outside).toFixed(2),\n    topic: \"temps\"\n}\n",
        "id": "98a0bd0c.674268",
        "name": "To text",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "c03904e8.eae328"
            ]
        ],
        "x": 540,
        "y": 500,
        "z": "8986fa08.d4999"
    },
    {
        "id": "e86fa4f8.ce18e8",
        "links": [
            "fbf9e851.048aa"
        ],
        "name": "",
        "type": "link in",
        "wires": [
            [
                "cbc9b8e1.8d4d2"
            ]
        ],
        "x": 255,
        "y": 600,
        "z": "8986fa08.d4999"
    },
    {
        "audioURI": "/data/ogg/01_-_NeverEnding_Story_-_C64_-_The_NeverEnding_Story.ogg",
        "id": "e2ba0b59.7d901",
        "name": "",
        "options": "{}",
        "playerOptions": "{\"player\": \"ogg123\"}",
        "type": "PlaySound",
        "wires": [
            []
        ],
        "x": 810,
        "y": 80,
        "z": "8986fa08.d4999"
    },
    {
        "id": "3d6328bb.df1c9",
        "info": "wget http://vgmpf.com/Wiki/images/1/15/01_-_NeverEnding_Story_-_C64_-_The_NeverEnding_Story.ogg",
        "name": "File source",
        "type": "comment",
        "wires": [],
        "x": 560,
        "y": 780,
        "z": "8986fa08.d4999"
    },
    {
        "bytopic": "all",
        "duration": "30",
        "extend": true,
        "id": "6c6af118.4fa65",
        "name": "",
        "op1": "start",
        "op1type": "str",
        "op2": "stop",
        "op2type": "str",
        "outputs": 1,
        "overrideDelay": false,
        "reset": "",
        "topic": "topic",
        "type": "trigger",
        "units": "s",
        "wires": [
            [
                "af2a2eca.6e18e8"
            ]
        ],
        "x": 590,
        "y": 60,
        "z": "8986fa08.d4999"
    },
    {
        "audioURI": "/data/mp3/Englishman_In_New_York.mp3",
        "id": "af2a2eca.6e18e8",
        "name": "",
        "options": "{}",
        "playerOptions": "{\"player\": \"mpg123\"}",
        "type": "PlaySound",
        "wires": [
            []
        ],
        "x": 810,
        "y": 140,
        "z": "8986fa08.d4999"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "contentType": "",
        "correl": "",
        "expiry": "",
        "id": "e84a50b41929a9ab",
        "name": "",
        "qos": "2",
        "respTopic": "",
        "retain": "false",
        "topic": "devices/receiver/doorbell/reset",
        "type": "mqtt out",
        "userProps": "",
        "wires": [],
        "x": 430,
        "y": 280,
        "z": "8986fa08.d4999"
    },
    {
        "crontab": "",
        "id": "03eb931f7a6e3479",
        "name": "Test",
        "once": false,
        "onceDelay": 0.1,
        "payload": "true",
        "payloadType": "str",
        "props": [
            {
                "p": "payload",
                "v": "true",
                "vt": "str"
            },
            {
                "p": "topic",
                "v": "",
                "vt": "str"
            }
        ],
        "repeat": "",
        "topic": "",
        "type": "inject",
        "wires": [
            [
                "e84a50b41929a9ab"
            ]
        ],
        "x": 170,
        "y": 280,
        "z": "8986fa08.d4999"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "datatype": "auto",
        "id": "fd7cc3025e3187c6",
        "inputs": 0,
        "name": "Quiet",
        "nl": false,
        "qos": "2",
        "rap": false,
        "topic": "devices/receiver/doorbell/reset",
        "type": "mqtt in",
        "wires": [
            [
                "bab6bf5de35d28d1",
                "8f0dfa83e88b79a9"
            ]
        ],
        "x": 130,
        "y": 140,
        "z": "8986fa08.d4999"
    },
    {
        "action": "",
        "from": "",
        "id": "bab6bf5de35d28d1",
        "name": "",
        "property": "",
        "reg": false,
        "rules": [
            {
                "p": "payload",
                "pt": "msg",
                "t": "set",
                "to": "stop",
                "tot": "str"
            }
        ],
        "to": "",
        "type": "change",
        "wires": [
            [
                "af2a2eca.6e18e8"
            ]
        ],
        "x": 390,
        "y": 140,
        "z": "8986fa08.d4999"
    },
    {
        "action": "",
        "from": "",
        "id": "8f0dfa83e88b79a9",
        "name": "",
        "property": "",
        "reg": false,
        "rules": [
            {
                "p": "reset",
                "pt": "msg",
                "t": "set",
                "to": "true",
                "tot": "str"
            }
        ],
        "to": "",
        "type": "change",
        "wires": [
            [
                "6c6af118.4fa65"
            ]
        ],
        "x": 380,
        "y": 100,
        "z": "8986fa08.d4999"
    },
    {
        "authType": "",
        "id": "403577235f72c130",
        "method": "GET",
        "name": "",
        "paytoqs": "ignore",
        "persist": false,
        "proxy": "",
        "ret": "bin",
        "senderr": false,
        "tls": "",
        "type": "http request",
        "url": "http://192.168.178.132/snapshot.jpg",
        "wires": [
            [
                "7159a09f4d880505"
            ]
        ],
        "x": 490,
        "y": 980,
        "z": "8986fa08.d4999"
    },
    {
        "crontab": "",
        "id": "4a25a4ddb6088865",
        "name": "",
        "once": false,
        "onceDelay": 0.1,
        "payload": "",
        "payloadType": "date",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "topic": "",
        "type": "inject",
        "wires": [
            [
                "403577235f72c130"
            ]
        ],
        "x": 240,
        "y": 980,
        "z": "8986fa08.d4999"
    },
    {
        "action": "",
        "from": "",
        "id": "2c24143f99311a94",
        "name": "Setup mail content",
        "property": "",
        "reg": false,
        "rules": [
            {
                "p": "topic",
                "pt": "msg",
                "t": "set",
                "to": "Doorbell pressed",
                "tot": "str"
            },
            {
                "p": "payload",
                "pt": "msg",
                "t": "set",
                "to": "Ding dong!",
                "tot": "str"
            },
            {
                "p": "to",
                "pt": "msg",
                "t": "set",
                "to": "j.p.cranendonk@gmail.com",
                "tot": "str"
            }
        ],
        "to": "",
        "type": "change",
        "wires": [
            [
                "a9244488.d9968"
            ]
        ],
        "x": 790,
        "y": 780,
        "z": "8986fa08.d4999"
    },
    {
        "finalize": "",
        "func": "const timestamp = Date.now();\n\nvar msg = {\n    payload: `<img src=\"cid:${timestamp}\"/>`,\n    topic: 'Doorbell Camera',\n    to: 'j.p.cranendonk@gmail.com',\n    cid: timestamp,\n    attachments: [{\n        filename: `cam_${new Date().toISOString().replace(/[\\:]/g, '_')}.jpg`,\n        content: msg.payload,\n        cid: timestamp.toString()\n    }]\n}\n\nreturn msg;",
        "id": "7159a09f4d880505",
        "initialize": "",
        "libs": [],
        "name": "",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "a9244488.d9968"
            ]
        ],
        "x": 760,
        "y": 980,
        "z": "8986fa08.d4999"
    },
    {
        "finalize": "",
        "func": "const timestamp = Date.now();\n\nconst captures = flow.get(\"captures\");\n\nconst attachments = captures.map((capture, index) => ({\n                filename: `cam_${new Date().toISOString().replace(/[\\:]/g, '_')}-${index}.jpg`,\n                content: capture,\n                cid: timestamp.toString() + \"-\" + index\n            })\n        );\n\nconst imgs = captures.map((capture, index) => \n            `<img src=\"cid:${timestamp}-${index}\"/>`\n        ).join('<p>');\n\n\nvar msg = {\n    payload: imgs,\n    topic: 'Doorbell Camera',\n    to: 'j.p.cranendonk@gmail.com',\n    cc: 'bibbledragon@gmail.com',\n    cid: timestamp,\n    attachments: attachments\n}\n\nreturn msg;",
        "id": "5d5de18dbf997fc4",
        "initialize": "",
        "libs": [],
        "name": "Captures to mail",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "a9244488.d9968"
            ]
        ],
        "x": 760,
        "y": 1080,
        "z": "8986fa08.d4999"
    },
    {
        "allowrate": false,
        "drop": false,
        "id": "5c49c2feef282033",
        "name": "",
        "nbRateUnits": "1",
        "outputs": 1,
        "pauseType": "delay",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "rate": "1",
        "rateUnits": "second",
        "timeout": "7",
        "timeoutUnits": "seconds",
        "type": "delay",
        "wires": [
            [
                "5d5de18dbf997fc4"
            ]
        ],
        "x": 480,
        "y": 1080,
        "z": "8986fa08.d4999"
    },
    {
        "crontab": "",
        "id": "a08b1e14d617c677",
        "name": "",
        "once": false,
        "onceDelay": 0.1,
        "payload": "",
        "payloadType": "date",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "topic": "",
        "type": "inject",
        "wires": [
            [
                "5c49c2feef282033"
            ]
        ],
        "x": 240,
        "y": 1080,
        "z": "8986fa08.d4999"
    },
    {
        "finalize": "",
        "func": "if (flow.get(\"captures\") === undefined) {\n    flow.set(\"captures\", [])\n}\n\nvar captures = flow.get(\"captures\");\n\ncaptures.push(msg.payload);\nif(captures.length > 20) {\n    captures.shift();\n}\n\nflow.set(\"captures\", captures);\n\nreturn undefined;",
        "id": "32de224822212bc9",
        "initialize": "",
        "libs": [],
        "name": "Store last captures",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            []
        ],
        "x": 1210,
        "y": 1180,
        "z": "8986fa08.d4999"
    },
    {
        "addpay": false,
        "append": "",
        "command": "ffmpeg -an -rtsp_transport tcp -i \"rtsp://admin:@192.168.178.194:554/channel=1_stream=1.sdp?real_stream\" -r 2 -q:v 1 -qmin 1 -qmax 1 -f image2pipe -vcodec mjpeg pipe:1",
        "id": "66574007.74b0c",
        "name": "Decode RTSP stream",
        "oldrc": false,
        "timer": "",
        "type": "exec",
        "useSpawn": "true",
        "winHide": false,
        "wires": [
            [
                "27d6a5c812e209c7",
                "315086cb1d9bff21"
            ],
            [],
            []
        ],
        "x": 720,
        "y": 1180,
        "z": "8986fa08.d4999"
    },
    {
        "crontab": "",
        "id": "7d3aea16.d99b84",
        "name": "Start stream",
        "once": true,
        "onceDelay": "0.5",
        "payload": "",
        "payloadType": "date",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "topic": "",
        "type": "inject",
        "wires": [
            [
                "66574007.74b0c"
            ]
        ],
        "x": 250,
        "y": 1180,
        "z": "8986fa08.d4999"
    },
    {
        "crontab": "",
        "id": "e9cc38bc.4300b8",
        "name": "Pause all streams",
        "once": false,
        "onceDelay": 0.1,
        "payload": "SIGSTOP",
        "payloadType": "str",
        "repeat": "",
        "topic": "",
        "type": "inject",
        "wires": [
            [
                "53b625e3.eee7bc"
            ]
        ],
        "x": 270,
        "y": 1220,
        "z": "8986fa08.d4999"
    },
    {
        "crontab": "",
        "id": "4bdb02b2.c73efc",
        "name": "Resume all streams",
        "once": false,
        "onceDelay": 0.1,
        "payload": "SIGCONT",
        "payloadType": "str",
        "repeat": "",
        "topic": "",
        "type": "inject",
        "wires": [
            [
                "53b625e3.eee7bc"
            ]
        ],
        "x": 270,
        "y": 1260,
        "z": "8986fa08.d4999"
    },
    {
        "action": "",
        "from": "",
        "id": "53b625e3.eee7bc",
        "name": "",
        "property": "",
        "reg": false,
        "rules": [
            {
                "p": "kill",
                "pt": "msg",
                "t": "set",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "to": "",
        "type": "change",
        "wires": [
            [
                "66574007.74b0c"
            ]
        ],
        "x": 490,
        "y": 1220,
        "z": "8986fa08.d4999"
    },
    {
        "crontab": "",
        "id": "c6743afd.82d568",
        "name": "Stop all streams",
        "once": false,
        "onceDelay": 0.1,
        "payload": "SIGTERM",
        "payloadType": "str",
        "props": [
            {
                "p": "payload",
                "v": "SIGTERM",
                "vt": "str"
            },
            {
                "p": "topic",
                "v": "",
                "vt": "str"
            }
        ],
        "repeat": "",
        "topic": "",
        "type": "inject",
        "wires": [
            [
                "53b625e3.eee7bc"
            ]
        ],
        "x": 260,
        "y": 1300,
        "z": "8986fa08.d4999"
    },
    {
        "id": "27d6a5c812e209c7",
        "name": "",
        "type": "pipe2jpeg",
        "wires": [
            [
                "32de224822212bc9"
            ]
        ],
        "x": 980,
        "y": 1180,
        "z": "8986fa08.d4999"
    },
    {
        "finalize": "",
        "func": "var msgCount = context.get(\"msgCount\") || 0;\n\nmsgCount++;\nnode.status(\"Count: \" + msgCount);\n\ncontext.set(\"msgCount\", msgCount);\n",
        "id": "315086cb1d9bff21",
        "initialize": "",
        "libs": [],
        "name": "",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            []
        ],
        "x": 980,
        "y": 1260,
        "z": "8986fa08.d4999"
    },
    {
        "group": "c8a54de6.369ff",
        "height": "",
        "id": "96da407e.693bd",
        "label": "NeoPixels brightness",
        "max": "1000",
        "min": 0,
        "name": "",
        "order": 3,
        "passthru": true,
        "step": "",
        "topic": "control",
        "type": "ui_slider",
        "width": "",
        "wires": [
            [
                "916ff53a.0cf9",
                "6b6427a5.2800c8"
            ]
        ],
        "x": 580,
        "y": 680,
        "z": "9122054e.29969"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "id": "c7b94c19.990b2",
        "name": "Lightshow brightness set",
        "qos": "2",
        "retain": "false",
        "topic": "control/lightshow/brightness/set",
        "type": "mqtt out",
        "wires": [],
        "x": 990,
        "y": 680,
        "z": "9122054e.29969"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "datatype": "auto",
        "id": "76d31ffb.217c88",
        "inputs": 0,
        "name": "Lightshow brightness",
        "qos": "2",
        "topic": "control/lightshow/brightness",
        "type": "mqtt in",
        "wires": [
            [
                "abc768.a7798098",
                "84ccb865.9d687",
                "6b6427a5.2800c8"
            ]
        ],
        "x": 120,
        "y": 680,
        "z": "9122054e.29969"
    },
    {
        "format": "{{msg.payload}}",
        "group": "c8a54de6.369ff",
        "height": "",
        "id": "abc768.a7798098",
        "label": "NeoPixels brightness",
        "layout": "",
        "name": "",
        "order": 4,
        "type": "ui_text",
        "width": "",
        "wires": [],
        "x": 580,
        "y": 740,
        "z": "9122054e.29969"
    },
    {
        "func": "rbe",
        "gap": "",
        "id": "916ff53a.0cf9",
        "inout": "out",
        "name": "",
        "start": "",
        "type": "rbe",
        "wires": [
            [
                "c7b94c19.990b2"
            ]
        ],
        "x": 790,
        "y": 680,
        "z": "9122054e.29969"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "datatype": "auto",
        "id": "bcf8dcb6.286228",
        "inputs": 0,
        "name": "Switches",
        "qos": "2",
        "topic": "devices/receiver/+/+",
        "type": "mqtt in",
        "wires": [
            [
                "cfdf0ee.92e14f"
            ]
        ],
        "x": 80,
        "y": 320,
        "z": "9122054e.29969"
    },
    {
        "checkall": "false",
        "id": "cfdf0ee.92e14f",
        "name": "Topic switch",
        "outputs": 6,
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "devices/receiver/sw1/pulse_on",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "devices/receiver/sw1/pulse_off",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "devices/receiver/sw2/pulse_on",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "devices/receiver/sw2/pulse_off",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "devices/receiver/sw3/pulse_on",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "devices/receiver/sw3/pulse_off",
                "vt": "str"
            }
        ],
        "type": "switch",
        "wires": [
            [],
            [],
            [
                "ed72dcb2.f574e8"
            ],
            [
                "5856ee01.86b508"
            ],
            [
                "ea531c98.d9c8"
            ],
            [
                "e316f32b.1c3e98"
            ]
        ],
        "x": 290,
        "y": 320,
        "z": "9122054e.29969"
    },
    {
        "allowrate": false,
        "drop": true,
        "id": "ed72dcb2.f574e8",
        "name": "",
        "nbRateUnits": "",
        "outputs": 1,
        "pauseType": "rate",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "rate": "2",
        "rateUnits": "second",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "type": "delay",
        "wires": [
            [
                "7ab5ba66.a60f8c"
            ]
        ],
        "x": 510,
        "y": 220,
        "z": "9122054e.29969"
    },
    {
        "allowrate": false,
        "drop": true,
        "id": "5856ee01.86b508",
        "name": "",
        "nbRateUnits": "",
        "outputs": 1,
        "pauseType": "rate",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "rate": "2",
        "rateUnits": "second",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "type": "delay",
        "wires": [
            [
                "7ab5ba66.a60f8c"
            ]
        ],
        "x": 510,
        "y": 280,
        "z": "9122054e.29969"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "id": "d06c9c5d.fe3d7",
        "inputs": 0,
        "name": "Modes",
        "qos": "2",
        "topic": "control/lightshow/mode/available",
        "type": "mqtt in",
        "wires": [
            [
                "7ab5ba66.a60f8c"
            ]
        ],
        "x": 590,
        "y": 160,
        "z": "9122054e.29969"
    },
    {
        "func": "if(msg.topic == \"control/lightshow/mode/available\") {\n    context.lightshow_modes = msg.payload;\n} else {\n    if(!context.lightshow_modes) {\n        return;\n    }\n\n    if(!context.lightshow_mode) {\n        context.lightshow_mode = 0;\n    }\n\n    var modes = context.lightshow_modes.split(\",\"); \n\n    if(msg.topic == \"devices/receiver/sw2/pulse_on\") {\n        context.lightshow_mode--;\n    } else if(msg.topic == \"devices/receiver/sw2/pulse_off\") {\n        context.lightshow_mode++;\n    }\n    \n    if(context.lightshow_mode >= modes.length) {\n        context.lightshow_mode = modes.length - 1;\n    }\n    if(context.lightshow_mode < 0) {\n        context.lightshow_mode = 0;\n    }\n\n    return { \n        payload: modes[context.lightshow_mode],\n        topic: \"mode\" \n    }\n\n}\n",
        "id": "7ab5ba66.a60f8c",
        "name": "Mode selector",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "4c4ca351.b7673c"
            ]
        ],
        "x": 780,
        "y": 260,
        "z": "9122054e.29969"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "id": "4c4ca351.b7673c",
        "name": "Mode set",
        "qos": "2",
        "retain": "false",
        "topic": "control/lightshow/mode/set",
        "type": "mqtt out",
        "wires": [],
        "x": 1000,
        "y": 260,
        "z": "9122054e.29969"
    },
    {
        "func": "if(msg.topic == \"control/lightshow/brightness\") {\n    context.lightshow_brightness = Number(msg.payload);\n} else {\n    if(!context.lightshow_brightness) {\n        context.lightshow_brightness = 0;\n    }\n\n    if(msg.topic == \"devices/receiver/sw3/pulse_on\") {\n        context.lightshow_brightness -= 50;\n    } else if(msg.topic == \"devices/receiver/sw3/pulse_off\") {\n        context.lightshow_brightness += 50;\n    }\n    \n    if(context.lightshow_brightness > 1000) {\n        context.lightshow_brightness = 1000;\n    }\n    if(context.lightshow_brightness < 0) {\n        context.lightshow_brightness = 0;\n    }\n\n    return { \n        payload: context.lightshow_brightness,\n        topic: \"brightness\" \n    }\n\n}\n",
        "id": "84ccb865.9d687",
        "name": "Brightness",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "c7b94c19.990b2"
            ]
        ],
        "x": 590,
        "y": 480,
        "z": "9122054e.29969"
    },
    {
        "allowrate": false,
        "drop": true,
        "id": "e316f32b.1c3e98",
        "name": "",
        "nbRateUnits": "",
        "outputs": 1,
        "pauseType": "rate",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "rate": "4",
        "rateUnits": "second",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "type": "delay",
        "wires": [
            [
                "84ccb865.9d687"
            ]
        ],
        "x": 510,
        "y": 400,
        "z": "9122054e.29969"
    },
    {
        "allowrate": false,
        "drop": true,
        "id": "ea531c98.d9c8",
        "name": "",
        "nbRateUnits": "",
        "outputs": 1,
        "pauseType": "rate",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "rate": "4",
        "rateUnits": "second",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "type": "delay",
        "wires": [
            [
                "84ccb865.9d687"
            ]
        ],
        "x": 510,
        "y": 360,
        "z": "9122054e.29969"
    },
    {
        "func": "msg.payload = msg.payload / 1000;\nreturn msg;",
        "id": "58ce017f.25cf98",
        "name": "DIV/1000",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "ca477a98.62fb98"
            ]
        ],
        "x": 300,
        "y": 900,
        "z": "9122054e.29969"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "datatype": "auto",
        "id": "8cdd6b92.5f4b9",
        "inputs": 0,
        "name": "Lightshow period",
        "qos": "2",
        "topic": "control/lightshow/period",
        "type": "mqtt in",
        "wires": [
            [
                "58ce017f.25cf98"
            ]
        ],
        "x": 100,
        "y": 900,
        "z": "9122054e.29969"
    },
    {
        "group": "c8a54de6.369ff",
        "height": "",
        "id": "a4bb9eac.deacf",
        "label": "Neopixels period",
        "max": "1000",
        "min": "4",
        "name": "",
        "order": 5,
        "passthru": true,
        "step": "",
        "topic": "control",
        "type": "ui_slider",
        "width": "",
        "wires": [
            [
                "d419c385.5ddb88",
                "d56a4401.f3bf68",
                "ca477a98.62fb98"
            ]
        ],
        "x": 590,
        "y": 900,
        "z": "9122054e.29969"
    },
    {
        "func": "rbe",
        "gap": "",
        "id": "d419c385.5ddb88",
        "inout": "out",
        "name": "",
        "start": "",
        "type": "rbe",
        "wires": [
            [
                "c21b7cad.94af88"
            ]
        ],
        "x": 530,
        "y": 980,
        "z": "9122054e.29969"
    },
    {
        "format": "{{msg.payload}} ms",
        "group": "c8a54de6.369ff",
        "height": "",
        "id": "d56a4401.f3bf68",
        "label": "NeoPixels period",
        "layout": "",
        "name": "",
        "order": 6,
        "type": "ui_text",
        "width": "",
        "wires": [],
        "x": 910,
        "y": 900,
        "z": "9122054e.29969"
    },
    {
        "func": "msg.payload = msg.payload * 1000;\nreturn msg;",
        "id": "c21b7cad.94af88",
        "name": "MUL*1000",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "f4047c92.152c1"
            ]
        ],
        "x": 690,
        "y": 980,
        "z": "9122054e.29969"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "id": "f4047c92.152c1",
        "name": "Lightshow period set",
        "qos": "2",
        "retain": "false",
        "topic": "control/lightshow/period/set",
        "type": "mqtt out",
        "wires": [],
        "x": 900,
        "y": 980,
        "z": "9122054e.29969"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "id": "cf41f475.a86388",
        "inputs": 0,
        "name": "Switch 1",
        "qos": "2",
        "topic": "devices/receiver/sw1/on",
        "type": "mqtt in",
        "wires": [
            [
                "6952c8aa.dc7d6"
            ]
        ],
        "x": 100,
        "y": 1180,
        "z": "9122054e.29969"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "id": "6952c8aa.dc7d6",
        "name": "NeoPixels on set",
        "qos": "2",
        "retain": "false",
        "topic": "devices/0003376b/light/on/set",
        "type": "mqtt out",
        "wires": [],
        "x": 970,
        "y": 1180,
        "z": "9122054e.29969"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "datatype": "auto",
        "id": "e9e43a0f.2b041",
        "inputs": 0,
        "name": "NeoPixels uptime",
        "qos": "2",
        "topic": "devices/0003376b/$uptime",
        "type": "mqtt in",
        "wires": [
            [
                "aec9db8e.b966a"
            ]
        ],
        "x": 100,
        "y": 80,
        "z": "9122054e.29969"
    },
    {
        "func": "var s = msg.payload;\nvar m = Math.floor(s / 60);\nvar s = s % 60;\nvar h = Math.floor(m / 60);\nvar  m = m % 60;\nvar  d = Math.floor(h / 24);\nvar  h = h % 24;\nmsg.payload = d +\"d \";\nmsg.payload += h + \"h \";\nmsg.payload += m + \"m \";\nmsg.payload += s + \"s\";\nreturn msg;",
        "id": "aec9db8e.b966a",
        "name": "Format seconds",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "bdc2750a.19d32"
            ]
        ],
        "x": 360,
        "y": 80,
        "z": "9122054e.29969"
    },
    {
        "format": "{{msg.payload}}",
        "group": "c8a54de6.369ff",
        "height": "",
        "id": "bdc2750a.19d32",
        "label": "NeoPixels uptime",
        "layout": "",
        "name": "",
        "order": 8,
        "type": "ui_text",
        "width": "",
        "wires": [],
        "x": 630,
        "y": 80,
        "z": "9122054e.29969"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "datatype": "auto",
        "id": "ca16c2ed.464bd8",
        "inputs": 0,
        "name": "NeoPixels onine",
        "qos": "2",
        "topic": "devices/0003376b/$online",
        "type": "mqtt in",
        "wires": [
            [
                "8aae44ac.f2ab7"
            ]
        ],
        "x": 100,
        "y": 40,
        "z": "9122054e.29969"
    },
    {
        "format": "{{msg.payload}}",
        "group": "c8a54de6.369ff",
        "height": "",
        "id": "8aae44ac.f2ab7",
        "label": "NeoPixels online",
        "layout": "",
        "name": "",
        "order": 2,
        "type": "ui_text",
        "width": "",
        "wires": [],
        "x": 640,
        "y": 40,
        "z": "9122054e.29969"
    },
    {
        "decouple": "false",
        "group": "c8a54de6.369ff",
        "height": "",
        "id": "2c680e99.70e122",
        "label": "NeoPixels On",
        "name": "",
        "offcolor": "",
        "officon": "",
        "offvalue": "false",
        "offvalueType": "str",
        "oncolor": "",
        "onicon": "",
        "onvalue": "true",
        "onvalueType": "str",
        "order": 1,
        "passthru": true,
        "topic": "control",
        "type": "ui_switch",
        "width": "",
        "wires": [
            [
                "28f1fc7b.ad001c",
                "267712fa.70c8ee"
            ]
        ],
        "x": 540,
        "y": 1340,
        "z": "9122054e.29969"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "datatype": "auto",
        "id": "3657984a.46d8b8",
        "inputs": 0,
        "name": "NeoPixels state",
        "qos": "2",
        "topic": "devices/0003376b/light/on",
        "type": "mqtt in",
        "wires": [
            [
                "267712fa.70c8ee"
            ]
        ],
        "x": 120,
        "y": 1340,
        "z": "9122054e.29969"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "id": "8ff7841b.88307",
        "name": "NeoPixels on set",
        "qos": "2",
        "retain": "false",
        "topic": "devices/0003376b/light/on/set",
        "type": "mqtt out",
        "wires": [],
        "x": 970,
        "y": 1340,
        "z": "9122054e.29969"
    },
    {
        "func": "rbe",
        "gap": "",
        "id": "28f1fc7b.ad001c",
        "inout": "out",
        "name": "",
        "start": "",
        "type": "rbe",
        "wires": [
            [
                "8ff7841b.88307"
            ]
        ],
        "x": 750,
        "y": 1340,
        "z": "9122054e.29969"
    },
    {
        "id": "267712fa.70c8ee",
        "name": "",
        "type": "subflow:f7c3f5b1.15af3",
        "wires": [
            [
                "2c680e99.70e122"
            ]
        ],
        "x": 540,
        "y": 1260,
        "z": "9122054e.29969"
    },
    {
        "id": "6b6427a5.2800c8",
        "name": "",
        "type": "subflow:f7c3f5b1.15af3",
        "wires": [
            [
                "96da407e.693bd"
            ]
        ],
        "x": 580,
        "y": 600,
        "z": "9122054e.29969"
    },
    {
        "id": "ca477a98.62fb98",
        "name": "",
        "type": "subflow:f7c3f5b1.15af3",
        "wires": [
            [
                "a4bb9eac.deacf"
            ]
        ],
        "x": 580,
        "y": 840,
        "z": "9122054e.29969"
    },
    {
        "format": "{{msg.payload}}",
        "group": "c8a54de6.369ff",
        "height": "",
        "id": "4f604ef9.95e5f",
        "label": "NeoPixels mode",
        "layout": "",
        "name": "",
        "order": 7,
        "type": "ui_text",
        "width": "",
        "wires": [],
        "x": 980,
        "y": 380,
        "z": "9122054e.29969"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "id": "a8a2f458.a6a0a8",
        "inputs": 0,
        "name": "",
        "qos": "2",
        "topic": "control/lightshow/mode",
        "type": "mqtt in",
        "wires": [
            [
                "4f604ef9.95e5f"
            ]
        ],
        "x": 740,
        "y": 380,
        "z": "9122054e.29969"
    },
    {
        "format": "{{msg.payload}} &deg;",
        "group": "ddd0fc4c.8a5e8",
        "height": "",
        "id": "604cef75.b38078",
        "label": "Inside temperature",
        "layout": "",
        "name": "",
        "order": 1,
        "type": "ui_text",
        "width": "",
        "wires": [],
        "x": 770,
        "y": 520,
        "z": "459a3a0f.cadb4c"
    },
    {
        "format": "{{msg.payload}} &deg;",
        "group": "ddd0fc4c.8a5e8",
        "height": "",
        "id": "3cbd8bbc.be75a4",
        "label": "Outside temperature",
        "layout": "",
        "name": "",
        "order": 2,
        "type": "ui_text",
        "width": "",
        "wires": [],
        "x": 760,
        "y": 580,
        "z": "459a3a0f.cadb4c"
    },
    {
        "format": "{{msg.payload}}",
        "group": "ddd0fc4c.8a5e8",
        "height": "",
        "id": "a40ae4f5.d4a528",
        "label": "Window",
        "layout": "",
        "name": "",
        "order": 4,
        "type": "ui_text",
        "width": "",
        "wires": [],
        "x": 1060,
        "y": 260,
        "z": "459a3a0f.cadb4c"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "datatype": "auto",
        "id": "83ac489b.6336",
        "inputs": 0,
        "name": "Bedroom window state",
        "qos": "2",
        "topic": "control/window/status",
        "type": "mqtt in",
        "wires": [
            [
                "a40ae4f5.d4a528",
                "3e06b492.64bde4"
            ]
        ],
        "x": 120,
        "y": 300,
        "z": "459a3a0f.cadb4c"
    },
    {
        "func": "if(msg.topic == \"bedroom_inside\") {\n    context.temp_inside = msg.payload;\n}\nif(msg.topic == \"bedroom_outside\") {\n    context.temp_outside = msg.payload;\n}\nreturn { \n    payload: context.temp_outside - context.temp_inside,\n    topic: \"bedroom_diff\" \n}\n\nreturn msg;\n",
        "id": "5917594a.b2888",
        "name": "Get temp diff",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "f6b45c8d.dbadf",
                "11c77aec.a29e85"
            ]
        ],
        "x": 410,
        "y": 460,
        "z": "459a3a0f.cadb4c"
    },
    {
        "format": "{{msg.payload}} &deg;",
        "group": "ddd0fc4c.8a5e8",
        "height": "",
        "id": "f6b45c8d.dbadf",
        "label": "Temperature difference",
        "layout": "",
        "name": "",
        "order": 3,
        "type": "ui_text",
        "width": "",
        "wires": [],
        "x": 1010,
        "y": 400,
        "z": "459a3a0f.cadb4c"
    },
    {
        "finalize": "",
        "func": "if(msg.topic == \"011581E788FF\") {\n    msg.topic = \"bedroom_inside\";\n}\nif(msg.topic == \"devices/0085b208/f6011581e788ff28/temperature\") {\n    msg.topic = \"bedroom_inside\";\n}\nif(msg.topic == \"0119363CACBD\") {\n    msg.topic = \"bedroom_outside\";\n}\nif(msg.topic == \"devices/00d39493/0f041654733cff28/temperature\") {\n    msg.topic = \"new1\";\n}\nif(msg.topic == \"devices/00d39493/f6041653f20bff28/temperature\") {\n    msg.topic = \"new2\";\n}\n\nreturn msg;",
        "id": "f97ef03a.7bc198",
        "initialize": "",
        "name": "Rename topic",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "9fcacdd2.81043",
                "5917594a.b2888",
                "3763749a.0336c4"
            ]
        ],
        "x": 120,
        "y": 560,
        "z": "459a3a0f.cadb4c"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "datatype": "auto",
        "id": "c7709fe7.534e8",
        "inputs": 0,
        "name": "Temps",
        "qos": "2",
        "topic": "devices/+/+/temperature",
        "type": "mqtt in",
        "wires": [
            [
                "f97ef03a.7bc198"
            ]
        ],
        "x": 70,
        "y": 460,
        "z": "459a3a0f.cadb4c"
    },
    {
        "checkall": "false",
        "id": "9fcacdd2.81043",
        "name": "Topic switch",
        "outputs": 4,
        "property": "topic",
        "propertyType": "msg",
        "repair": false,
        "rules": [
            {
                "t": "eq",
                "v": "bedroom_inside",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "bedroom_outside",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "new1",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "new2",
                "vt": "str"
            }
        ],
        "type": "switch",
        "wires": [
            [
                "604cef75.b38078",
                "6157c121.0384c",
                "9f5ee269.aa415",
                "286c7c9.fa72604",
                "fbf9e851.048aa",
                "5f2324b3.478a74"
            ],
            [
                "3cbd8bbc.be75a4",
                "2d62e132.9fb69e",
                "e94bf9b0.85f8b",
                "5fcb77f4.ed6328"
            ],
            [
                "f78eacdf.866578"
            ],
            [
                "4a79422.e21503c"
            ]
        ],
        "x": 130,
        "y": 700,
        "z": "459a3a0f.cadb4c"
    },
    {
        "chartType": "line",
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "cutout": "",
        "dot": false,
        "group": "ddd0fc4c.8a5e8",
        "height": "0",
        "id": "e3fef250.c6848",
        "interpolate": "linear",
        "label": "",
        "name": "Temps",
        "nodata": "No Data",
        "order": 9,
        "outputs": 1,
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "86400",
        "type": "ui_chart",
        "useOneColor": false,
        "useUTC": false,
        "width": "0",
        "wires": [
            []
        ],
        "x": 810,
        "xformat": "HH:mm:ss",
        "y": 760,
        "ymax": "",
        "ymin": "",
        "z": "459a3a0f.cadb4c"
    },
    {
        "drop": true,
        "id": "2d62e132.9fb69e",
        "name": "",
        "nbRateUnits": "",
        "outputs": 1,
        "pauseType": "rate",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "rate": "12",
        "rateUnits": "hour",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "type": "delay",
        "wires": [
            [
                "e3fef250.c6848",
                "becb99e4.ad3498"
            ]
        ],
        "x": 420,
        "y": 800,
        "z": "459a3a0f.cadb4c"
    },
    {
        "drop": true,
        "id": "6157c121.0384c",
        "name": "",
        "nbRateUnits": "",
        "outputs": 1,
        "pauseType": "rate",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "rate": "12",
        "rateUnits": "hour",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "type": "delay",
        "wires": [
            [
                "e3fef250.c6848",
                "becb99e4.ad3498"
            ]
        ],
        "x": 420,
        "y": 760,
        "z": "459a3a0f.cadb4c"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "datatype": "auto",
        "id": "10ab9a18.c4d2fe",
        "inputs": 0,
        "name": "Sensors online",
        "qos": "2",
        "topic": "devices/0085b208/$online",
        "type": "mqtt in",
        "wires": [
            [
                "19e5bc30.506174"
            ]
        ],
        "x": 100,
        "y": 40,
        "z": "459a3a0f.cadb4c"
    },
    {
        "format": "{{msg.payload}}",
        "group": "ddd0fc4c.8a5e8",
        "height": "",
        "id": "19e5bc30.506174",
        "label": "Sensors online",
        "layout": "",
        "name": "",
        "order": 6,
        "type": "ui_text",
        "width": "",
        "wires": [],
        "x": 780,
        "y": 40,
        "z": "459a3a0f.cadb4c"
    },
    {
        "chartType": "line",
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "cutout": "",
        "dot": false,
        "group": "a8db762f.1aeb8",
        "height": "",
        "id": "7efb3fd.a0dea4",
        "interpolate": "linear",
        "label": "",
        "name": "Temps",
        "nodata": "No Data",
        "order": 3,
        "outputs": 1,
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "86400",
        "type": "ui_chart",
        "useOneColor": false,
        "useUTC": false,
        "width": "",
        "wires": [
            []
        ],
        "x": 690,
        "xformat": "HH:mm:ss",
        "y": 920,
        "ymax": "",
        "ymin": "",
        "z": "459a3a0f.cadb4c"
    },
    {
        "drop": true,
        "id": "4a79422.e21503c",
        "name": "",
        "nbRateUnits": "",
        "outputs": 1,
        "pauseType": "rate",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "rate": "12",
        "rateUnits": "hour",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "type": "delay",
        "wires": [
            [
                "7efb3fd.a0dea4"
            ]
        ],
        "x": 420,
        "y": 940,
        "z": "459a3a0f.cadb4c"
    },
    {
        "drop": true,
        "id": "f78eacdf.866578",
        "name": "",
        "nbRateUnits": "",
        "outputs": 1,
        "pauseType": "rate",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "rate": "12",
        "rateUnits": "hour",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "type": "delay",
        "wires": [
            [
                "7efb3fd.a0dea4"
            ]
        ],
        "x": 420,
        "y": 900,
        "z": "459a3a0f.cadb4c"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "datatype": "auto",
        "id": "36ff733.e6e650c",
        "inputs": 0,
        "name": "Bedroom fan state",
        "qos": "2",
        "topic": "devices/0081b173/light/on",
        "type": "mqtt in",
        "wires": [
            [
                "99fbff09.f2e09"
            ]
        ],
        "x": 110,
        "y": 220,
        "z": "459a3a0f.cadb4c"
    },
    {
        "format": "{{msg.payload}}",
        "group": "ddd0fc4c.8a5e8",
        "height": "",
        "id": "99fbff09.f2e09",
        "label": "Fan on",
        "layout": "",
        "name": "",
        "order": 5,
        "type": "ui_text",
        "width": "",
        "wires": [],
        "x": 800,
        "y": 220,
        "z": "459a3a0f.cadb4c"
    },
    {
        "chartType": "line",
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "cutout": "",
        "dot": false,
        "group": "58ffad67.aac28c",
        "height": "0",
        "id": "becb99e4.ad3498",
        "interpolate": "linear",
        "label": "",
        "legend": "true",
        "name": "Temps Big Bedroom",
        "nodata": "No Data",
        "order": 5,
        "outputs": 1,
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "86400",
        "type": "ui_chart",
        "useOneColor": false,
        "useUTC": false,
        "width": "0",
        "wires": [
            []
        ],
        "x": 1020,
        "xformat": "HH:mm:ss",
        "y": 800,
        "ymax": "",
        "ymin": "",
        "z": "459a3a0f.cadb4c"
    },
    {
        "format": "{{msg.payload}} &deg;",
        "group": "58ffad67.aac28c",
        "height": "1",
        "id": "9f5ee269.aa415",
        "label": "Inside temperature",
        "layout": "col-center",
        "name": "",
        "order": 1,
        "type": "ui_text",
        "width": "6",
        "wires": [],
        "x": 1030,
        "y": 540,
        "z": "459a3a0f.cadb4c"
    },
    {
        "format": "{{msg.payload}} &deg;",
        "group": "58ffad67.aac28c",
        "height": "1",
        "id": "e94bf9b0.85f8b",
        "label": "Outside temperature",
        "layout": "col-center",
        "name": "",
        "order": 2,
        "type": "ui_text",
        "width": "6",
        "wires": [],
        "x": 1020,
        "y": 600,
        "z": "459a3a0f.cadb4c"
    },
    {
        "format": "{{msg.payload}} &deg;",
        "group": "58ffad67.aac28c",
        "height": "1",
        "id": "11c77aec.a29e85",
        "label": "Temperature difference",
        "layout": "col-center",
        "name": "",
        "order": 3,
        "type": "ui_text",
        "width": "6",
        "wires": [],
        "x": 1010,
        "y": 460,
        "z": "459a3a0f.cadb4c"
    },
    {
        "format": "{{msg.payload}}",
        "group": "58ffad67.aac28c",
        "height": "1",
        "id": "3e06b492.64bde4",
        "label": "Window",
        "layout": "col-center",
        "name": "",
        "order": 4,
        "type": "ui_text",
        "width": "6",
        "wires": [],
        "x": 1060,
        "y": 320,
        "z": "459a3a0f.cadb4c"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "datatype": "auto",
        "id": "d399f16f.11c548",
        "inputs": 0,
        "name": "Sensors uptime",
        "qos": "2",
        "topic": "devices/0085b208/$uptime",
        "type": "mqtt in",
        "wires": [
            [
                "1eebc888.9549bf"
            ]
        ],
        "x": 100,
        "y": 100,
        "z": "459a3a0f.cadb4c"
    },
    {
        "func": "var s = msg.payload;\nvar m = Math.floor(s / 60);\nvar s = s % 60;\nvar h = Math.floor(m / 60);\nvar  m = m % 60;\nvar  d = Math.floor(h / 24);\nvar  h = h % 24;\nmsg.payload = d +\"d \";\nmsg.payload += h + \"h \";\nmsg.payload += m + \"m \";\nmsg.payload += s + \"s\";\nreturn msg;",
        "id": "1eebc888.9549bf",
        "name": "Format seconds",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "e3b5c7ad.27665"
            ]
        ],
        "x": 340,
        "y": 100,
        "z": "459a3a0f.cadb4c"
    },
    {
        "format": "{{msg.payload}}",
        "group": "ddd0fc4c.8a5e8",
        "height": "",
        "id": "e3b5c7ad.27665",
        "label": "Sensors uptime",
        "layout": "",
        "name": "",
        "order": 7,
        "type": "ui_text",
        "width": "",
        "wires": [],
        "x": 780,
        "y": 100,
        "z": "459a3a0f.cadb4c"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "datatype": "auto",
        "id": "5be6727d.bd676c",
        "inputs": 0,
        "name": "Bedroom fan online",
        "qos": "2",
        "topic": "devices/0081b173/$online",
        "type": "mqtt in",
        "wires": [
            [
                "2d116991.e72a16"
            ]
        ],
        "x": 110,
        "y": 160,
        "z": "459a3a0f.cadb4c"
    },
    {
        "format": "{{msg.payload}}",
        "group": "ddd0fc4c.8a5e8",
        "height": "",
        "id": "2d116991.e72a16",
        "label": "Relay online",
        "layout": "",
        "name": "",
        "order": 8,
        "type": "ui_text",
        "width": "",
        "wires": [],
        "x": 790,
        "y": 160,
        "z": "459a3a0f.cadb4c"
    },
    {
        "id": "5c52590f.161f5",
        "info": "",
        "name": "TODO: How to persist charts over restart",
        "type": "comment",
        "wires": [],
        "x": 940,
        "y": 680,
        "z": "459a3a0f.cadb4c"
    },
    {
        "id": "462ae5be.8a045c",
        "name": "Openweathermap API key",
        "props": [
            {
                "type": "msg",
                "value": "openweather_api_key"
            }
        ],
        "type": "credentials",
        "wires": [
            [
                "8ded4e0b.24ee58"
            ]
        ],
        "x": 350,
        "y": 1120,
        "z": "459a3a0f.cadb4c"
    },
    {
        "crontab": "",
        "id": "46c47065.e8d9b",
        "name": "Every 5 min",
        "once": true,
        "onceDelay": "0.0",
        "payload": "",
        "payloadType": "date",
        "repeat": "300",
        "topic": "",
        "type": "inject",
        "wires": [
            [
                "462ae5be.8a045c"
            ]
        ],
        "x": 130,
        "y": 1120,
        "z": "459a3a0f.cadb4c"
    },
    {
        "authType": "",
        "id": "8ded4e0b.24ee58",
        "method": "GET",
        "name": "",
        "paytoqs": false,
        "persist": false,
        "proxy": "",
        "ret": "txt",
        "tls": "",
        "type": "http request",
        "url": "http://api.openweathermap.org/data/2.5/weather?q=Landsmeer,nl&units=metric&appid={{openweather_api_key}}",
        "wires": [
            [
                "deeb61a7.33ece8"
            ]
        ],
        "x": 570,
        "y": 1120,
        "z": "459a3a0f.cadb4c"
    },
    {
        "format": "{{msg.payload}} &deg;",
        "group": "ddd0fc4c.8a5e8",
        "height": "",
        "id": "88237972.7eca18",
        "label": "Outside temperature(api)",
        "layout": "",
        "name": "",
        "order": 2,
        "type": "ui_text",
        "width": "",
        "wires": [],
        "x": 1010,
        "y": 1040,
        "z": "459a3a0f.cadb4c"
    },
    {
        "action": "",
        "id": "deeb61a7.33ece8",
        "name": "",
        "pretty": false,
        "property": "payload",
        "type": "json",
        "wires": [
            [
                "29f31f7d.91605"
            ]
        ],
        "x": 590,
        "y": 1040,
        "z": "459a3a0f.cadb4c"
    },
    {
        "action": "",
        "from": "",
        "id": "29f31f7d.91605",
        "name": "Get temp",
        "property": "",
        "reg": false,
        "rules": [
            {
                "p": "payload",
                "pt": "msg",
                "t": "set",
                "to": "payload.main.temp",
                "tot": "msg"
            },
            {
                "p": "topic",
                "pt": "msg",
                "t": "set",
                "to": "bedroom_outside_api",
                "tot": "str"
            }
        ],
        "to": "",
        "type": "change",
        "wires": [
            [
                "88237972.7eca18",
                "e3fef250.c6848",
                "286c7c9.fa72604",
                "becb99e4.ad3498",
                "3cbd8bbc.be75a4",
                "e94bf9b0.85f8b",
                "fbf9e851.048aa",
                "4d5a50d4.1d35b8",
                "3763749a.0336c4"
            ]
        ],
        "x": 740,
        "y": 1040,
        "z": "459a3a0f.cadb4c"
    },
    {
        "func": "if(msg.topic == \"bedroom_inside\") {\n    context.temp_inside = msg.payload;\n}\nif(msg.topic == \"bedroom_outside_api\") {\n    context.temp_outside = msg.payload;\n}\nreturn { \n    payload: context.temp_outside - context.temp_inside,\n    topic: \"bedroom_diff\" \n}\n\nreturn msg;\n",
        "id": "286c7c9.fa72604",
        "name": "Outside diff",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "39649088.9e1208",
                "f6b45c8d.dbadf",
                "11c77aec.a29e85"
            ]
        ],
        "x": 790,
        "y": 1200,
        "z": "459a3a0f.cadb4c"
    },
    {
        "crontab": "",
        "id": "3bc54bde.1413ac",
        "name": "Open",
        "once": false,
        "onceDelay": 0.1,
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "topic": "",
        "type": "inject",
        "wires": [
            [
                "6f726c2.3989694"
            ]
        ],
        "x": 390,
        "y": 1360,
        "z": "459a3a0f.cadb4c"
    },
    {
        "crontab": "",
        "id": "60835a40.3fd5f4",
        "name": "Close",
        "once": false,
        "onceDelay": 0.1,
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "topic": "",
        "type": "inject",
        "wires": [
            [
                "20492d95.5756aa"
            ]
        ],
        "x": 390,
        "y": 1460,
        "z": "459a3a0f.cadb4c"
    },
    {
        "crontab": "",
        "id": "11e5daad.4b931d",
        "name": "Every 5 sec",
        "once": true,
        "onceDelay": "3",
        "payload": "",
        "payloadType": "date",
        "repeat": "5",
        "topic": "",
        "type": "inject",
        "wires": [
            [
                "deb7a328.2db828"
            ]
        ],
        "x": 410,
        "y": 1520,
        "z": "459a3a0f.cadb4c"
    },
    {
        "action": "",
        "from": "",
        "id": "b60fc641.bbc1e8",
        "name": "'open'",
        "property": "",
        "reg": false,
        "rules": [
            {
                "p": "payload",
                "pt": "msg",
                "t": "set",
                "to": "Open",
                "tot": "str"
            }
        ],
        "to": "",
        "type": "change",
        "wires": [
            [
                "a40ae4f5.d4a528"
            ]
        ],
        "x": 390,
        "y": 1200,
        "z": "459a3a0f.cadb4c"
    },
    {
        "action": "",
        "from": "",
        "id": "a0363f35.4589e8",
        "name": "'closed'",
        "property": "",
        "reg": false,
        "rules": [
            {
                "p": "payload",
                "pt": "msg",
                "t": "set",
                "to": "Closed",
                "tot": "str"
            }
        ],
        "to": "",
        "type": "change",
        "wires": [
            [
                "a40ae4f5.d4a528"
            ]
        ],
        "x": 400,
        "y": 1240,
        "z": "459a3a0f.cadb4c"
    },
    {
        "format": "{{msg.payload}}",
        "group": "ddd0fc4c.8a5e8",
        "height": "",
        "id": "67cd37a1.f6fb6",
        "label": "Window target",
        "layout": "",
        "name": "",
        "order": 4,
        "type": "ui_text",
        "width": "",
        "wires": [],
        "x": 640,
        "y": 1780,
        "z": "459a3a0f.cadb4c"
    },
    {
        "checkall": "true",
        "id": "39ed0882.fb485",
        "name": "== 'closed'",
        "outputs": 1,
        "property": "window_target",
        "propertyType": "flow",
        "repair": false,
        "rules": [
            {
                "t": "eq",
                "v": "closed",
                "vt": "str"
            }
        ],
        "type": "switch",
        "wires": [
            [
                "20492d95.5756aa"
            ]
        ],
        "x": 410,
        "y": 1420,
        "z": "459a3a0f.cadb4c"
    },
    {
        "checkall": "true",
        "id": "14f70808.37a748",
        "name": "== 'open'",
        "outputs": 1,
        "property": "window_target",
        "propertyType": "flow",
        "repair": false,
        "rules": [
            {
                "t": "eq",
                "v": "open",
                "vt": "str"
            }
        ],
        "type": "switch",
        "wires": [
            [
                "6f726c2.3989694"
            ]
        ],
        "x": 400,
        "y": 1320,
        "z": "459a3a0f.cadb4c"
    },
    {
        "endOffset": 0,
        "endOffsetAlt": 0,
        "endOffsetAltMultiplier": 60000,
        "endOffsetAltType": "none",
        "endOffsetMultiplier": 60000,
        "endOffsetType": "none",
        "endTime": "12:00",
        "endTimeAlt": "",
        "endTimeAltType": "entered",
        "endTimeType": "entered",
        "id": "629b989f.9d90b",
        "name": "",
        "nameInt": "",
        "positionConfig": "b9ef850f.12a2",
        "propertyEnd": "",
        "propertyEndCompare": "true",
        "propertyEndThreshold": "",
        "propertyEndThresholdType": "num",
        "propertyEndType": "none",
        "propertyStart": "",
        "propertyStartCompare": "true",
        "propertyStartThreshold": "",
        "propertyStartThresholdType": "num",
        "propertyStartType": "none",
        "startOffset": 0,
        "startOffsetAlt": 0,
        "startOffsetAltMultiplier": 60000,
        "startOffsetAltType": "none",
        "startOffsetMultiplier": 60000,
        "startOffsetType": "none",
        "startTime": "7:40",
        "startTimeAlt": "",
        "startTimeAltType": "entered",
        "startTimeType": "entered",
        "timeDays": "*",
        "timeMonths": "*",
        "timeOnlyEvenDays": false,
        "timeOnlyOddDays": false,
        "timedateend": "",
        "timedatestart": "",
        "tsCompare": "0",
        "type": "within-time-switch",
        "wires": [
            [],
            []
        ],
        "x": 410,
        "y": 1600,
        "z": "459a3a0f.cadb4c"
    },
    {
        "crontab": "",
        "id": "120b3fd7.78f3c",
        "name": "Every 30 sec",
        "once": true,
        "onceDelay": "10",
        "payload": "",
        "payloadType": "date",
        "repeat": "30",
        "topic": "",
        "type": "inject",
        "wires": [
            [
                "629b989f.9d90b"
            ]
        ],
        "x": 200,
        "y": 1600,
        "z": "459a3a0f.cadb4c"
    },
    {
        "action": "",
        "from": "",
        "id": "1275a2b9.0d5345",
        "name": "",
        "property": "",
        "reg": false,
        "rules": [
            {
                "p": "window_target",
                "pt": "flow",
                "t": "set",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "to": "",
        "type": "change",
        "wires": [
            []
        ],
        "x": 660,
        "y": 1720,
        "z": "459a3a0f.cadb4c"
    },
    {
        "checkall": "true",
        "id": "c1ec2f58.72581",
        "name": "Temp diff action",
        "outputs": 2,
        "property": "temp_diff",
        "propertyType": "flow",
        "repair": false,
        "rules": [
            {
                "t": "gt",
                "v": "0.0",
                "vt": "num"
            },
            {
                "t": "lt",
                "v": "-0.75",
                "vt": "num"
            }
        ],
        "type": "switch",
        "wires": [
            [],
            []
        ],
        "x": 420,
        "y": 1660,
        "z": "459a3a0f.cadb4c"
    },
    {
        "action": "",
        "from": "",
        "id": "39649088.9e1208",
        "name": "",
        "property": "",
        "reg": false,
        "rules": [
            {
                "p": "temp_diff",
                "pt": "flow",
                "t": "set",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "to": "",
        "type": "change",
        "wires": [
            []
        ],
        "x": 990,
        "y": 1200,
        "z": "459a3a0f.cadb4c"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "datatype": "json",
        "id": "3cd341cb.92b7fe",
        "inputs": 0,
        "name": "",
        "qos": "2",
        "topic": "tele/+/SENSOR",
        "type": "mqtt in",
        "wires": [
            [
                "8965c4c.bc1e1b8"
            ]
        ],
        "x": 100,
        "y": 400,
        "z": "459a3a0f.cadb4c"
    },
    {
        "id": "fbf9e851.048aa",
        "links": [
            "e86fa4f8.ce18e8",
            "33f8b039.6e3cb"
        ],
        "name": "temps",
        "type": "link out",
        "wires": [],
        "x": 815,
        "y": 1120,
        "z": "459a3a0f.cadb4c"
    },
    {
        "format": "{{msg.payload}} &deg;",
        "group": "42b6ae00.90b7d4",
        "height": "",
        "id": "23a951ff.e26b76",
        "label": "Cur. temp",
        "layout": "",
        "name": "",
        "order": 1,
        "type": "ui_text",
        "width": "",
        "wires": [],
        "x": 780,
        "y": 360,
        "z": "459a3a0f.cadb4c"
    },
    {
        "finalize": "",
        "func": "var messages = [];\nfor(index = 0;; index ++) {\n    var prop = \"DS18B20\";\n    if(index > 0) {\n        prop += \"-\" + index;    \n        if (!msg.payload.hasOwnProperty(prop)){\n            break;\n        }\n    } else {\n        if (!msg.payload.hasOwnProperty(prop)){\n            continue;\n        }\n    }\n    messages.push({\n        topic: msg.payload[prop].Id,\n        payload: msg.payload[prop].Temperature\n    });\n}\n\nreturn [messages];\n",
        "id": "8965c4c.bc1e1b8",
        "initialize": "",
        "name": "Get readings",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "f97ef03a.7bc198"
            ]
        ],
        "x": 310,
        "y": 400,
        "z": "459a3a0f.cadb4c"
    },
    {
        "action": "",
        "from": "",
        "id": "5fcb77f4.ed6328",
        "name": "",
        "property": "",
        "reg": false,
        "rules": [
            {
                "p": "bedroom_outside",
                "pt": "flow",
                "t": "set",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "to": "",
        "type": "change",
        "wires": [
            []
        ],
        "x": 1010,
        "y": 1120,
        "z": "459a3a0f.cadb4c"
    },
    {
        "action": "",
        "from": "",
        "id": "5f2324b3.478a74",
        "name": "",
        "property": "",
        "reg": false,
        "rules": [
            {
                "p": "bedroom_inside",
                "pt": "flow",
                "t": "set",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "to": "",
        "type": "change",
        "wires": [
            []
        ],
        "x": 1010,
        "y": 1080,
        "z": "459a3a0f.cadb4c"
    },
    {
        "action": "",
        "from": "",
        "id": "4d5a50d4.1d35b8",
        "name": "",
        "property": "",
        "reg": false,
        "rules": [
            {
                "p": "bedroom_outside_api",
                "pt": "flow",
                "t": "set",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "to": "",
        "type": "change",
        "wires": [
            []
        ],
        "x": 1030,
        "y": 1160,
        "z": "459a3a0f.cadb4c"
    },
    {
        "crontab": "",
        "id": "1bcb56d.8254929",
        "name": "Every 30 sec",
        "once": true,
        "onceDelay": "10",
        "payload": "",
        "payloadType": "date",
        "props": [
            {
                "p": "payload",
                "v": "",
                "vt": "date"
            },
            {
                "p": "topic",
                "v": "",
                "vt": "string"
            }
        ],
        "repeat": "30",
        "topic": "",
        "type": "inject",
        "wires": [
            [
                "6822911b.ffc2c"
            ]
        ],
        "x": 200,
        "y": 1760,
        "z": "459a3a0f.cadb4c"
    },
    {
        "finalize": "",
        "func": "// Inside below 19 Close\n// Inside between 19 and 21, and outside above 21, and open: close\n// Inside above 21 and cooler outside and close: Open\n// Inside above 21 and warmer outside and open: close\n\n\nvar bedroom_inside = flow.get(\"bedroom_inside\");\nvar bedroom_outside = flow.get(\"bedroom_outside\");\nvar bedroom_outside_api = flow.get(\"bedroom_outside_api\");\n\nif(bedroom_inside < 18.0) {\n    // Too cold, just keep it closed\n    return {topic: \"target\", payload: \"closed\"}\n} else if(bedroom_inside > 22.0) {\n    // Too hot, cool if possible\n    var diff = bedroom_outside - bedroom_inside;\n    if( diff < -0.5 ) {\n        return {topic: \"target\", payload: \"open\"}\n    }\n    // Close at 0 difference, to prevent not noticing room\n    // and outside are keeping the same temp\n    // TODO: PID?\n    if( diff > 0.0 ) {\n        return {topic: \"target\", payload: \"closed\"}\n    }\n} else {\n    // Inbetween, close if outside above 21, otherwise hold\n    if(bedroom_outside > 22.0) {\n        return {topic: \"target\", payload: \"closed\"}\n    }\n}\n",
        "id": "6822911b.ffc2c",
        "initialize": "",
        "name": "",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "67cd37a1.f6fb6",
                "1275a2b9.0d5345"
            ]
        ],
        "x": 400,
        "y": 1760,
        "z": "459a3a0f.cadb4c"
    },
    {
        "id": "6f726c2.3989694",
        "links": [
            "7bd79c90.f19984",
            "50b19175.72032"
        ],
        "name": "open",
        "type": "link out",
        "wires": [],
        "x": 535,
        "y": 1320,
        "z": "459a3a0f.cadb4c"
    },
    {
        "id": "20492d95.5756aa",
        "links": [
            "8300a6ed.9959b8"
        ],
        "name": "close",
        "type": "link out",
        "wires": [],
        "x": 535,
        "y": 1420,
        "z": "459a3a0f.cadb4c"
    },
    {
        "id": "deb7a328.2db828",
        "links": [
            "b0f74837.6f49d8"
        ],
        "name": "status",
        "type": "link out",
        "wires": [],
        "x": 535,
        "y": 1520,
        "z": "459a3a0f.cadb4c"
    },
    {
        "id": "fe48bc28.777df8",
        "links": [
            "be50a951.ae3498",
            "d96f7ea8.8779b"
        ],
        "name": "is open",
        "type": "link in",
        "wires": [
            [
                "39ed0882.fb485",
                "b60fc641.bbc1e8"
            ]
        ],
        "x": 235,
        "y": 1200,
        "z": "459a3a0f.cadb4c"
    },
    {
        "id": "14ceb8e1.7a757f",
        "links": [
            "6dea83fa.9e1924",
            "e4bef279.11e6d8"
        ],
        "name": "is closed",
        "type": "link in",
        "wires": [
            [
                "a0363f35.4589e8",
                "14f70808.37a748"
            ]
        ],
        "x": 235,
        "y": 1240,
        "z": "459a3a0f.cadb4c"
    },
    {
        "finalize": "",
        "func": "msg.measurement = \"temp_\" + msg.topic;\nmsg.payload = {\n  value: msg.payload,\n  time: new Date().getTime()\n};\nreturn msg;\n",
        "id": "3763749a.0336c4",
        "initialize": "",
        "name": "To influxdb format",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "c6dfcb23.ac3a58"
            ]
        ],
        "x": 370,
        "y": 560,
        "z": "459a3a0f.cadb4c"
    },
    {
        "bucket": "home_db/autogen",
        "database": "database",
        "id": "c6dfcb23.ac3a58",
        "influxdb": "9e729019.2637e",
        "measurement": "",
        "name": "",
        "org": "phin-home",
        "precision": "",
        "precisionV18FluxV20": "ms",
        "retentionPolicy": "",
        "retentionPolicyV18Flux": "",
        "type": "influxdb out",
        "wires": [],
        "x": 610,
        "y": 400,
        "z": "459a3a0f.cadb4c"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "datatype": "json",
        "id": "67ba4266.02fbfc",
        "inputs": 0,
        "name": "Playback state",
        "qos": "2",
        "topic": "kodi/status/playbackstate",
        "type": "mqtt in",
        "wires": [
            [
                "b6a7cac0.c4a028"
            ]
        ],
        "x": 140,
        "y": 160,
        "z": "fe7297a4.e6dc1"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "id": "ba4c26e.96afb58",
        "name": "Stop",
        "qos": "2",
        "retain": "false",
        "topic": "kodi/command/playbackstate",
        "type": "mqtt out",
        "wires": [],
        "x": 1070,
        "y": 100,
        "z": "fe7297a4.e6dc1"
    },
    {
        "checkall": "false",
        "id": "b6a7cac0.c4a028",
        "name": "filter",
        "outputs": 3,
        "property": "payload.kodi_state",
        "propertyType": "msg",
        "repair": false,
        "rules": [
            {
                "t": "eq",
                "v": "started",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "stopped",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ended",
                "vt": "str"
            }
        ],
        "type": "switch",
        "wires": [
            [
                "a16f372f.63e558"
            ],
            [
                "4e8ef854.13f1b",
                "747a48e3.c4d07"
            ],
            [
                "d1c75dfe.c88f2",
                "4e8ef854.13f1b"
            ]
        ],
        "x": 330,
        "y": 160,
        "z": "fe7297a4.e6dc1"
    },
    {
        "bytopic": "all",
        "duration": "5",
        "extend": false,
        "id": "4e8ef854.13f1b",
        "name": "",
        "op1": "",
        "op1type": "nul",
        "op2": "true",
        "op2type": "bool",
        "outputs": 1,
        "reset": "",
        "type": "trigger",
        "units": "min",
        "wires": [
            [
                "c91d19f8.d1691"
            ]
        ],
        "x": 570,
        "y": 260,
        "z": "fe7297a4.e6dc1"
    },
    {
        "action": "",
        "from": "",
        "id": "a16f372f.63e558",
        "name": "",
        "property": "",
        "reg": false,
        "rules": [
            {
                "p": "reset",
                "pt": "msg",
                "t": "set",
                "to": "true",
                "tot": "str"
            }
        ],
        "to": "",
        "type": "change",
        "wires": [
            [
                "4e8ef854.13f1b"
            ]
        ],
        "x": 580,
        "y": 180,
        "z": "fe7297a4.e6dc1"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "id": "fa5aaf92.c00ec8",
        "name": "Play",
        "qos": "2",
        "retain": "false",
        "topic": "kodi/command/play",
        "type": "mqtt out",
        "wires": [],
        "x": 1070,
        "y": 260,
        "z": "fe7297a4.e6dc1"
    },
    {
        "action": "",
        "from": "",
        "id": "75b8c639.72a8b",
        "name": "payload = stop",
        "property": "",
        "reg": false,
        "rules": [
            {
                "p": "payload",
                "pt": "msg",
                "t": "set",
                "to": "stop",
                "tot": "str"
            }
        ],
        "to": "",
        "type": "change",
        "wires": [
            [
                "ba4c26e.96afb58"
            ]
        ],
        "x": 900,
        "y": 100,
        "z": "fe7297a4.e6dc1"
    },
    {
        "action": "",
        "from": "",
        "id": "c91d19f8.d1691",
        "name": "payload = dronezone",
        "property": "",
        "reg": false,
        "rules": [
            {
                "p": "payload",
                "pt": "msg",
                "t": "set",
                "to": "plugin://plugin.audio.somafm/dronezone",
                "tot": "str"
            }
        ],
        "to": "",
        "type": "change",
        "wires": [
            [
                "fa5aaf92.c00ec8"
            ]
        ],
        "x": 880,
        "y": 260,
        "z": "fe7297a4.e6dc1"
    },
    {
        "crontab": "",
        "id": "81b0737b.76fef",
        "name": "Play",
        "once": false,
        "onceDelay": 0.1,
        "payload": "true",
        "payloadType": "bool",
        "repeat": "",
        "topic": "",
        "type": "inject",
        "wires": [
            [
                "c91d19f8.d1691"
            ]
        ],
        "x": 670,
        "y": 80,
        "z": "fe7297a4.e6dc1"
    },
    {
        "crontab": "",
        "id": "eb0a573.e21c828",
        "name": "Stop",
        "once": false,
        "onceDelay": 0.1,
        "payload": "true",
        "payloadType": "bool",
        "repeat": "",
        "topic": "",
        "type": "inject",
        "wires": [
            [
                "75b8c639.72a8b"
            ]
        ],
        "x": 670,
        "y": 40,
        "z": "fe7297a4.e6dc1"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "datatype": "json",
        "id": "dd001859.bcca98",
        "inputs": 0,
        "name": "Title",
        "qos": "2",
        "topic": "kodi/status/playertitle",
        "type": "mqtt in",
        "wires": [
            [
                "6e2a574f.5a841"
            ]
        ],
        "x": 110,
        "y": 400,
        "z": "fe7297a4.e6dc1"
    },
    {
        "format": "{{msg.payload}}",
        "group": "9677c439.5fa54",
        "height": 0,
        "id": "a6549fca.fa5c18",
        "label": "Title",
        "layout": "col-center",
        "name": "",
        "order": 1,
        "type": "ui_text",
        "width": 0,
        "wires": [],
        "x": 510,
        "y": 400,
        "z": "fe7297a4.e6dc1"
    },
    {
        "action": "",
        "from": "",
        "id": "6e2a574f.5a841",
        "name": "Get payload.val",
        "property": "",
        "reg": false,
        "rules": [
            {
                "p": "payload",
                "pt": "msg",
                "t": "set",
                "to": "msg.payload.val",
                "tot": "jsonata"
            }
        ],
        "to": "",
        "type": "change",
        "wires": [
            [
                "a6549fca.fa5c18"
            ]
        ],
        "x": 320,
        "y": 400,
        "z": "fe7297a4.e6dc1"
    },
    {
        "action": "",
        "from": "",
        "id": "747a48e3.c4d07",
        "name": "payload = stopped",
        "property": "",
        "reg": false,
        "rules": [
            {
                "p": "payload",
                "pt": "msg",
                "t": "set",
                "to": "[Stopped]",
                "tot": "str"
            }
        ],
        "to": "",
        "type": "change",
        "wires": [
            [
                "a6549fca.fa5c18"
            ]
        ],
        "x": 310,
        "y": 300,
        "z": "fe7297a4.e6dc1"
    },
    {
        "action": "",
        "from": "",
        "id": "d1c75dfe.c88f2",
        "name": "payload = ended",
        "property": "",
        "reg": false,
        "rules": [
            {
                "p": "payload",
                "pt": "msg",
                "t": "set",
                "to": "[Ended]",
                "tot": "str"
            }
        ],
        "to": "",
        "type": "change",
        "wires": [
            [
                "a6549fca.fa5c18"
            ]
        ],
        "x": 310,
        "y": 340,
        "z": "fe7297a4.e6dc1"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "datatype": "json",
        "id": "2890bb46.0c3124",
        "inputs": 0,
        "name": "Sensor",
        "qos": "2",
        "topic": "tele/tasmota_6815F0/SENSOR",
        "type": "mqtt in",
        "wires": [
            [
                "efb92a55.cfeae",
                "416e9cf9.1f2fc4",
                "3d477034.659ef",
                "89991293.60e4b8",
                "24c96ff0.a2e218",
                "68ab9a36.18dc5c",
                "3bd285ac.74b7aa",
                "12e726fa.9b0d29",
                "a452dcf7.60f9b",
                "6757fa12.66ed94"
            ]
        ],
        "x": 130,
        "y": 160,
        "z": "307f8b6a.ec1714"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "datatype": "json",
        "id": "27b20e8d.fd4fd2",
        "inputs": 0,
        "name": "State",
        "qos": "2",
        "topic": "tele/tasmota_6815F0/STATE",
        "type": "mqtt in",
        "wires": [
            []
        ],
        "x": 130,
        "y": 220,
        "z": "307f8b6a.ec1714"
    },
    {
        "action": "",
        "from": "",
        "id": "efb92a55.cfeae",
        "name": "Power",
        "property": "",
        "reg": false,
        "rules": [
            {
                "p": "payload",
                "pt": "msg",
                "t": "set",
                "to": "msg.payload.ENERGY.Power",
                "tot": "jsonata"
            },
            {
                "p": "topic",
                "pt": "msg",
                "t": "set",
                "to": "Real Power",
                "tot": "str"
            }
        ],
        "to": "",
        "type": "change",
        "wires": [
            [
                "e7deb6a4.eb2908",
                "3101793.1525786"
            ]
        ],
        "x": 430,
        "y": 180,
        "z": "307f8b6a.ec1714"
    },
    {
        "action": "",
        "from": "",
        "id": "416e9cf9.1f2fc4",
        "name": "ApparentPower",
        "property": "",
        "reg": false,
        "rules": [
            {
                "p": "payload",
                "pt": "msg",
                "t": "set",
                "to": "msg.payload.ENERGY.ApparentPower",
                "tot": "jsonata"
            },
            {
                "p": "topic",
                "pt": "msg",
                "t": "set",
                "to": "Apparent Power",
                "tot": "str"
            }
        ],
        "to": "",
        "type": "change",
        "wires": [
            [
                "34d0b956.de6cee"
            ]
        ],
        "x": 460,
        "y": 220,
        "z": "307f8b6a.ec1714"
    },
    {
        "action": "",
        "from": "",
        "id": "3d477034.659ef",
        "name": "ReactivePower",
        "property": "",
        "reg": false,
        "rules": [
            {
                "p": "payload",
                "pt": "msg",
                "t": "set",
                "to": "msg.payload.ENERGY.ReactivePower",
                "tot": "jsonata"
            },
            {
                "p": "topic",
                "pt": "msg",
                "t": "set",
                "to": "Reactive Power",
                "tot": "str"
            }
        ],
        "to": "",
        "type": "change",
        "wires": [
            [
                "cea6b536.506538"
            ]
        ],
        "x": 460,
        "y": 260,
        "z": "307f8b6a.ec1714"
    },
    {
        "action": "",
        "from": "",
        "id": "89991293.60e4b8",
        "name": "Factor",
        "property": "",
        "reg": false,
        "rules": [
            {
                "p": "payload",
                "pt": "msg",
                "t": "set",
                "to": "msg.payload.ENERGY.Factor",
                "tot": "jsonata"
            },
            {
                "p": "topic",
                "pt": "msg",
                "t": "set",
                "to": "Factor",
                "tot": "str"
            }
        ],
        "to": "",
        "type": "change",
        "wires": [
            [
                "996f3ed7.18817"
            ]
        ],
        "x": 430,
        "y": 400,
        "z": "307f8b6a.ec1714"
    },
    {
        "action": "",
        "from": "",
        "id": "24c96ff0.a2e218",
        "name": "Voltage",
        "property": "",
        "reg": false,
        "rules": [
            {
                "p": "payload",
                "pt": "msg",
                "t": "set",
                "to": "msg.payload.ENERGY.Voltage",
                "tot": "jsonata"
            },
            {
                "p": "topic",
                "pt": "msg",
                "t": "set",
                "to": "Voltage",
                "tot": "str"
            }
        ],
        "to": "",
        "type": "change",
        "wires": [
            [
                "4e745a03.38f584"
            ]
        ],
        "x": 440,
        "y": 320,
        "z": "307f8b6a.ec1714"
    },
    {
        "action": "",
        "from": "",
        "id": "68ab9a36.18dc5c",
        "name": "Current",
        "property": "",
        "reg": false,
        "rules": [
            {
                "p": "payload",
                "pt": "msg",
                "t": "set",
                "to": "msg.payload.ENERGY.Current",
                "tot": "jsonata"
            },
            {
                "p": "topic",
                "pt": "msg",
                "t": "set",
                "to": "Current",
                "tot": "str"
            }
        ],
        "to": "",
        "type": "change",
        "wires": [
            [
                "d2cf9a06.37e4b"
            ]
        ],
        "x": 440,
        "y": 360,
        "z": "307f8b6a.ec1714"
    },
    {
        "format": "{{msg.payload}} W",
        "group": "e5757e69.82094",
        "height": 0,
        "id": "e7deb6a4.eb2908",
        "label": "Real Power",
        "layout": "row-spread",
        "name": "",
        "order": 3,
        "type": "ui_text",
        "width": 0,
        "wires": [],
        "x": 930,
        "y": 180,
        "z": "307f8b6a.ec1714"
    },
    {
        "format": "{{msg.payload}} VA",
        "group": "e5757e69.82094",
        "height": 0,
        "id": "34d0b956.de6cee",
        "label": "Apparent Power",
        "layout": "row-spread",
        "name": "",
        "order": 4,
        "type": "ui_text",
        "width": 0,
        "wires": [],
        "x": 940,
        "y": 220,
        "z": "307f8b6a.ec1714"
    },
    {
        "format": "{{msg.payload}} VAr",
        "group": "e5757e69.82094",
        "height": 0,
        "id": "cea6b536.506538",
        "label": "Reactive Power",
        "layout": "row-spread",
        "name": "",
        "order": 5,
        "type": "ui_text",
        "width": 0,
        "wires": [],
        "x": 940,
        "y": 260,
        "z": "307f8b6a.ec1714"
    },
    {
        "format": "{{msg.payload}} V",
        "group": "e5757e69.82094",
        "height": 0,
        "id": "4e745a03.38f584",
        "label": "Voltage",
        "layout": "row-spread",
        "name": "",
        "order": 1,
        "type": "ui_text",
        "width": 0,
        "wires": [],
        "x": 920,
        "y": 320,
        "z": "307f8b6a.ec1714"
    },
    {
        "format": "{{msg.payload}} A",
        "group": "e5757e69.82094",
        "height": 0,
        "id": "d2cf9a06.37e4b",
        "label": "Current",
        "layout": "row-spread",
        "name": "",
        "order": 2,
        "type": "ui_text",
        "width": 0,
        "wires": [],
        "x": 920,
        "y": 360,
        "z": "307f8b6a.ec1714"
    },
    {
        "format": "{{msg.payload}}",
        "group": "e5757e69.82094",
        "height": 0,
        "id": "996f3ed7.18817",
        "label": "Power Factor",
        "layout": "row-spread",
        "name": "",
        "order": 6,
        "type": "ui_text",
        "width": 0,
        "wires": [],
        "x": 940,
        "y": 400,
        "z": "307f8b6a.ec1714"
    },
    {
        "format": "{{msg.payload}} kWh",
        "group": "e5757e69.82094",
        "height": 0,
        "id": "f8a4bdbe.ed16a8",
        "label": "Energy Total",
        "layout": "row-spread",
        "name": "",
        "order": 9,
        "type": "ui_text",
        "width": 0,
        "wires": [],
        "x": 930,
        "y": 460,
        "z": "307f8b6a.ec1714"
    },
    {
        "format": "{{msg.payload}} kWh",
        "group": "e5757e69.82094",
        "height": 0,
        "id": "909e3fbe.c4656",
        "label": "Energy Yesterday",
        "layout": "row-spread",
        "name": "",
        "order": 8,
        "type": "ui_text",
        "width": 0,
        "wires": [],
        "x": 950,
        "y": 540,
        "z": "307f8b6a.ec1714"
    },
    {
        "format": "{{msg.payload}} kWh",
        "group": "e5757e69.82094",
        "height": 0,
        "id": "75b16ed4.b2027",
        "label": "Energy Today",
        "layout": "row-spread",
        "name": "",
        "order": 7,
        "type": "ui_text",
        "width": 0,
        "wires": [],
        "x": 940,
        "y": 500,
        "z": "307f8b6a.ec1714"
    },
    {
        "action": "",
        "from": "",
        "id": "a452dcf7.60f9b",
        "name": "Today",
        "property": "",
        "reg": false,
        "rules": [
            {
                "p": "payload",
                "pt": "msg",
                "t": "set",
                "to": "msg.payload.ENERGY.Today",
                "tot": "jsonata"
            },
            {
                "p": "topic",
                "pt": "msg",
                "t": "set",
                "to": "Today",
                "tot": "str"
            }
        ],
        "to": "",
        "type": "change",
        "wires": [
            [
                "75b16ed4.b2027"
            ]
        ],
        "x": 430,
        "y": 500,
        "z": "307f8b6a.ec1714"
    },
    {
        "action": "",
        "from": "",
        "id": "3bd285ac.74b7aa",
        "name": "Total",
        "property": "",
        "reg": false,
        "rules": [
            {
                "p": "payload",
                "pt": "msg",
                "t": "set",
                "to": "msg.payload.ENERGY.Total",
                "tot": "jsonata"
            },
            {
                "p": "topic",
                "pt": "msg",
                "t": "set",
                "to": "Total",
                "tot": "str"
            }
        ],
        "to": "",
        "type": "change",
        "wires": [
            [
                "f8a4bdbe.ed16a8"
            ]
        ],
        "x": 430,
        "y": 460,
        "z": "307f8b6a.ec1714"
    },
    {
        "action": "",
        "from": "",
        "id": "12e726fa.9b0d29",
        "name": "Yesterday",
        "property": "",
        "reg": false,
        "rules": [
            {
                "p": "payload",
                "pt": "msg",
                "t": "set",
                "to": "msg.payload.ENERGY.Yesterday",
                "tot": "jsonata"
            },
            {
                "p": "topic",
                "pt": "msg",
                "t": "set",
                "to": "Yesterday",
                "tot": "str"
            }
        ],
        "to": "",
        "type": "change",
        "wires": [
            [
                "909e3fbe.c4656"
            ]
        ],
        "x": 440,
        "y": 540,
        "z": "307f8b6a.ec1714"
    },
    {
        "id": "3101793.1525786",
        "links": [
            "1bb92743.73f8c9"
        ],
        "name": "",
        "type": "link out",
        "wires": [],
        "x": 875,
        "y": 140,
        "z": "307f8b6a.ec1714"
    },
    {
        "finalize": "",
        "func": "time = msg.payload.Time;\ndata = msg.payload.ENERGY;\n\nmsg.measurement = \"solar_power\";\nmsg.payload = {\n  value: data.Power,\n  power: data.Power,\n  apparent_power: data.ApparentPower,\n  reactive_power: data.ReactivePower,\n  voltage: data.Voltage,\n  current: data.Current,\n  factor: data.Factor,\n  total_start_time: data.TotalStartTime,\n  total: data.Total,\n  today: data.Today,\n  yesterday: data.Yesterday,\n  time: new Date(time).getTime()\n};\nreturn msg;\n",
        "id": "6757fa12.66ed94",
        "initialize": "",
        "name": "To influxdb format",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "cf463c2c.d0c398"
            ]
        ],
        "x": 470,
        "y": 80,
        "z": "307f8b6a.ec1714"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "datatype": "json",
        "id": "99968074.722f88",
        "inputs": 0,
        "name": "SonoffR2-B",
        "qos": "2",
        "topic": "tele/tasmota_4F6977/SENSOR",
        "type": "mqtt in",
        "wires": [
            [
                "2348e05d.e3d64"
            ]
        ],
        "x": 150,
        "y": 700,
        "z": "307f8b6a.ec1714"
    },
    {
        "finalize": "",
        "func": "time = msg.payload.Time;\ndata = msg.payload.ENERGY;\n\nmsg.measurement = \"solar_power2\";\nmsg.payload = {\n  value: data.Power,\n  power: data.Power,\n  apparent_power: data.ApparentPower,\n  reactive_power: data.ReactivePower,\n  voltage: data.Voltage,\n  current: data.Current,\n  factor: data.Factor,\n  total_start_time: data.TotalStartTime,\n  total: data.Total,\n  today: data.Today,\n  yesterday: data.Yesterday,\n  time: new Date(time).getTime()\n};\nreturn msg;\n",
        "id": "2348e05d.e3d64",
        "initialize": "",
        "name": "To influxdb format",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "cf463c2c.d0c398"
            ]
        ],
        "x": 470,
        "y": 700,
        "z": "307f8b6a.ec1714"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "datatype": "json",
        "id": "2e363d39.1628da",
        "inputs": 0,
        "name": "SonoffR2-C",
        "qos": "2",
        "topic": "tele/tasmota_4F6981/SENSOR",
        "type": "mqtt in",
        "wires": [
            [
                "7b37f4d0.653aa4"
            ]
        ],
        "x": 150,
        "y": 780,
        "z": "307f8b6a.ec1714"
    },
    {
        "finalize": "",
        "func": "time = msg.payload.Time;\ndata = msg.payload.ENERGY;\n\nmsg.measurement = \"solar_power3\";\nmsg.payload = {\n  value: data.Power,\n  power: data.Power,\n  apparent_power: data.ApparentPower,\n  reactive_power: data.ReactivePower,\n  voltage: data.Voltage,\n  current: data.Current,\n  factor: data.Factor,\n  total_start_time: data.TotalStartTime,\n  total: data.Total,\n  today: data.Today,\n  yesterday: data.Yesterday,\n  time: new Date(time).getTime()\n};\nreturn msg;\n",
        "id": "7b37f4d0.653aa4",
        "initialize": "",
        "name": "To influxdb format",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "cf463c2c.d0c398"
            ]
        ],
        "x": 470,
        "y": 780,
        "z": "307f8b6a.ec1714"
    },
    {
        "bucket": "home_db/autogen",
        "database": "database",
        "id": "cf463c2c.d0c398",
        "influxdb": "9e729019.2637e",
        "measurement": "",
        "name": "",
        "org": "phin-home",
        "precision": "",
        "precisionV18FluxV20": "ms",
        "retentionPolicy": "",
        "retentionPolicyV18Flux": "",
        "type": "influxdb out",
        "wires": [],
        "x": 830,
        "y": 80,
        "z": "307f8b6a.ec1714"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "datatype": "utf8",
        "id": "ea0c094e.6e9b",
        "inputs": 0,
        "name": "P1 input",
        "qos": "2",
        "topic": "tele/tasmota_012311/RESULT",
        "type": "mqtt in",
        "wires": [
            [
                "91a54f37.f20998"
            ]
        ],
        "x": 130,
        "y": 160,
        "z": "53214520.af847c"
    },
    {
        "func": "var res = msg.payload.match(/(.+?)(\\(.+)/);\n\nif (res === null) {\n    return null;\n}\n\nmsg.topic = res[1];\nmsg.payload = res[2];\n\nreturn msg;\n",
        "id": "1c2f7155.83a77f",
        "name": "Get header/data",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "d884a3d7.e75d9"
            ]
        ],
        "x": 500,
        "y": 260,
        "z": "53214520.af847c"
    },
    {
        "checkall": "true",
        "id": "d884a3d7.e75d9",
        "name": "Get current power",
        "outputs": 6,
        "property": "topic",
        "propertyType": "msg",
        "repair": false,
        "rules": [
            {
                "t": "eq",
                "v": "1-0:1.7.0",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "1-0:2.7.0",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "1-0:1.8.1",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "1-0:1.8.2",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "1-0:2.8.1",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "1-0:2.8.2",
                "vt": "str"
            }
        ],
        "type": "switch",
        "wires": [
            [
                "2767f59a.0aa2a2"
            ],
            [
                "96383f7.8c883c"
            ],
            [
                "ed5eb5fe.63efd8"
            ],
            [
                "667ccb31.a889b4"
            ],
            [
                "f49a0d16.460bd8"
            ],
            [
                "29394d7e.fe0202"
            ]
        ],
        "x": 490,
        "y": 340,
        "z": "53214520.af847c"
    },
    {
        "func": "var res = msg.payload.match(/\\((\\d\\d\\.\\d\\d\\d)\\*kW\\)/);\n\nif (res === null) {\n    return null;\n}\n\nmsg.payload = parseFloat(res[1]) * 1000;\nmsg.topic = \"Watt in\"\n\nreturn msg;\n",
        "id": "2767f59a.0aa2a2",
        "name": "Watt in",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "ac50c75f.fce3",
                "c7edeb41.3b9c48",
                "6de2dae7.04f41c",
                "6cacd492.26010c"
            ]
        ],
        "x": 750,
        "y": 300,
        "z": "53214520.af847c"
    },
    {
        "func": "var res = msg.payload.match(/\\((\\d\\d\\.\\d\\d\\d)\\*kW\\)/);\n\nif (res === null) {\n    return null;\n}\n\nmsg.payload = parseFloat(res[1]) * -1000;\nmsg.topic = \"Watt out\"\n\nreturn msg;\n",
        "id": "96383f7.8c883c",
        "name": "Watt out",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "ac50c75f.fce3",
                "8a847845.5383e",
                "2a70fa85.6933e6"
            ]
        ],
        "x": 760,
        "y": 420,
        "z": "53214520.af847c"
    },
    {
        "chartType": "line",
        "colors": [
            "#1f77b4",
            "#ff0aef",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "cutout": 0,
        "dot": false,
        "group": "c13636b9.13657",
        "height": 0,
        "id": "ac50c75f.fce3",
        "interpolate": "linear",
        "label": "",
        "legend": "true",
        "name": "Power",
        "nodata": "",
        "order": 4,
        "outputs": 1,
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "86400",
        "type": "ui_chart",
        "useOneColor": false,
        "useUTC": false,
        "width": 0,
        "wires": [
            []
        ],
        "x": 990,
        "xformat": "HH:mm:ss",
        "y": 360,
        "ymax": "1000",
        "ymin": "-500",
        "z": "53214520.af847c"
    },
    {
        "id": "1bb92743.73f8c9",
        "links": [
            "3101793.1525786"
        ],
        "name": "",
        "type": "link in",
        "wires": [
            [
                "f024de81.164de"
            ]
        ],
        "x": 715,
        "y": 480,
        "z": "53214520.af847c"
    },
    {
        "id": "3b09687b.0e773",
        "info": "",
        "name": "Small chart, numbers above, only last .. ?",
        "type": "comment",
        "wires": [],
        "x": 940,
        "y": 760,
        "z": "53214520.af847c"
    },
    {
        "action": "",
        "from": "",
        "id": "f024de81.164de",
        "name": "",
        "property": "",
        "reg": false,
        "rules": [
            {
                "p": "topic",
                "pt": "msg",
                "t": "set",
                "to": "Solar Power",
                "tot": "str"
            }
        ],
        "to": "",
        "type": "change",
        "wires": [
            [
                "ac50c75f.fce3",
                "ca0554c3.d3ec"
            ]
        ],
        "x": 850,
        "y": 480,
        "z": "53214520.af847c"
    },
    {
        "func": "msg.payload = msg.payload.replace(/[\\r\\n]/, '');\nreturn msg;\n",
        "id": "91a54f37.f20998",
        "name": "Remove CR/LF",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "f903af0b.e2c008"
            ]
        ],
        "x": 300,
        "y": 160,
        "z": "53214520.af847c"
    },
    {
        "action": "obj",
        "id": "f903af0b.e2c008",
        "name": "",
        "pretty": false,
        "property": "payload",
        "type": "json",
        "wires": [
            [
                "e3a2b6af.ecbe5"
            ]
        ],
        "x": 270,
        "y": 200,
        "z": "53214520.af847c"
    },
    {
        "action": "",
        "from": "",
        "id": "e3a2b6af.ecbe5",
        "name": "",
        "property": "",
        "reg": false,
        "rules": [
            {
                "p": "payload",
                "pt": "msg",
                "t": "set",
                "to": "msg.payload.SerialReceived",
                "tot": "jsonata"
            }
        ],
        "to": "",
        "type": "change",
        "wires": [
            [
                "1c2f7155.83a77f",
                "4c769910.a231d"
            ]
        ],
        "x": 300,
        "y": 240,
        "z": "53214520.af847c"
    },
    {
        "format": "{{msg.payload}} W",
        "group": "c13636b9.13657",
        "height": "1",
        "id": "c7edeb41.3b9c48",
        "label": "Watt in",
        "layout": "row-left",
        "name": "",
        "order": 2,
        "type": "ui_text",
        "width": "3",
        "wires": [],
        "x": 1010,
        "y": 200,
        "z": "53214520.af847c"
    },
    {
        "format": "{{msg.payload}} W",
        "group": "c13636b9.13657",
        "height": "1",
        "id": "8a847845.5383e",
        "label": "Watt out",
        "layout": "row-left",
        "name": "",
        "order": 3,
        "type": "ui_text",
        "width": "3",
        "wires": [],
        "x": 1020,
        "y": 260,
        "z": "53214520.af847c"
    },
    {
        "format": "{{msg.payload}} W",
        "group": "c13636b9.13657",
        "height": "1",
        "id": "ca0554c3.d3ec",
        "label": "Solar Power",
        "layout": "row-left",
        "name": "",
        "order": 1,
        "type": "ui_text",
        "width": "3",
        "wires": [],
        "x": 1030,
        "y": 480,
        "z": "53214520.af847c"
    },
    {
        "func": "var res = msg.payload.match(/\\((\\d{6}\\.\\d{3})\\*kWh\\)/);\n\nif (res === null) {\n    return null;\n}\n\nmsg.payload = parseFloat(res[1]);\nmsg.topic = \"kWh Received T1\"\n\nreturn msg;\n",
        "id": "ed5eb5fe.63efd8",
        "name": "kWh Received T1",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "35173762.b4c95"
            ]
        ],
        "x": 750,
        "y": 560,
        "z": "53214520.af847c"
    },
    {
        "func": "var res = msg.payload.match(/\\((\\d{6}\\.\\d{3})\\*kWh\\)/);\n\nif (res === null) {\n    return null;\n}\n\nmsg.payload = parseFloat(res[1]);\nmsg.topic = \"kWh Received T2\"\n\nreturn msg;\n",
        "id": "667ccb31.a889b4",
        "name": "kWh Received T2",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "36f4d085.5b5e08"
            ]
        ],
        "x": 750,
        "y": 600,
        "z": "53214520.af847c"
    },
    {
        "func": "var res = msg.payload.match(/\\((\\d{6}\\.\\d{3})\\*kWh\\)/);\n\nif (res === null) {\n    return null;\n}\n\nmsg.payload = parseFloat(res[1]);\nmsg.topic = \"kWh Sent T1\"\n\nreturn msg;\n",
        "id": "f49a0d16.460bd8",
        "name": "kWh Sent T1",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "46e4ff24.111bd"
            ]
        ],
        "x": 730,
        "y": 640,
        "z": "53214520.af847c"
    },
    {
        "func": "var res = msg.payload.match(/\\((\\d{6}\\.\\d{3})\\*kWh\\)/);\n\nif (res === null) {\n    return null;\n}\n\nmsg.payload = parseFloat(res[1]);\nmsg.topic = \"kWh Sent T2\"\n\nreturn msg;\n",
        "id": "29394d7e.fe0202",
        "name": "kWh Sent T2",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "4e2cffa9.40b838"
            ]
        ],
        "x": 730,
        "y": 680,
        "z": "53214520.af847c"
    },
    {
        "format": "{{msg.payload}} Watt",
        "group": "42b6ae00.90b7d4",
        "height": "",
        "id": "6de2dae7.04f41c",
        "label": "Power usage",
        "layout": "",
        "name": "",
        "order": 2,
        "type": "ui_text",
        "width": "",
        "wires": [],
        "x": 450,
        "y": 740,
        "z": "53214520.af847c"
    },
    {
        "format": "{{msg.payload}} M<sup>3</sup>",
        "group": "42b6ae00.90b7d4",
        "height": "",
        "id": "b2b0f8a7.992778",
        "label": "Gas usage ???",
        "layout": "",
        "name": "",
        "order": 7,
        "type": "ui_text",
        "width": "",
        "wires": [],
        "x": 440,
        "y": 800,
        "z": "53214520.af847c"
    },
    {
        "format": "{{msg.payload}} kWh",
        "group": "42b6ae00.90b7d4",
        "height": "",
        "id": "35173762.b4c95",
        "label": "kWh in night",
        "layout": "",
        "name": "",
        "order": 4,
        "type": "ui_text",
        "width": "",
        "wires": [],
        "x": 990,
        "y": 560,
        "z": "53214520.af847c"
    },
    {
        "format": "{{msg.payload}} kWh",
        "group": "42b6ae00.90b7d4",
        "height": "",
        "id": "36f4d085.5b5e08",
        "label": "kWh in day",
        "layout": "",
        "name": "",
        "order": 3,
        "type": "ui_text",
        "width": "",
        "wires": [],
        "x": 990,
        "y": 600,
        "z": "53214520.af847c"
    },
    {
        "format": "{{msg.payload}} kWh",
        "group": "42b6ae00.90b7d4",
        "height": "",
        "id": "46e4ff24.111bd",
        "label": "kWh out night",
        "layout": "",
        "name": "",
        "order": 6,
        "type": "ui_text",
        "width": "",
        "wires": [],
        "x": 1000,
        "y": 640,
        "z": "53214520.af847c"
    },
    {
        "format": "{{msg.payload}} kWh",
        "group": "42b6ae00.90b7d4",
        "height": "",
        "id": "4e2cffa9.40b838",
        "label": "kWh out day",
        "layout": "",
        "name": "",
        "order": 5,
        "type": "ui_text",
        "width": "",
        "wires": [],
        "x": 990,
        "y": 680,
        "z": "53214520.af847c"
    },
    {
        "finalize": "",
        "func": "const data = msg.payload\n\nmsg.measurement = \"house_power\";\nmsg.payload = {\n  current_w_received: data.current_w_received,\n  current_w_delivered: data.current_w_delivered,\n  total_kwh_received_t1: data.total_kwh_received_t1,\n  total_kwh_received_t2: data.total_kwh_received_t2,\n  total_kwh_delivered_t1: data.total_kwh_delivered_t1,\n  total_kwh_delivered_t2: data.total_kwh_delivered_t2,\n  total_gas_m3_received: data.total_gas_m3_received,\n  time: new Date(data.timestamp).getTime()\n};\nreturn msg;\n",
        "id": "ac6b5349.cbcd7",
        "initialize": "",
        "libs": [],
        "name": "To influxdb format",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "2b375b56.872754"
            ]
        ],
        "x": 690,
        "y": 40,
        "z": "53214520.af847c"
    },
    {
        "func": "if(flow.serial_input === undefined) {\n    flow.serial_input = \"\";\n}\nflow.serial_input += msg.payload +\"\\r\\n\";\n\nif(msg.payload.startsWith(\"!\")) {\n    msg = {\n        topic: \"P1 input\",\n        payload: flow.serial_input\n    }\n    flow.serial_input = \"\";\n    return msg;\n}\n",
        "id": "4c769910.a231d",
        "name": "Combine parts",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "bab94a0f.921b38"
            ]
        ],
        "x": 540,
        "y": 160,
        "z": "53214520.af847c"
    },
    {
        "finalize": "",
        "func": "var result = {};\n\nmsg.payload.split(/\\r?\\n/).forEach(line => {\n    var lineParsed = line.match(/(.+?)(\\(.+)/);\n    if (lineParsed === null) {\n        return;\n    }\n\n    const key = lineParsed[1];\n    const value = lineParsed[2];\n\n    var res;\n    if (key === \"0-0:1.0.0\") {\n        res = value.match(/\\((\\d{2})(\\d{2})(\\d{2})(\\d{2})(\\d{2})(\\d{2})([SW])\\)/);\n        if (res === null) {\n            return;\n        }\n        const year = parseInt(res[1]) + 2000;\n        const month = parseInt(res[2]) - 1;\n        const day = parseInt(res[3]);\n        const hours = parseInt(res[4]);\n        const minutes = parseInt(res[5]);\n        const seconds = parseInt(res[6]);\n        const dst = res[7] === \"W\";\n        const timestamp = new Date(year, month, day, hours, minutes, seconds);\n        result.timestamp = timestamp.toISOString();\n    } else if (key === \"1-0:1.7.0\") {\n        res = value.match(/\\((\\d{2}\\.\\d{3})\\*kW\\)/);\n        if (res === null) {\n            return;\n        }\n        result.current_w_received = parseFloat(res[1]) * 1000;\n    } else if (key === \"1-0:2.7.0\") {\n        res = value.match(/\\((\\d{2}\\.\\d{3})\\*kW\\)/);\n        if (res === null) {\n            return;\n        }\n        result.current_w_delivered = parseFloat(res[1]) * 1000;\n    } else if (key === \"1-0:1.8.1\") {\n        res = value.match(/\\((\\d{6}\\.\\d{3})\\*kWh\\)/);\n        if (res === null) {\n            return;\n        }\n        result.total_kwh_received_t1 = parseFloat(res[1]);\n    } else if (key === \"1-0:1.8.2\") {\n        res = value.match(/\\((\\d{6}\\.\\d{3})\\*kWh\\)/);\n        if (res === null) {\n            return;\n        }\n        result.total_kwh_received_t2 = parseFloat(res[1]);\n    } else if (key === \"1-0:2.8.1\") {\n        res = value.match(/\\((\\d{6}\\.\\d{3})\\*kWh\\)/);\n        if (res === null) {\n            return;\n        }\n        result.total_kwh_delivered_t1 = parseFloat(res[1]);\n    } else if (key === \"1-0:2.8.2\") {\n        res = value.match(/\\((\\d{6}\\.\\d{3})\\*kWh\\)/);\n        if (res === null) {\n            return;\n        }\n        result.total_kwh_delivered_t2 = parseFloat(res[1]);\n    } else if (key === \"0-1:24.2.1\") {\n        res = value.match(/\\(\\d{12}[SW]\\)\\((\\d{5}\\.\\d{3})\\*m3\\)/);\n        if (res === null) {\n            return;\n        }\n        result.total_gas_m3_received = parseFloat(res[1]);\n    }\n    return;\n});\n\nmsg.payload = result;\n\nreturn msg;",
        "id": "bab94a0f.921b38",
        "initialize": "",
        "libs": [],
        "name": "Convert",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "ac6b5349.cbcd7"
            ]
        ],
        "x": 460,
        "y": 40,
        "z": "53214520.af847c"
    },
    {
        "bucket": "home_db/autogen",
        "database": "database",
        "id": "2b375b56.872754",
        "influxdb": "9e729019.2637e",
        "measurement": "",
        "name": "",
        "org": "phin-home",
        "precision": "",
        "precisionV18FluxV20": "ms",
        "retentionPolicy": "",
        "retentionPolicyV18Flux": "",
        "type": "influxdb out",
        "wires": [],
        "x": 910,
        "y": 40,
        "z": "53214520.af847c"
    },
    {
        "id": "6cacd492.26010c",
        "links": [
            "d6ec2ac3.24f5f"
        ],
        "name": "Watt in",
        "type": "link out",
        "wires": [],
        "x": 1175,
        "y": 200,
        "z": "53214520.af847c"
    },
    {
        "id": "2a70fa85.6933e6",
        "links": [
            "dac9fcf5.4f3058"
        ],
        "name": "Watt out",
        "type": "link out",
        "wires": [],
        "x": 1175,
        "y": 260,
        "z": "53214520.af847c"
    },
    {
        "crontab": "",
        "id": "73a521e3.a0e228",
        "name": "",
        "once": false,
        "onceDelay": 0.1,
        "payload": "",
        "payloadType": "date",
        "repeat": "30",
        "topic": "",
        "type": "inject",
        "wires": [
            [
                "c6e1b736.a7c118"
            ]
        ],
        "x": 130,
        "y": 100,
        "z": "da818f88.a776d"
    },
    {
        "id": "793e9ab1.6a1b7c",
        "influxdb": "9e729019.2637e",
        "name": "",
        "org": "phin-home",
        "precision": "",
        "query": "",
        "rawOutput": false,
        "retentionPolicy": "",
        "type": "influxdb in",
        "wires": [
            [
                "c13e3bc9.29ac58"
            ]
        ],
        "x": 510,
        "y": 100,
        "z": "da818f88.a776d"
    },
    {
        "finalize": "",
        "func": "msg.query = `import \"date\"\nimport \"experimental\"\n\nfrom(bucket: \"home_db/autogen\")\n  |> range(\n       start: experimental.addDuration(d: 7h, to: date.truncate(t: 0d, unit: 1d)), \n       stop: experimental.addDuration(d: 23h, to: date.truncate(t: 0d, unit: 1d))\n     )\n  |> filter(fn: (r) => r[\"_measurement\"] == \"solar_power\")\n  |> filter(fn: (r) => r[\"_field\"] == \"power\" or r[\"_field\"] == \"apparent_power\" or r[\"_field\"] == \"reactive_power\" or r[\"_field\"] == \"voltage\" or r[\"_field\"] == \"current\" or r[\"_field\"] == \"factor\")\n  |> timeShift(duration: -1h)  \n  |> aggregateWindow(every: 2m, fn: mean, createEmpty: true)\n  |> yield(name: \"mean\")`\n\n\nreturn msg;",
        "id": "c6e1b736.a7c118",
        "initialize": "",
        "name": "Query",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "793e9ab1.6a1b7c"
            ]
        ],
        "x": 310,
        "y": 100,
        "z": "da818f88.a776d"
    },
    {
        "chartType": "line",
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "cutout": 0,
        "dot": false,
        "group": "4159afe3.bd0fe",
        "height": 0,
        "id": "71cbe8d8.f1fcb8",
        "interpolate": "linear",
        "label": "",
        "legend": "true",
        "name": "Power",
        "nodata": "",
        "order": 1,
        "outputs": 1,
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "86400",
        "type": "ui_chart",
        "useOneColor": false,
        "useUTC": false,
        "width": 0,
        "wires": [
            []
        ],
        "x": 550,
        "xformat": "HH:mm:ss",
        "y": 260,
        "ymax": "",
        "ymin": "0",
        "z": "da818f88.a776d"
    },
    {
        "chartType": "line",
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "cutout": 0,
        "dot": false,
        "group": "4159afe3.bd0fe",
        "height": "4",
        "id": "4142ba6e.7b1854",
        "interpolate": "linear",
        "label": "Voltage",
        "legend": "false",
        "name": "",
        "nodata": "",
        "order": 2,
        "outputs": 1,
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "86400",
        "type": "ui_chart",
        "useOneColor": false,
        "useUTC": false,
        "width": "6",
        "wires": [
            []
        ],
        "x": 560,
        "xformat": "HH:mm:ss",
        "y": 300,
        "ymax": "",
        "ymin": "0",
        "z": "da818f88.a776d"
    },
    {
        "chartType": "line",
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "cutout": 0,
        "dot": false,
        "group": "4159afe3.bd0fe",
        "height": "4",
        "id": "63d08d40.dba0cc",
        "interpolate": "linear",
        "label": "Current",
        "legend": "false",
        "name": "",
        "nodata": "",
        "order": 3,
        "outputs": 1,
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "86400",
        "type": "ui_chart",
        "useOneColor": false,
        "useUTC": false,
        "width": "6",
        "wires": [
            []
        ],
        "x": 560,
        "xformat": "HH:mm:ss",
        "y": 340,
        "ymax": "",
        "ymin": "0",
        "z": "da818f88.a776d"
    },
    {
        "chartType": "line",
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "cutout": 0,
        "dot": false,
        "group": "4159afe3.bd0fe",
        "height": "4",
        "id": "2d2ae5fa.5e0f02",
        "interpolate": "linear",
        "label": "Factor",
        "legend": "false",
        "name": "",
        "nodata": "",
        "order": 4,
        "outputs": 1,
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "86400",
        "type": "ui_chart",
        "useOneColor": false,
        "useUTC": false,
        "width": "6",
        "wires": [
            []
        ],
        "x": 550,
        "xformat": "HH:mm:ss",
        "y": 380,
        "ymax": "",
        "ymin": "0",
        "z": "da818f88.a776d"
    },
    {
        "finalize": "",
        "func": "seriesPower = \n    msg.payload.filter(record => record._field === \"power\")\n    .map(record => ({ \n        \"x\": record._time, \n        \"y\": record._value}));\nseriesApparentPower = \n    msg.payload.filter(record => record._field === \"apparent_power\")\n    .map(record => ({ \n        \"x\": record._time, \n        \"y\": record._value}));\nseriesReactivePower = \n    msg.payload.filter(record => record._field === \"reactive_power\")\n    .map(record => ({ \n        \"x\": record._time, \n        \"y\": record._value}));\nseriesVoltage =\n    msg.payload.filter(record => record._field === \"voltage\")\n    .map(record => ({ \n        \"x\": record._time, \n        \"y\": record._value}));\nseriesCurrent =\n    msg.payload.filter(record => record._field === \"current\")\n    .map(record => ({ \n        \"x\": record._time, \n        \"y\": record._value}));\nseriesFactor =\n    msg.payload.filter(record => record._field === \"factor\")\n    .map(record => ({ \n        \"x\": record._time, \n        \"y\": record._value}));\n\nreturn [{\n    topic: \"Solar only\",\n    payload: [{\n        \"series\": [\"Solar power\"],\n        \"data\": [\n            seriesPower\n        ],\n        \"labels\": [\"\"]\n    }]\n},{\n    topic: \"Solar power\",\n    payload: [{\n        \"series\": [\"Power\", \"Apparent Power\", \"Reactive Power\"],\n        \"data\": [\n            seriesPower,\n            seriesApparentPower,\n            seriesReactivePower\n        ],\n        \"labels\": [\"\"]\n    }]\n},{\n    topic: \"Voltage\",\n    payload: [{\n        \"series\": [\"Voltage\"],\n        \"data\": [\n            seriesVoltage\n        ],\n        \"labels\": [\"\"]\n    }]\n},{\n    topic: \"Current\",\n    payload: [{\n        \"series\": [\"Current\"],\n        \"data\": [\n            seriesCurrent\n        ],\n        \"labels\": [\"\"]\n    }]\n},{\n    topic: \"Factor\",\n    payload: [{\n        \"series\": [\"Factor\"],\n        \"data\": [\n            seriesFactor\n        ],\n        \"labels\": [\"\"]\n    }]\n}];\n",
        "id": "c13e3bc9.29ac58",
        "initialize": "",
        "name": "To charts",
        "noerr": 0,
        "outputs": 5,
        "type": "function",
        "wires": [
            [
                "dc89aa3d.2aadf"
            ],
            [
                "71cbe8d8.f1fcb8"
            ],
            [
                "4142ba6e.7b1854"
            ],
            [
                "63d08d40.dba0cc"
            ],
            [
                "2d2ae5fa.5e0f02"
            ]
        ],
        "x": 240,
        "y": 300,
        "z": "da818f88.a776d"
    },
    {
        "chartType": "line",
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "cutout": 0,
        "dot": false,
        "group": "78fa6592.1d0d3c",
        "height": 0,
        "id": "dc89aa3d.2aadf",
        "interpolate": "linear",
        "label": "",
        "legend": "true",
        "name": "Solar power",
        "nodata": "",
        "order": 1,
        "outputs": 1,
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "86400",
        "type": "ui_chart",
        "useOneColor": false,
        "useUTC": false,
        "width": 0,
        "wires": [
            []
        ],
        "x": 570,
        "xformat": "HH:mm:ss",
        "y": 220,
        "ymax": "",
        "ymin": "0",
        "z": "da818f88.a776d"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "id": "cb6c01da.86161",
        "name": "Serial out",
        "qos": "2",
        "retain": "false",
        "topic": "cmnd/tasmota_85B208/SerialSend3",
        "type": "mqtt out",
        "wires": [],
        "x": 560,
        "y": 320,
        "z": "dd00ef6b.1ab33"
    },
    {
        "action": "",
        "from": "",
        "id": "c8d2fde4.4da09",
        "name": "[SPACE]",
        "property": "",
        "reg": false,
        "rules": [
            {
                "p": "payload",
                "pt": "msg",
                "t": "set",
                "to": "\\s",
                "tot": "str"
            }
        ],
        "to": "",
        "type": "change",
        "wires": [
            [
                "cb6c01da.86161",
                "38d45dc9.9d7152"
            ]
        ],
        "x": 220,
        "y": 60,
        "z": "dd00ef6b.1ab33"
    },
    {
        "action": "",
        "from": "",
        "id": "1074edfe.e111e2",
        "name": "[OPEN\\n]",
        "property": "",
        "reg": false,
        "rules": [
            {
                "p": "payload",
                "pt": "msg",
                "t": "set",
                "to": "OPEN\\n",
                "tot": "str"
            }
        ],
        "to": "",
        "type": "change",
        "wires": [
            [
                "cb6c01da.86161"
            ]
        ],
        "x": 220,
        "y": 180,
        "z": "dd00ef6b.1ab33"
    },
    {
        "drop": false,
        "id": "38d45dc9.9d7152",
        "name": "",
        "nbRateUnits": "1",
        "outputs": 1,
        "pauseType": "delay",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "rate": "1",
        "rateUnits": "second",
        "timeout": "5",
        "timeoutUnits": "milliseconds",
        "type": "delay",
        "wires": [
            [
                "1074edfe.e111e2"
            ]
        ],
        "x": 230,
        "y": 120,
        "z": "dd00ef6b.1ab33"
    },
    {
        "action": "",
        "from": "",
        "id": "29ddccaa.2032ac",
        "name": "[CLOSE\\n]",
        "property": "",
        "reg": false,
        "rules": [
            {
                "p": "payload",
                "pt": "msg",
                "t": "set",
                "to": "CLOSE\\n",
                "tot": "str"
            }
        ],
        "to": "",
        "type": "change",
        "wires": [
            [
                "cb6c01da.86161"
            ]
        ],
        "x": 230,
        "y": 380,
        "z": "dd00ef6b.1ab33"
    },
    {
        "action": "",
        "from": "",
        "id": "1bac8483.5b41e3",
        "name": "[SPACE]",
        "property": "",
        "reg": false,
        "rules": [
            {
                "p": "payload",
                "pt": "msg",
                "t": "set",
                "to": "\\s",
                "tot": "str"
            }
        ],
        "to": "",
        "type": "change",
        "wires": [
            [
                "465b7c11.db5664",
                "cb6c01da.86161"
            ]
        ],
        "x": 220,
        "y": 260,
        "z": "dd00ef6b.1ab33"
    },
    {
        "drop": false,
        "id": "465b7c11.db5664",
        "name": "",
        "nbRateUnits": "1",
        "outputs": 1,
        "pauseType": "delay",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "rate": "1",
        "rateUnits": "second",
        "timeout": "5",
        "timeoutUnits": "milliseconds",
        "type": "delay",
        "wires": [
            [
                "29ddccaa.2032ac"
            ]
        ],
        "x": 230,
        "y": 320,
        "z": "dd00ef6b.1ab33"
    },
    {
        "action": "",
        "from": "",
        "id": "b7c33600.a676f8",
        "name": "[STATUS\\n]",
        "property": "",
        "reg": false,
        "rules": [
            {
                "p": "payload",
                "pt": "msg",
                "t": "set",
                "to": "STATUS\\n",
                "tot": "str"
            }
        ],
        "to": "",
        "type": "change",
        "wires": [
            [
                "cb6c01da.86161"
            ]
        ],
        "x": 230,
        "y": 580,
        "z": "dd00ef6b.1ab33"
    },
    {
        "action": "",
        "from": "",
        "id": "d85699b2.c04788",
        "name": "[SPACE]",
        "property": "",
        "reg": false,
        "rules": [
            {
                "p": "payload",
                "pt": "msg",
                "t": "set",
                "to": "\\s",
                "tot": "str"
            }
        ],
        "to": "",
        "type": "change",
        "wires": [
            [
                "1f6c944a.1edc34",
                "cb6c01da.86161"
            ]
        ],
        "x": 220,
        "y": 460,
        "z": "dd00ef6b.1ab33"
    },
    {
        "drop": false,
        "id": "1f6c944a.1edc34",
        "name": "",
        "nbRateUnits": "1",
        "outputs": 1,
        "pauseType": "delay",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "rate": "1",
        "rateUnits": "second",
        "timeout": "5",
        "timeoutUnits": "milliseconds",
        "type": "delay",
        "wires": [
            [
                "b7c33600.a676f8"
            ]
        ],
        "x": 230,
        "y": 520,
        "z": "dd00ef6b.1ab33"
    },
    {
        "id": "aba5fd44.09bea8",
        "info": "SerialConfig 8N2\nBaudrate 19200\nSerialDelimiter 10\n\nRule1 ON system#boot DO Backlog SerialConfig 8N2; Baudrate 19200 ; SerialDelimiter 10 ENDON\nRule1 1\n",
        "name": "Settings",
        "type": "comment",
        "wires": [],
        "x": 560,
        "y": 260,
        "z": "dd00ef6b.1ab33"
    },
    {
        "id": "50b19175.72032",
        "links": [
            "6f726c2.3989694"
        ],
        "name": "open",
        "type": "link in",
        "wires": [
            [
                "c8d2fde4.4da09"
            ]
        ],
        "x": 115,
        "y": 60,
        "z": "dd00ef6b.1ab33"
    },
    {
        "id": "8300a6ed.9959b8",
        "links": [
            "20492d95.5756aa"
        ],
        "name": "close",
        "type": "link in",
        "wires": [
            [
                "1bac8483.5b41e3"
            ]
        ],
        "x": 115,
        "y": 260,
        "z": "dd00ef6b.1ab33"
    },
    {
        "id": "b0f74837.6f49d8",
        "links": [
            "deb7a328.2db828"
        ],
        "name": "status",
        "type": "link in",
        "wires": [
            [
                "d85699b2.c04788"
            ]
        ],
        "x": 115,
        "y": 460,
        "z": "dd00ef6b.1ab33"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "datatype": "utf8",
        "id": "7762f97.8b30e08",
        "inputs": 0,
        "name": "",
        "qos": "2",
        "topic": "tele/tasmota_85B208/RESULT",
        "type": "mqtt in",
        "wires": [
            [
                "c90ce5c1.288b4"
            ]
        ],
        "x": 230,
        "y": 660,
        "z": "dd00ef6b.1ab33"
    },
    {
        "checkall": "true",
        "id": "8d51290.8a48d58",
        "name": "Handle serial in",
        "outputs": 3,
        "property": "payload",
        "propertyType": "msg",
        "repair": false,
        "rules": [
            {
                "t": "eq",
                "v": "200  OK",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "210 UnLocked",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "211 Strong Locked",
                "vt": "str"
            }
        ],
        "type": "switch",
        "wires": [
            [],
            [
                "d96f7ea8.8779b"
            ],
            [
                "e4bef279.11e6d8"
            ]
        ],
        "x": 360,
        "y": 760,
        "z": "dd00ef6b.1ab33"
    },
    {
        "finalize": "",
        "func": "msg.payload = msg.payload.replace(/[\\r\\n]/, '');\nreturn msg;\n",
        "id": "c90ce5c1.288b4",
        "initialize": "",
        "name": "Remove CR/LF",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "6c54f86.54a4888"
            ]
        ],
        "x": 460,
        "y": 660,
        "z": "dd00ef6b.1ab33"
    },
    {
        "action": "obj",
        "id": "6c54f86.54a4888",
        "name": "",
        "pretty": false,
        "property": "payload",
        "type": "json",
        "wires": [
            [
                "1e84724e.698e56"
            ]
        ],
        "x": 610,
        "y": 660,
        "z": "dd00ef6b.1ab33"
    },
    {
        "action": "",
        "from": "",
        "id": "1e84724e.698e56",
        "name": "",
        "property": "",
        "reg": false,
        "rules": [
            {
                "p": "payload",
                "pt": "msg",
                "t": "set",
                "to": "msg.payload.SerialReceived",
                "tot": "jsonata"
            }
        ],
        "to": "",
        "type": "change",
        "wires": [
            [
                "8d51290.8a48d58"
            ]
        ],
        "x": 180,
        "y": 760,
        "z": "dd00ef6b.1ab33"
    },
    {
        "id": "d96f7ea8.8779b",
        "links": [
            "fe48bc28.777df8"
        ],
        "name": "is open",
        "type": "link out",
        "wires": [],
        "x": 515,
        "y": 740,
        "z": "dd00ef6b.1ab33"
    },
    {
        "id": "e4bef279.11e6d8",
        "links": [
            "14ceb8e1.7a757f"
        ],
        "name": "is closed",
        "type": "link out",
        "wires": [],
        "x": 515,
        "y": 780,
        "z": "dd00ef6b.1ab33"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "id": "27c52d4.458b452",
        "name": "Send",
        "qos": "2",
        "retain": "false",
        "topic": "devices/3c71bf10840c/ir/send",
        "type": "mqtt out",
        "wires": [],
        "x": 850,
        "y": 440,
        "z": "47b85eed.4f8768"
    },
    {
        "bgcolor": "",
        "color": "",
        "group": "ffd321ee.bc6a68",
        "height": 1,
        "icon": "",
        "id": "663db002.d44848",
        "label": "Vol +",
        "name": "",
        "order": 3,
        "passthru": false,
        "payload": "{\"genre1\":4,\"genre2\":1,\"func\":368,\"id\":0}",
        "payloadType": "json",
        "tooltip": "",
        "topic": "",
        "topicType": "str",
        "type": "ui_button",
        "width": 2,
        "wires": [
            [
                "c2afa7fa.ffa0e"
            ]
        ],
        "x": 370,
        "y": 340,
        "z": "47b85eed.4f8768"
    },
    {
        "bgcolor": "",
        "color": "",
        "group": "ffd321ee.bc6a68",
        "height": 1,
        "icon": "",
        "id": "308add3a.dd0ad2",
        "label": "Vol -",
        "name": "",
        "order": 5,
        "passthru": false,
        "payload": "{\"genre1\":4,\"genre2\":1,\"func\":369,\"id\":0}",
        "payloadType": "json",
        "tooltip": "",
        "topic": "",
        "topicType": "str",
        "type": "ui_button",
        "width": 2,
        "wires": [
            [
                "c2afa7fa.ffa0e"
            ]
        ],
        "x": 370,
        "y": 300,
        "z": "47b85eed.4f8768"
    },
    {
        "bgcolor": "",
        "color": "",
        "group": "ffd321ee.bc6a68",
        "height": 1,
        "icon": "fa-power-off ",
        "id": "6b315fd.fc335a",
        "label": "Power",
        "name": "",
        "order": 1,
        "passthru": false,
        "payload": "{\"genre1\":4,\"genre2\":1,\"func\":5,\"id\":0}",
        "payloadType": "json",
        "tooltip": "",
        "topic": "",
        "topicType": "str",
        "type": "ui_button",
        "width": 2,
        "wires": [
            [
                "c2afa7fa.ffa0e"
            ]
        ],
        "x": 370,
        "y": 220,
        "z": "47b85eed.4f8768"
    },
    {
        "bgcolor": "",
        "color": "",
        "group": "ffd321ee.bc6a68",
        "height": 1,
        "icon": "",
        "id": "3047d665.00345a",
        "label": "Fav 1",
        "name": "",
        "order": 7,
        "passthru": false,
        "payload": "{\"genre1\":4,\"genre2\":1,\"func\":242,\"id\":0}",
        "payloadType": "json",
        "tooltip": "",
        "topic": "",
        "topicType": "str",
        "type": "ui_button",
        "width": 2,
        "wires": [
            [
                "c2afa7fa.ffa0e"
            ]
        ],
        "x": 370,
        "y": 400,
        "z": "47b85eed.4f8768"
    },
    {
        "bgcolor": "",
        "color": "",
        "group": "ffd321ee.bc6a68",
        "height": 1,
        "icon": "",
        "id": "ef439224.3fe148",
        "label": "Fav 2",
        "name": "",
        "order": 8,
        "passthru": false,
        "payload": "{\"genre1\":4,\"genre2\":1,\"func\":243,\"id\":0}",
        "payloadType": "json",
        "tooltip": "",
        "topic": "",
        "topicType": "str",
        "type": "ui_button",
        "width": 2,
        "wires": [
            [
                "c2afa7fa.ffa0e"
            ]
        ],
        "x": 370,
        "y": 440,
        "z": "47b85eed.4f8768"
    },
    {
        "bgcolor": "",
        "color": "",
        "group": "ffd321ee.bc6a68",
        "height": 1,
        "icon": "",
        "id": "480789f3.80ec28",
        "label": "Fav 3",
        "name": "",
        "order": 9,
        "passthru": false,
        "payload": "{\"genre1\":4,\"genre2\":1,\"func\":244,\"id\":0}",
        "payloadType": "json",
        "tooltip": "",
        "topic": "",
        "topicType": "str",
        "type": "ui_button",
        "width": 2,
        "wires": [
            [
                "c2afa7fa.ffa0e"
            ]
        ],
        "x": 370,
        "y": 480,
        "z": "47b85eed.4f8768"
    },
    {
        "bgcolor": "",
        "color": "",
        "group": "ffd321ee.bc6a68",
        "height": 1,
        "icon": "",
        "id": "810f7e64.88fd88",
        "label": "CoreELEC",
        "name": "",
        "order": 10,
        "passthru": false,
        "payload": "{\"genre1\":4,\"genre2\":1,\"func\":720,\"id\":0}",
        "payloadType": "json",
        "tooltip": "",
        "topic": "",
        "topicType": "str",
        "type": "ui_button",
        "width": 2,
        "wires": [
            [
                "c2afa7fa.ffa0e"
            ]
        ],
        "x": 390,
        "y": 560,
        "z": "47b85eed.4f8768"
    },
    {
        "bgcolor": "",
        "color": "",
        "group": "ffd321ee.bc6a68",
        "height": 1,
        "icon": "",
        "id": "98f96afe.f0e1b",
        "label": "TV AUDIO",
        "name": "",
        "order": 11,
        "passthru": false,
        "payload": "{\"genre1\":4,\"genre2\":1,\"func\":722,\"id\":0}",
        "payloadType": "json",
        "tooltip": "",
        "topic": "",
        "topicType": "str",
        "type": "ui_button",
        "width": 2,
        "wires": [
            [
                "c2afa7fa.ffa0e"
            ]
        ],
        "x": 390,
        "y": 600,
        "z": "47b85eed.4f8768"
    },
    {
        "finalize": "",
        "func": "const manufacturer = 0x2A4C;\n\n\nconst manufacturerBin = bin2(manufacturer, 16);\nconst manufacturerParBin = bin2(manufacturer.toString(16)\n    .split(\"\")\n    .reduce((tot,val) => tot ^ parseInt(val,15))\n  , 4);\n\nfunction bin(value, length) {\n  return value.toString(2).padStart(length, '0')\n    .split(\"\").reverse().join(\"\");\n}\nfunction bin2(value, length) {\n  return value.toString(2).padStart(length, '0');\n}\n\nconst funcBin = bin(msg.payload.func, 10);\nconst idBin = bin(msg.payload.id, 2);\n\nconst par1 = manufacturerParBin + bin(msg.payload.genre1, 4);\nconst par2 = bin(msg.payload.genre2, 4) + funcBin.substr(0,4);\nconst par3 = funcBin.substr(4,6) + idBin;\n\nconst par = parseInt( par1, 2 ) ^ parseInt( par2, 2 ) ^ parseInt( par3, 2 );\n\nmsg.payload = manufacturerBin + par1 + par2 + par3 + bin2(par, 8);\n\nreturn msg;\n",
        "id": "c2afa7fa.ffa0e",
        "initialize": "",
        "libs": [],
        "name": "",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "27c52d4.458b452"
            ]
        ],
        "x": 700,
        "y": 440,
        "z": "47b85eed.4f8768"
    },
    {
        "bgcolor": "",
        "color": "",
        "group": "ffd321ee.bc6a68",
        "height": 1,
        "icon": "",
        "id": "e9450668.fd1058",
        "label": "PC",
        "name": "",
        "order": 12,
        "passthru": false,
        "payload": "{\"genre1\":4,\"genre2\":1,\"func\":721,\"id\":0}",
        "payloadType": "json",
        "tooltip": "",
        "topic": "",
        "topicType": "str",
        "type": "ui_button",
        "width": 2,
        "wires": [
            [
                "c2afa7fa.ffa0e"
            ]
        ],
        "x": 370,
        "y": 640,
        "z": "47b85eed.4f8768"
    },
    {
        "bgcolor": "",
        "className": "",
        "color": "",
        "group": "ffd321ee.bc6a68",
        "height": 1,
        "icon": "",
        "id": "463fb6d1e44553aa",
        "label": "Desk light",
        "name": "",
        "order": 14,
        "passthru": false,
        "payload": "toggle",
        "payloadType": "str",
        "tooltip": "",
        "topic": "",
        "topicType": "str",
        "type": "ui_button",
        "width": 2,
        "wires": [
            [
                "2586f1da0a82b2c2"
            ]
        ],
        "x": 380,
        "y": 720,
        "z": "47b85eed.4f8768"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "contentType": "",
        "correl": "",
        "expiry": "",
        "id": "2586f1da0a82b2c2",
        "name": "Desk light",
        "qos": "2",
        "respTopic": "",
        "retain": "false",
        "topic": "cmnd/tasmota_81B55D/Power",
        "type": "mqtt out",
        "userProps": "",
        "wires": [],
        "x": 860,
        "y": 720,
        "z": "47b85eed.4f8768"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "datatype": "utf8",
        "id": "1e78788b.d1f907",
        "inputs": 0,
        "name": "",
        "nl": false,
        "qos": "2",
        "rap": true,
        "rh": 0,
        "topic": "devices/083af27d53d4/display/value",
        "type": "mqtt in",
        "wires": [
            [
                "1e288f7c.8ffe09"
            ]
        ],
        "x": 180,
        "y": 260,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "finalize": "",
        "func": "var result = '';\nconst parts = msg.payload.split(':')\nmainloop:\nfor(var pos = 0 ; pos < 16; pos++) {\n    const val = parts[1].substr(2*pos, 2);\n    if(val == '20') {\n        result += ' ';\n        continue;\n    }\n    if(val == '2e') {\n        result += '.';\n        continue;\n    }\n    for(var index = 0 ; index < 10 ; index++) {\n        if(parseInt(val, 16) == parseInt('30', 16) + index) {\n            result += index;\n            continue mainloop;\n        }\n    }\n    // 41 + 26 -> A-Z\n    for(var index = 0 ; index < 26 ; index++) {\n        if(parseInt(val, 16) == parseInt('41', 16) + index) {\n            result +=  String.fromCharCode(65 + index);\n            continue mainloop;\n        }\n    }\n    // 61 + 26 -> a-z\n    for(var index = 0 ; index < 26 ; index++) {\n        if(parseInt(val, 16) == parseInt('61', 16) + index) {\n            result +=  String.fromCharCode(97 + index);\n            continue mainloop;\n        }\n    }\n    \n    result += '[' + val + ']';\n}\nif(parts[0] == '80') {\n    msg.line = 0;\n}\nif(parts[0] == 'c0') {\n    msg.line = 1;\n}\nmsg.payload = result;\n\nreturn msg;\n",
        "id": "1e288f7c.8ffe09",
        "initialize": "",
        "libs": [],
        "name": "Decode",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "ade62bfd.db7c8"
            ]
        ],
        "x": 420,
        "y": 260,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "checkall": "true",
        "id": "ade62bfd.db7c8",
        "name": "On line",
        "outputs": 2,
        "property": "line",
        "propertyType": "msg",
        "repair": false,
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "1",
                "vt": "num"
            }
        ],
        "type": "switch",
        "wires": [
            [
                "a457e85f.e51fa8",
                "a0c5623a.e6642"
            ],
            [
                "272e8d50.e61bd2",
                "824f02f6.fa838"
            ]
        ],
        "x": 560,
        "y": 260,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "format": "{{msg.payload}}",
        "group": "c2fe2d52.ecd92",
        "height": 0,
        "id": "a0c5623a.e6642",
        "label": "Line 1",
        "layout": "row-spread",
        "name": "",
        "order": 1,
        "type": "ui_text",
        "width": 0,
        "wires": [],
        "x": 710,
        "y": 200,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "format": "{{msg.payload}}",
        "group": "c2fe2d52.ecd92",
        "height": 0,
        "id": "272e8d50.e61bd2",
        "label": "Line 2",
        "layout": "row-spread",
        "name": "",
        "order": 2,
        "type": "ui_text",
        "width": 0,
        "wires": [],
        "x": 710,
        "y": 300,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "checkall": "false",
        "id": "a457e85f.e51fa8",
        "name": "Is valid A/V",
        "outputs": 2,
        "property": "payload",
        "propertyType": "msg",
        "repair": false,
        "rules": [
            {
                "case": false,
                "t": "regex",
                "v": "^[ 0-9]{3}[0-9]\\.[0-9]{2}A  [ 0-9]{2}\\.[0-9]{2}V$",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "type": "switch",
        "wires": [
            [
                "ddde7a52.eb0518",
                "6329b497.9a20ac"
            ],
            [
                "53dbd41a.10de64"
            ]
        ],
        "x": 850,
        "y": 160,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "finalize": "",
        "func": "msg.payload = msg.payload.substr(0, 7).trim();\n\nreturn msg;",
        "id": "ddde7a52.eb0518",
        "initialize": "",
        "libs": [],
        "name": "A",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "c2ebf962.4edf28",
                "adce4d19.4dcec8",
                "25fdbc490fea8383"
            ]
        ],
        "x": 1090,
        "y": 140,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "format": "{{msg.payload}}A",
        "group": "5228a8eb.6285a8",
        "height": 0,
        "id": "c2ebf962.4edf28",
        "label": "Current",
        "layout": "row-spread",
        "name": "",
        "order": 1,
        "type": "ui_text",
        "width": 0,
        "wires": [],
        "x": 1260,
        "y": 140,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "finalize": "",
        "func": "msg.payload = msg.payload.substr(10, 5).trim();\nreturn msg;",
        "id": "6329b497.9a20ac",
        "initialize": "",
        "libs": [],
        "name": "V",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "41f1fac5.5110ac",
                "c399dd18.dcec5",
                "a56ab27fee88d3b5",
                "c68da9dd79bd9368"
            ]
        ],
        "x": 1090,
        "y": 180,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "format": "{{msg.payload}}V",
        "group": "5228a8eb.6285a8",
        "height": 0,
        "id": "41f1fac5.5110ac",
        "label": "Voltage",
        "layout": "row-spread",
        "name": "",
        "order": 2,
        "type": "ui_text",
        "width": 0,
        "wires": [],
        "x": 1260,
        "y": 180,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "finalize": "",
        "func": "msg.payload = msg.payload.substr(10, 5).trim();\nreturn msg;",
        "id": "17fd1d58.45a60b",
        "initialize": "",
        "libs": [],
        "name": "W",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "73e2489a.455ee",
                "a9b366ec.c12228"
            ]
        ],
        "x": 1090,
        "y": 220,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "format": "{{msg.payload}}W",
        "group": "5228a8eb.6285a8",
        "height": 0,
        "id": "73e2489a.455ee",
        "label": "Power",
        "layout": "row-spread",
        "name": "",
        "order": 3,
        "type": "ui_text",
        "width": 0,
        "wires": [],
        "x": 1250,
        "y": 220,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "finalize": "",
        "func": "msg.payload = msg.payload.substr(0, 7).trim();\n\nreturn msg;",
        "id": "108a73ba.eecb8c",
        "initialize": "",
        "libs": [],
        "name": "Ap",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "58e2fcf8.db7a2c",
                "23bbdf4b.3e74b"
            ]
        ],
        "x": 1090,
        "y": 300,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "format": "{{msg.payload}}A",
        "group": "5228a8eb.6285a8",
        "height": 0,
        "id": "58e2fcf8.db7a2c",
        "label": "Peak current",
        "layout": "row-spread",
        "name": "",
        "order": 6,
        "type": "ui_text",
        "width": 0,
        "wires": [],
        "x": 1270,
        "y": 300,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "finalize": "",
        "func": "msg.payload = msg.payload.substr(0, 7).trim();\n\nreturn msg;",
        "id": "b937a2bb.ac9638",
        "initialize": "",
        "libs": [],
        "name": "Vm",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "4236e731.58ea6",
                "4036f06a.f14628"
            ]
        ],
        "x": 1090,
        "y": 260,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "format": "{{msg.payload}}V",
        "group": "5228a8eb.6285a8",
        "height": 0,
        "id": "4236e731.58ea6",
        "label": "Minimum voltage",
        "layout": "row-spread",
        "name": "",
        "order": 8,
        "type": "ui_text",
        "width": 0,
        "wires": [],
        "x": 1290,
        "y": 260,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "finalize": "",
        "func": "msg.payload = msg.payload.substr(0, 7).trim();\n\nreturn msg;",
        "id": "853a1d6c.7b6d3",
        "initialize": "",
        "libs": [],
        "name": "Wp",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "bf651858.991aa",
                "ad67320b.5d1a48"
            ]
        ],
        "x": 1090,
        "y": 340,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "format": "{{msg.payload}}W",
        "group": "5228a8eb.6285a8",
        "height": 0,
        "id": "bf651858.991aa",
        "label": "Peak power",
        "layout": "row-spread",
        "name": "",
        "order": 7,
        "type": "ui_text",
        "width": 0,
        "wires": [],
        "x": 1270,
        "y": 340,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "finalize": "",
        "func": "msg.payload = msg.payload.substr(0, 7).trim();\n\nreturn msg;",
        "id": "9adb1873.b41018",
        "initialize": "",
        "libs": [],
        "name": "Wh",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "5fad6bad.f095bc",
                "b74c4fb.64b333"
            ]
        ],
        "x": 1090,
        "y": 380,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "format": "{{msg.payload}}Wh",
        "group": "5228a8eb.6285a8",
        "height": 0,
        "id": "5fad6bad.f095bc",
        "label": "Total power",
        "layout": "row-spread",
        "name": "",
        "order": 5,
        "type": "ui_text",
        "width": 0,
        "wires": [],
        "x": 1270,
        "y": 380,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "finalize": "",
        "func": "msg.payload = msg.payload.substr(0, 7).trim();\n\nreturn msg;",
        "id": "8e9e0cd1.584b78",
        "initialize": "",
        "libs": [],
        "name": "Ah",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "35ea8416.963c64",
                "aefc79b3.831a78"
            ]
        ],
        "x": 1090,
        "y": 420,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "format": "{{msg.payload}}Ah",
        "group": "5228a8eb.6285a8",
        "height": 0,
        "id": "35ea8416.963c64",
        "label": "Total current",
        "layout": "row-spread",
        "name": "",
        "order": 4,
        "type": "ui_text",
        "width": 0,
        "wires": [],
        "x": 1270,
        "y": 420,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "finalize": "",
        "func": "data = parseFloat(msg.payload);\n\nmsg.measurement = \"watt_meter\";\nmsg.payload = {\n  current: data,\n  time: new Date().getTime()\n};\nreturn msg;\n",
        "id": "adce4d19.4dcec8",
        "initialize": "",
        "libs": [],
        "name": "To influxdb format - current",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "11e27e3d.41afba"
            ]
        ],
        "x": 1060,
        "y": 580,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "bucket": "home_db/autogen",
        "database": "database",
        "id": "11e27e3d.41afba",
        "influxdb": "9e729019.2637e",
        "measurement": "",
        "name": "",
        "org": "phin-home",
        "precision": "",
        "precisionV18FluxV20": "ms",
        "retentionPolicy": "",
        "retentionPolicyV18Flux": "",
        "type": "influxdb out",
        "wires": [],
        "x": 1390,
        "y": 700,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "finalize": "",
        "func": "data = parseFloat(msg.payload);\n\nmsg.measurement = \"watt_meter\";\nmsg.payload = {\n  voltage: data,\n  time: new Date().getTime()\n};\nreturn msg;\n",
        "id": "c399dd18.dcec5",
        "initialize": "",
        "libs": [],
        "name": "To influxdb format - voltage",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "11e27e3d.41afba"
            ]
        ],
        "x": 1060,
        "y": 620,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "finalize": "",
        "func": "data = parseFloat(msg.payload);\n\nmsg.measurement = \"watt_meter\";\nmsg.payload = {\n  power: data,\n  time: new Date().getTime()\n};\nreturn msg;\n",
        "id": "a9b366ec.c12228",
        "initialize": "",
        "libs": [],
        "name": "To influxdb format - power",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "11e27e3d.41afba"
            ]
        ],
        "x": 1050,
        "y": 660,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "finalize": "",
        "func": "data = parseFloat(msg.payload);\n\nmsg.measurement = \"watt_meter\";\nmsg.payload = {\n  minimum_voltage: data,\n  time: new Date().getTime()\n};\nreturn msg;\n",
        "id": "4036f06a.f14628",
        "initialize": "",
        "libs": [],
        "name": "To influxdb format - minimum_voltage",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "11e27e3d.41afba"
            ]
        ],
        "x": 1090,
        "y": 700,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "finalize": "",
        "func": "data = parseFloat(msg.payload);\n\nmsg.measurement = \"watt_meter\";\nmsg.payload = {\n  peak_current: data,\n  time: new Date().getTime()\n};\nreturn msg;\n",
        "id": "23bbdf4b.3e74b",
        "initialize": "",
        "libs": [],
        "name": "To influxdb format - peak_current",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "11e27e3d.41afba"
            ]
        ],
        "x": 1080,
        "y": 740,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "finalize": "",
        "func": "data = parseFloat(msg.payload);\n\nmsg.measurement = \"watt_meter\";\nmsg.payload = {\n  peak_power: data,\n  time: new Date().getTime()\n};\nreturn msg;\n",
        "id": "ad67320b.5d1a48",
        "initialize": "",
        "libs": [],
        "name": "To influxdb format - peak_power",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "11e27e3d.41afba"
            ]
        ],
        "x": 1070,
        "y": 780,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "finalize": "",
        "func": "data = parseFloat(msg.payload);\n\nmsg.measurement = \"watt_meter\";\nmsg.payload = {\n  total_power: data,\n  time: new Date().getTime()\n};\nreturn msg;\n",
        "id": "b74c4fb.64b333",
        "initialize": "",
        "libs": [],
        "name": "To influxdb format - total_power",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "11e27e3d.41afba"
            ]
        ],
        "x": 1070,
        "y": 820,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "finalize": "",
        "func": "data = parseFloat(msg.payload);\n\nmsg.measurement = \"watt_meter\";\nmsg.payload = {\n  total_current: data,\n  time: new Date().getTime()\n};\nreturn msg;\n",
        "id": "aefc79b3.831a78",
        "initialize": "",
        "libs": [],
        "name": "To influxdb format - total_current",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "11e27e3d.41afba"
            ]
        ],
        "x": 1080,
        "y": 860,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "checkall": "false",
        "id": "824f02f6.fa838",
        "name": "Determine type",
        "outputs": 6,
        "property": "payload",
        "propertyType": "msg",
        "repair": false,
        "rules": [
            {
                "case": false,
                "t": "regex",
                "v": "^[ 0-9]{3}[0-9]\\.[0-9]{2}Vm [ 0-9]{2}[0-9]\\.[0-9]W$",
                "vt": "str"
            },
            {
                "case": false,
                "t": "regex",
                "v": "^[ 0-9]{3}[0-9]\\.[0-9]{2}Ap [ 0-9]{2}[0-9]\\.[0-9]W$",
                "vt": "str"
            },
            {
                "case": false,
                "t": "regex",
                "v": "^[ 0-9]{4}[0-9]\\.[0-9]Wp [ 0-9]{2}[0-9]\\.[0-9]W$",
                "vt": "str"
            },
            {
                "case": false,
                "t": "regex",
                "v": "^[ 0-9]{4}[0-9]\\.[0-9]Wh [ 0-9]{2}[0-9]\\.[0-9]W$",
                "vt": "str"
            },
            {
                "case": false,
                "t": "regex",
                "v": "^[ 0-9]{2}[0-9]\\.[0-9]{3}Ah [ 0-9]{2}[0-9]\\.[0-9]W$",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "type": "switch",
        "wires": [
            [
                "17fd1d58.45a60b",
                "b937a2bb.ac9638"
            ],
            [
                "17fd1d58.45a60b",
                "108a73ba.eecb8c"
            ],
            [
                "17fd1d58.45a60b",
                "853a1d6c.7b6d3"
            ],
            [
                "17fd1d58.45a60b",
                "9adb1873.b41018"
            ],
            [
                "17fd1d58.45a60b",
                "8e9e0cd1.584b78"
            ],
            [
                "53dbd41a.10de64"
            ]
        ],
        "x": 860,
        "y": 340,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "active": true,
        "complete": "false",
        "console": false,
        "id": "53dbd41a.10de64",
        "name": "",
        "statusType": "auto",
        "statusVal": "",
        "tosidebar": true,
        "tostatus": false,
        "type": "debug",
        "wires": [],
        "x": 1110,
        "y": 480,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "contentType": "",
        "correl": "",
        "expiry": "",
        "id": "e9d48a809bc76da1",
        "name": "",
        "qos": "",
        "respTopic": "",
        "retain": "",
        "topic": "devices/083af27d53d4/relay/value/set",
        "type": "mqtt out",
        "userProps": "",
        "wires": [],
        "x": 890,
        "y": 940,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "crontab": "",
        "id": "bc6b1cbd8e6853d2",
        "name": "",
        "once": false,
        "onceDelay": 0.1,
        "payload": "true",
        "payloadType": "str",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "topic": "",
        "type": "inject",
        "wires": [
            [
                "e9d48a809bc76da1"
            ]
        ],
        "x": 580,
        "y": 900,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "crontab": "",
        "id": "472846c729ae2582",
        "name": "",
        "once": false,
        "onceDelay": 0.1,
        "payload": "false",
        "payloadType": "str",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "topic": "",
        "type": "inject",
        "wires": [
            [
                "e9d48a809bc76da1"
            ]
        ],
        "x": 580,
        "y": 980,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "action": "",
        "from": "",
        "id": "163a939aa8b8ee1f",
        "name": "Hysteresis",
        "property": "",
        "reg": false,
        "rules": [
            {
                "p": "payload",
                "pt": "msg",
                "t": "set",
                "to": "$number(payload) >= 30.0 ? \"true\" : $number(payload) <= 20.0 ? \"false\" : undefined",
                "tot": "jsonata"
            }
        ],
        "to": "",
        "type": "change",
        "wires": [
            [
                "fe2e72006a9e524f"
            ]
        ],
        "x": 290,
        "y": 540,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "func": "rbe",
        "gap": "",
        "id": "fe2e72006a9e524f",
        "inout": "out",
        "name": "",
        "property": "payload",
        "septopics": false,
        "start": "",
        "topi": "topic",
        "type": "rbe",
        "wires": [
            [
                "62c5f5156157b23c"
            ]
        ],
        "x": 470,
        "y": 540,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "crontab": "",
        "id": "1c9258db74b0ef09",
        "name": "",
        "once": false,
        "onceDelay": 0.1,
        "payload": "10.0",
        "payloadType": "num",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "topic": "",
        "type": "inject",
        "wires": [
            [
                "163a939aa8b8ee1f"
            ]
        ],
        "x": 110,
        "y": 480,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "active": true,
        "complete": "false",
        "console": false,
        "id": "62c5f5156157b23c",
        "name": "",
        "statusType": "auto",
        "statusVal": "",
        "tosidebar": true,
        "tostatus": false,
        "type": "debug",
        "wires": [],
        "x": 630,
        "y": 540,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "crontab": "",
        "id": "982dffc250d4a3cc",
        "name": "",
        "once": false,
        "onceDelay": 0.1,
        "payload": "22.0",
        "payloadType": "num",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "topic": "",
        "type": "inject",
        "wires": [
            [
                "163a939aa8b8ee1f"
            ]
        ],
        "x": 110,
        "y": 540,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "crontab": "",
        "id": "b545164f612cfcf2",
        "name": "",
        "once": false,
        "onceDelay": 0.1,
        "payload": "40.0",
        "payloadType": "num",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "topic": "",
        "type": "inject",
        "wires": [
            [
                "163a939aa8b8ee1f"
            ]
        ],
        "x": 110,
        "y": 600,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "className": "",
        "group": "cfb855fc5bc17af9",
        "height": 0,
        "id": "6f3ecb22d63bda58",
        "label": "Cutoff",
        "max": "40",
        "min": "0",
        "name": "",
        "order": 1,
        "outs": "all",
        "passthru": true,
        "step": "0.1",
        "tooltip": "",
        "topic": "topic",
        "topicType": "msg",
        "type": "ui_slider",
        "width": 0,
        "wires": [
            [
                "bb83f57ad2ebccfb",
                "494153d0722010d7"
            ]
        ],
        "x": 170,
        "y": 920,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "format": "{{msg.payload}}",
        "group": "cfb855fc5bc17af9",
        "height": 0,
        "id": "bb83f57ad2ebccfb",
        "label": "Cutoff",
        "layout": "row-spread",
        "name": "",
        "order": 2,
        "type": "ui_text",
        "width": 0,
        "wires": [],
        "x": 330,
        "y": 900,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "action": "",
        "from": "",
        "id": "494153d0722010d7",
        "name": "",
        "property": "",
        "reg": false,
        "rules": [
            {
                "p": "cutoff",
                "pt": "flow",
                "t": "set",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "to": "",
        "type": "change",
        "wires": [
            []
        ],
        "x": 360,
        "y": 940,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "action": "",
        "from": "",
        "id": "a56ab27fee88d3b5",
        "name": "Cutoff",
        "property": "",
        "reg": false,
        "rules": [
            {
                "p": "payload",
                "pt": "msg",
                "t": "set",
                "to": "$number(payload) <= $flowContext(\"cutoff\") ? \"false\" : undefined",
                "tot": "jsonata"
            }
        ],
        "to": "",
        "type": "change",
        "wires": [
            [
                "fc279ae2450c0c2d"
            ]
        ],
        "x": 270,
        "y": 680,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "format": "{{msg.payload}}",
        "group": "cfb855fc5bc17af9",
        "height": 0,
        "id": "aae79a70de0affbb",
        "label": "Relay",
        "layout": "row-spread",
        "name": "",
        "order": 4,
        "type": "ui_text",
        "width": 0,
        "wires": [],
        "x": 790,
        "y": 680,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "func": "rbe",
        "gap": "",
        "id": "fc279ae2450c0c2d",
        "inout": "out",
        "name": "",
        "property": "payload",
        "septopics": false,
        "start": "",
        "topi": "topic",
        "type": "rbe",
        "wires": [
            [
                "e9d48a809bc76da1",
                "9cebf3070f50cd70"
            ]
        ],
        "x": 450,
        "y": 680,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "crontab": "",
        "id": "523df4638db3b7cb",
        "name": "",
        "once": false,
        "onceDelay": 0.1,
        "payload": "40.0",
        "payloadType": "num",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "topic": "",
        "type": "inject",
        "wires": [
            [
                "a56ab27fee88d3b5"
            ]
        ],
        "x": 110,
        "y": 780,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "crontab": "",
        "id": "6c326b922c311458",
        "name": "",
        "once": false,
        "onceDelay": 0.1,
        "payload": "22.0",
        "payloadType": "num",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "topic": "",
        "type": "inject",
        "wires": [
            [
                "a56ab27fee88d3b5"
            ]
        ],
        "x": 110,
        "y": 720,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "crontab": "",
        "id": "297b8e18fd9bd9f9",
        "name": "",
        "once": false,
        "onceDelay": 0.1,
        "payload": "10.0",
        "payloadType": "num",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "topic": "",
        "type": "inject",
        "wires": [
            [
                "a56ab27fee88d3b5"
            ]
        ],
        "x": 110,
        "y": 660,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "bgcolor": "",
        "color": "",
        "group": "cfb855fc5bc17af9",
        "height": 0,
        "icon": "",
        "id": "1fd2ed4e12ce7cd2",
        "label": "Arm",
        "name": "",
        "order": 3,
        "passthru": false,
        "payload": "true",
        "payloadType": "str",
        "tooltip": "",
        "topic": "topic",
        "topicType": "msg",
        "type": "ui_button",
        "width": 0,
        "wires": [
            [
                "fc279ae2450c0c2d"
            ]
        ],
        "x": 130,
        "y": 840,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "action": "",
        "from": "",
        "id": "9cebf3070f50cd70",
        "name": "",
        "property": "",
        "reg": false,
        "rules": [
            {
                "from": "true",
                "fromt": "str",
                "p": "payload",
                "pt": "msg",
                "t": "change",
                "to": "On",
                "tot": "str"
            },
            {
                "from": "false",
                "fromt": "str",
                "p": "payload",
                "pt": "msg",
                "t": "change",
                "to": "Off",
                "tot": "str"
            }
        ],
        "to": "",
        "type": "change",
        "wires": [
            [
                "aae79a70de0affbb"
            ]
        ],
        "x": 620,
        "y": 680,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "id": "0298ac04433f6f2b",
        "info": "Issues:\n- If the module reboots, it's back to off.\n- If the server reboots, state might be wrong one, so 'ARM' doesn't send a signal (or so..)\n",
        "name": "",
        "type": "comment",
        "wires": [],
        "x": 640,
        "y": 760,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "contentType": "",
        "correl": "",
        "expiry": "",
        "id": "afcc5f66e0926eb9",
        "name": "",
        "qos": "0",
        "respTopic": "",
        "retain": "false",
        "topic": "devices/the1602",
        "type": "mqtt out",
        "userProps": "",
        "wires": [],
        "x": 1430,
        "y": 1060,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "crontab": "",
        "id": "985659140f197316",
        "name": "",
        "once": false,
        "onceDelay": 0.1,
        "payload": "\"Hello!\\nThere!\"",
        "payloadType": "json",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "topic": "",
        "type": "inject",
        "wires": [
            [
                "afcc5f66e0926eb9"
            ]
        ],
        "x": 1200,
        "y": 1060,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "action": "",
        "from": "",
        "id": "25fdbc490fea8383",
        "name": "T:amps",
        "property": "",
        "reg": false,
        "rules": [
            {
                "p": "topic",
                "pt": "msg",
                "t": "set",
                "to": "amps",
                "tot": "str"
            }
        ],
        "to": "",
        "type": "change",
        "wires": [
            [
                "2ca46fc4121aaeff",
                "d1e7267c.8a21e8"
            ]
        ],
        "x": 1460,
        "y": 840,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "accumulate": true,
        "build": "object",
        "count": "1",
        "id": "2ca46fc4121aaeff",
        "joiner": "\\n",
        "joinerType": "str",
        "key": "topic",
        "mode": "custom",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "reduceExp": "",
        "reduceFixup": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceRight": false,
        "timeout": "",
        "type": "join",
        "wires": [
            [
                "61c2458ae4b6c47e"
            ]
        ],
        "x": 1670,
        "y": 920,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "id": "61c2458ae4b6c47e",
        "name": "Line1",
        "output": "str",
        "syntax": "mustache",
        "template": "{{payload.amps}}A {{payload.volts}}V {{payload.spinner}}   ",
        "type": "template",
        "wires": [
            [
                "afcc5f66e0926eb9"
            ]
        ],
        "x": 1490,
        "y": 980,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "action": "",
        "from": "",
        "id": "c68da9dd79bd9368",
        "name": "T:volts",
        "property": "",
        "reg": false,
        "rules": [
            {
                "p": "topic",
                "pt": "msg",
                "t": "set",
                "to": "volts",
                "tot": "str"
            }
        ],
        "to": "",
        "type": "change",
        "wires": [
            [
                "2ca46fc4121aaeff"
            ]
        ],
        "x": 1450,
        "y": 900,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "finalize": "",
        "func": "var count = context.get(\"count\") || 0;\ncount++;\ncontext.set(\"count\", count);\n\nconst sequence = [' ', '*'];\nconst character = sequence[count % 2];\n\nnode.status({ text: character });\n\nreturn {\n    payload: character,\n    topic: \"spinner\"\n};\n",
        "icon": "node-red-dashboard/ui_numeric.png",
        "id": "d1e7267c.8a21e8",
        "initialize": "",
        "l": false,
        "libs": [],
        "name": "counter",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "2ca46fc4121aaeff"
            ]
        ],
        "x": 1615,
        "y": 800,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "checkall": "false",
        "id": "fec642dfb71e38f3",
        "name": "Is valid A/V",
        "outputs": 2,
        "property": "payload",
        "propertyType": "msg",
        "repair": false,
        "rules": [
            {
                "case": false,
                "t": "regex",
                "v": "^[ 0-9]{2}[0-9]\\.[0-9]{2}A   [ 0-9]{2}\\.[0-9]{2}V$",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "type": "switch",
        "wires": [
            [
                "214ae9e48cd57749",
                "59c30eb3a0c0b24b"
            ],
            []
        ],
        "x": 210,
        "y": 1140,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "finalize": "",
        "func": "msg.payload = msg.payload.substr(0, 6).trim();\n\nreturn msg;",
        "id": "214ae9e48cd57749",
        "initialize": "",
        "libs": [],
        "name": "A",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            []
        ],
        "x": 450,
        "y": 1120,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "finalize": "",
        "func": "msg.payload = msg.payload.substr(10, 5).trim();\nreturn msg;",
        "id": "59c30eb3a0c0b24b",
        "initialize": "",
        "libs": [],
        "name": "V",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            []
        ],
        "x": 450,
        "y": 1160,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "finalize": "",
        "func": "msg.payload = msg.payload.substr(10, 5).trim();\nreturn msg;",
        "id": "5ddf48b19c363c13",
        "initialize": "",
        "libs": [],
        "name": "W",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            []
        ],
        "x": 450,
        "y": 1200,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "finalize": "",
        "func": "msg.payload = msg.payload.substr(0, 6).trim();\n\nreturn msg;",
        "id": "f111f0bfd385588c",
        "initialize": "",
        "libs": [],
        "name": "Ap",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            []
        ],
        "x": 450,
        "y": 1280,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "finalize": "",
        "func": "msg.payload = msg.payload.substr(0, 6).trim();\n\nreturn msg;",
        "id": "be2aa265e05f3f95",
        "initialize": "",
        "libs": [],
        "name": "Vm",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            []
        ],
        "x": 450,
        "y": 1240,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "finalize": "",
        "func": "msg.payload = msg.payload.substr(0, 6).trim();\n\nreturn msg;",
        "id": "b0846953d8393f73",
        "initialize": "",
        "libs": [],
        "name": "Wp",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            []
        ],
        "x": 450,
        "y": 1320,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "finalize": "",
        "func": "msg.payload = msg.payload.substr(0, 6).trim();\n\nreturn msg;",
        "id": "ebfcc395a5d61d85",
        "initialize": "",
        "libs": [],
        "name": "Wh",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            []
        ],
        "x": 450,
        "y": 1360,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "finalize": "",
        "func": "msg.payload = msg.payload.substr(0, 6).trim();\n\nreturn msg;",
        "id": "3c7422ea35940ec9",
        "initialize": "",
        "libs": [],
        "name": "Ah",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            []
        ],
        "x": 450,
        "y": 1400,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "checkall": "false",
        "id": "8af9423ad491e59e",
        "name": "Determine type",
        "outputs": 6,
        "property": "payload",
        "propertyType": "msg",
        "repair": false,
        "rules": [
            {
                "case": false,
                "t": "regex",
                "v": "^[ 0-9]{2}[0-9]\\.[0-9]{2}Vm  [ 0-9]{2}[0-9]\\.[0-9]W$",
                "vt": "str"
            },
            {
                "case": false,
                "t": "regex",
                "v": "^[ 0-9]{2}[0-9]\\.[0-9]{2}Ap  [ 0-9]{2}[0-9]\\.[0-9]W$",
                "vt": "str"
            },
            {
                "case": false,
                "t": "regex",
                "v": "^[ 0-9]{3}[0-9]\\.[0-9]Wp  [ 0-9]{2}[0-9]\\.[0-9]W$",
                "vt": "str"
            },
            {
                "case": false,
                "t": "regex",
                "v": "^[ 0-9]{3}[0-9]\\.[0-9]Wh  [ 0-9]{2}[0-9]\\.[0-9]W$",
                "vt": "str"
            },
            {
                "case": false,
                "t": "regex",
                "v": "^[ 0-9][0-9]\\.[0-9]{3}Ah  [ 0-9]{2}[0-9]\\.[0-9]W$",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "type": "switch",
        "wires": [
            [
                "5ddf48b19c363c13",
                "be2aa265e05f3f95"
            ],
            [
                "5ddf48b19c363c13",
                "f111f0bfd385588c"
            ],
            [
                "5ddf48b19c363c13",
                "b0846953d8393f73"
            ],
            [
                "5ddf48b19c363c13",
                "ebfcc395a5d61d85"
            ],
            [
                "5ddf48b19c363c13",
                "3c7422ea35940ec9"
            ],
            []
        ],
        "x": 220,
        "y": 1320,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "id": "3e2f06498a743711",
        "info": "",
        "name": "Old",
        "type": "comment",
        "wires": [],
        "x": 210,
        "y": 1080,
        "z": "1ce9f9b0.4eb196"
    },
    {
        "crontab": "",
        "id": "290794d7.5e34f4",
        "name": "Hello dragon",
        "once": false,
        "onceDelay": 0.1,
        "payload": "48656c6c6f20447261676f6e21,4e6f73792065683f203a4029",
        "payloadType": "str",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "topic": "",
        "type": "inject",
        "wires": [
            [
                "8a40680c.753a38"
            ]
        ],
        "x": 850,
        "y": 340,
        "z": "5ecdcc0a.76574c"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "contentType": "",
        "correl": "",
        "expiry": "",
        "id": "8a40680c.753a38",
        "name": "Display",
        "qos": "",
        "respTopic": "",
        "retain": "",
        "topic": "devices/083af2512be8/display/write",
        "type": "mqtt out",
        "userProps": "",
        "wires": [],
        "x": 1040,
        "y": 400,
        "z": "5ecdcc0a.76574c"
    },
    {
        "finalize": "",
        "func": "var result = '';\nfor(var pos = 0 ; pos < msg.payload.length; pos++) {\n    const hex = msg.payload.charCodeAt(pos).toString(16).padStart(2, '0');\n    result += hex;\n}\nmsg.payload = result;\n\nreturn msg;\n",
        "id": "aed2dddf.60265",
        "initialize": "",
        "libs": [],
        "name": "To Hex",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "716991d4.a1a01"
            ]
        ],
        "x": 530,
        "y": 420,
        "z": "5ecdcc0a.76574c"
    },
    {
        "adjAmount": 0,
        "adjDir": "add",
        "adjType": "days",
        "format": "HH:mm:ss",
        "id": "df864241.949cb8",
        "inTz": "Europe/Amsterdam",
        "input": "",
        "inputType": "msg",
        "locale": "en-US",
        "name": "",
        "outTz": "Europe/Amsterdam",
        "output": "",
        "outputType": "msg",
        "topic": "time",
        "type": "moment",
        "wires": [
            [
                "6ef69076.f80fe8"
            ]
        ],
        "x": 250,
        "y": 480,
        "z": "5ecdcc0a.76574c"
    },
    {
        "crontab": "",
        "id": "d258f716.22b308",
        "name": "",
        "once": false,
        "onceDelay": 0.1,
        "payload": "",
        "payloadType": "date",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "1",
        "topic": "",
        "type": "inject",
        "wires": [
            [
                "df864241.949cb8"
            ]
        ],
        "x": 110,
        "y": 480,
        "z": "5ecdcc0a.76574c"
    },
    {
        "id": "dac9fcf5.4f3058",
        "links": [
            "2a70fa85.6933e6"
        ],
        "name": "Watt out",
        "type": "link in",
        "wires": [
            [
                "db76bd33.e27f28"
            ]
        ],
        "x": 35,
        "y": 280,
        "z": "5ecdcc0a.76574c"
    },
    {
        "id": "33f8b039.6e3cb",
        "links": [
            "fbf9e851.048aa"
        ],
        "name": "temps",
        "type": "link in",
        "wires": [
            [
                "913512d.bc0baf"
            ]
        ],
        "x": 695,
        "y": 220,
        "z": "5ecdcc0a.76574c"
    },
    {
        "id": "d6ec2ac3.24f5f",
        "links": [
            "6cacd492.26010c"
        ],
        "name": "Watt in",
        "type": "link in",
        "wires": [
            [
                "db76bd33.e27f28"
            ]
        ],
        "x": 35,
        "y": 220,
        "z": "5ecdcc0a.76574c"
    },
    {
        "checkall": "true",
        "id": "913512d.bc0baf",
        "name": "",
        "outputs": 1,
        "property": "topic",
        "propertyType": "msg",
        "repair": false,
        "rules": [
            {
                "t": "eq",
                "v": "bedroom_outside_api",
                "vt": "str"
            }
        ],
        "type": "switch",
        "wires": [
            [
                "7be92e4.ad998d"
            ]
        ],
        "x": 790,
        "y": 220,
        "z": "5ecdcc0a.76574c"
    },
    {
        "checkall": "true",
        "id": "db76bd33.e27f28",
        "name": "",
        "outputs": 1,
        "property": "payload",
        "propertyType": "msg",
        "repair": false,
        "rules": [
            {
                "t": "neq",
                "v": "0",
                "vt": "str"
            }
        ],
        "type": "switch",
        "wires": [
            [
                "d462f40b.eef98"
            ]
        ],
        "x": 290,
        "y": 220,
        "z": "5ecdcc0a.76574c"
    },
    {
        "accumulate": true,
        "build": "object",
        "count": "1",
        "id": "6ef69076.f80fe8",
        "joiner": "\\n",
        "joinerType": "str",
        "key": "topic",
        "mode": "custom",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "reduceExp": "",
        "reduceFixup": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceRight": false,
        "timeout": "",
        "type": "join",
        "wires": [
            [
                "628ec9c3.499b1",
                "8b3239a0.8112e8"
            ]
        ],
        "x": 110,
        "y": 400,
        "z": "5ecdcc0a.76574c"
    },
    {
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "id": "628ec9c3.499b1",
        "name": "Line2",
        "output": "str",
        "syntax": "mustache",
        "template": "{{payload.watt}}W      :@)",
        "type": "template",
        "wires": [
            [
                "de5d8770.7ff6"
            ]
        ],
        "x": 250,
        "y": 420,
        "z": "5ecdcc0a.76574c"
    },
    {
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "id": "8b3239a0.8112e8",
        "name": "Line1",
        "output": "str",
        "syntax": "mustache",
        "template": "{{payload.time}} {{payload.temp}}\u00dfC",
        "type": "template",
        "wires": [
            [
                "c14885e9.243bf8"
            ]
        ],
        "x": 250,
        "y": 380,
        "z": "5ecdcc0a.76574c"
    },
    {
        "finalize": "",
        "func": "var result = '';\nfor(var pos = 0 ; pos < msg.payload.length; pos++) {\n    const hex = msg.payload.charCodeAt(pos).toString(16).padStart(2, '0');\n    result += hex;\n}\nmsg.payload = result;\n\nreturn msg;\n",
        "id": "d3d952bf.f92338",
        "initialize": "",
        "libs": [],
        "name": "To Hex",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "716991d4.a1a01"
            ]
        ],
        "x": 530,
        "y": 380,
        "z": "5ecdcc0a.76574c"
    },
    {
        "action": "",
        "from": "",
        "id": "1c37971b.0c9cf1",
        "name": "T:watt",
        "property": "",
        "reg": false,
        "rules": [
            {
                "p": "topic",
                "pt": "msg",
                "t": "set",
                "to": "watt",
                "tot": "str"
            }
        ],
        "to": "",
        "type": "change",
        "wires": [
            [
                "6ef69076.f80fe8"
            ]
        ],
        "x": 570,
        "y": 220,
        "z": "5ecdcc0a.76574c"
    },
    {
        "action": "",
        "from": "",
        "id": "7be92e4.ad998d",
        "name": "T:temp",
        "property": "",
        "reg": false,
        "rules": [
            {
                "p": "topic",
                "pt": "msg",
                "t": "set",
                "to": "temp",
                "tot": "str"
            }
        ],
        "to": "",
        "type": "change",
        "wires": [
            [
                "6ef69076.f80fe8"
            ]
        ],
        "x": 950,
        "y": 220,
        "z": "5ecdcc0a.76574c"
    },
    {
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "id": "3b193522.e5b63a",
        "name": "Combine lines",
        "output": "str",
        "syntax": "mustache",
        "template": "{{payload.line1}},{{payload.line2}}",
        "type": "template",
        "wires": [
            [
                "8a40680c.753a38"
            ]
        ],
        "x": 840,
        "y": 400,
        "z": "5ecdcc0a.76574c"
    },
    {
        "accumulate": true,
        "build": "object",
        "count": "1",
        "id": "716991d4.a1a01",
        "joiner": "\\n",
        "joinerType": "str",
        "key": "topic",
        "mode": "custom",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "reduceExp": "",
        "reduceFixup": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceRight": false,
        "timeout": "",
        "type": "join",
        "wires": [
            [
                "3b193522.e5b63a"
            ]
        ],
        "x": 670,
        "y": 400,
        "z": "5ecdcc0a.76574c"
    },
    {
        "action": "",
        "from": "",
        "id": "c14885e9.243bf8",
        "name": "T:line1",
        "property": "",
        "reg": false,
        "rules": [
            {
                "p": "topic",
                "pt": "msg",
                "t": "set",
                "to": "line1",
                "tot": "str"
            }
        ],
        "to": "",
        "type": "change",
        "wires": [
            [
                "d3d952bf.f92338"
            ]
        ],
        "x": 390,
        "y": 380,
        "z": "5ecdcc0a.76574c"
    },
    {
        "action": "",
        "from": "",
        "id": "de5d8770.7ff6",
        "name": "T:line2",
        "property": "",
        "reg": false,
        "rules": [
            {
                "p": "topic",
                "pt": "msg",
                "t": "set",
                "to": "line2",
                "tot": "str"
            }
        ],
        "to": "",
        "type": "change",
        "wires": [
            [
                "aed2dddf.60265"
            ]
        ],
        "x": 390,
        "y": 420,
        "z": "5ecdcc0a.76574c"
    },
    {
        "finalize": "",
        "func": "msg.payload = msg.payload.toString().padStart(4, ' ');\nreturn msg;",
        "id": "d462f40b.eef98",
        "initialize": "",
        "libs": [],
        "name": "Pad",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "1c37971b.0c9cf1"
            ]
        ],
        "x": 430,
        "y": 220,
        "z": "5ecdcc0a.76574c"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "contentType": "",
        "correl": "",
        "expiry": "",
        "id": "207fc735.bfaf48",
        "name": "Brightness",
        "qos": "",
        "respTopic": "",
        "retain": "",
        "topic": "devices/083af2512be8/leds/brightness",
        "type": "mqtt out",
        "userProps": "",
        "wires": [],
        "x": 1050,
        "y": 500,
        "z": "5ecdcc0a.76574c"
    },
    {
        "group": "a8db762f.1aeb8",
        "height": 0,
        "id": "1ecd8cf0.f37a8b",
        "label": "Brightness",
        "max": "15",
        "min": 0,
        "name": "",
        "order": 4,
        "outs": "all",
        "passthru": false,
        "step": 1,
        "tooltip": "",
        "topic": "topic",
        "topicType": "msg",
        "type": "ui_slider",
        "width": 0,
        "wires": [
            [
                "207fc735.bfaf48"
            ]
        ],
        "x": 830,
        "y": 500,
        "z": "5ecdcc0a.76574c"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "contentType": "",
        "correl": "",
        "expiry": "",
        "id": "837a82b88e246f5c",
        "name": "",
        "qos": "2",
        "respTopic": "",
        "retain": "false",
        "topic": "devices/083af25162c4/$command",
        "type": "mqtt out",
        "userProps": "",
        "wires": [],
        "x": 1280,
        "y": 440,
        "z": "6c54caeefbfa8e69"
    },
    {
        "crontab": "",
        "id": "4e9c35b455368570",
        "name": "",
        "once": false,
        "onceDelay": 0.1,
        "payload": "on",
        "payloadType": "str",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "topic": "",
        "type": "inject",
        "wires": [
            [
                "837a82b88e246f5c"
            ]
        ],
        "x": 870,
        "y": 400,
        "z": "6c54caeefbfa8e69"
    },
    {
        "crontab": "",
        "id": "20fdb972112260bf",
        "name": "",
        "once": false,
        "onceDelay": 0.1,
        "payload": "off",
        "payloadType": "str",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "topic": "",
        "type": "inject",
        "wires": [
            [
                "837a82b88e246f5c"
            ]
        ],
        "x": 870,
        "y": 480,
        "z": "6c54caeefbfa8e69"
    },
    {
        "crontab": "",
        "id": "3a683c7b731bb6b1",
        "name": "",
        "once": false,
        "onceDelay": 0.1,
        "payload": "cal",
        "payloadType": "str",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "topic": "",
        "type": "inject",
        "wires": [
            [
                "837a82b88e246f5c"
            ]
        ],
        "x": 870,
        "y": 560,
        "z": "6c54caeefbfa8e69"
    },
    {
        "crontab": "",
        "id": "b4acf436dc2e79e5",
        "name": "",
        "once": false,
        "onceDelay": 0.1,
        "payload": "lvl1",
        "payloadType": "str",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "topic": "",
        "type": "inject",
        "wires": [
            [
                "837a82b88e246f5c"
            ]
        ],
        "x": 870,
        "y": 620,
        "z": "6c54caeefbfa8e69"
    },
    {
        "crontab": "",
        "id": "2f19f23903434dee",
        "name": "",
        "once": false,
        "onceDelay": 0.1,
        "payload": "lvl2",
        "payloadType": "str",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "topic": "",
        "type": "inject",
        "wires": [
            [
                "837a82b88e246f5c"
            ]
        ],
        "x": 870,
        "y": 680,
        "z": "6c54caeefbfa8e69"
    },
    {
        "crontab": "",
        "id": "53e9c06d67a8e876",
        "name": "",
        "once": false,
        "onceDelay": 0.1,
        "payload": "lvl3",
        "payloadType": "str",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "topic": "",
        "type": "inject",
        "wires": [
            [
                "837a82b88e246f5c"
            ]
        ],
        "x": 870,
        "y": 740,
        "z": "6c54caeefbfa8e69"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "contentType": "",
        "correl": "",
        "expiry": "",
        "id": "9e8ea1a093e8767c",
        "name": "",
        "qos": "2",
        "respTopic": "",
        "retain": "false",
        "topic": "devices/083af25162c4/$reset",
        "type": "mqtt out",
        "userProps": "",
        "wires": [],
        "x": 1270,
        "y": 260,
        "z": "6c54caeefbfa8e69"
    },
    {
        "crontab": "",
        "id": "408c9f77cef71023",
        "name": "",
        "once": false,
        "onceDelay": 0.1,
        "payload": "true",
        "payloadType": "str",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "topic": "",
        "type": "inject",
        "wires": [
            [
                "9e8ea1a093e8767c"
            ]
        ],
        "x": 870,
        "y": 260,
        "z": "6c54caeefbfa8e69"
    },
    {
        "base64": false,
        "datamode": "stream",
        "datatype": "buffer",
        "host": "192.168.178.198",
        "id": "db3b1e82ced6cd74",
        "name": "",
        "newline": "",
        "port": "8888",
        "server": "client",
        "tls": "",
        "topic": "",
        "trim": false,
        "type": "tcp in",
        "wires": [
            [
                "33235cb24294f9cc"
            ]
        ],
        "x": 170,
        "y": 200,
        "z": "d40a49d02a4e326f"
    },
    {
        "active": true,
        "complete": "false",
        "console": false,
        "id": "0b3731705511f2d3",
        "name": "",
        "statusType": "auto",
        "statusVal": "",
        "tosidebar": true,
        "tostatus": false,
        "type": "debug",
        "wires": [],
        "x": 870,
        "y": 200,
        "z": "d40a49d02a4e326f"
    },
    {
        "finalize": "",
        "func": "var buffer = context.get('buffer');\n\nif(!buffer) {\n    buffer = msg.payload;\n} else {\n    buffer = Buffer.concat([buffer,msg.payload]);\n}\n\nmsg = [];\n\nwhile(buffer.length >= 64) {\n    if(buffer[0] == 0x02) {\n        // Start byte found\n        if(buffer[1] == 0x41 && buffer[2] == 0x06) {\n            // Request found\n            var length = buffer[3] + 2;\n            if(length <= buffer.length) {\n                if(buffer[4] == 0x02 && buffer[5] == 0x00) {\n                    // Sample found\n                    if(buffer[length - 1] == 0x03) {\n                        var crc = buffer[length - 2];\n     \n                        var csum = 0;\n                        for (var val of buffer.slice(1, length-2)) {\n                            csum ^= val;\n                        }                        \n                        if(crc == csum) {\n                            msg.push({\n                                payload: buffer.slice(6, length-2)\n                            });\n                            buffer = buffer.slice(length);\n                            continue;\n                        }\n                    }\n                }\n            }\n        }\n    }\n    buffer = buffer.slice(1);\n}\n\ncontext.set('buffer', buffer);\n\nreturn msg;",
        "id": "33235cb24294f9cc",
        "initialize": "",
        "libs": [],
        "name": "Parse frame",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "2d7af49fbb9d5cb8",
                "2dd30816124478db"
            ]
        ],
        "x": 450,
        "y": 200,
        "z": "d40a49d02a4e326f"
    },
    {
        "finalize": "",
        "func": "function getBit(number, bitPosition) {\n  return (number & (1 << bitPosition)) === 0 ? 0 : 1;\n}\n\nfunction sgn(value) {\n    return value > 0x7FFF ? value - 0x10000 : value;\n}\n\nfunction FormatNumber(value, format, min, max, minText, maxText) {\n    if(value < min) {\n        return minText ? minText : min.toString();\n    } else if(value > max) {\n        return maxText ? maxText : max.toString();\n    }\n\n    if(format === \"0\") {\n        return value.toFixed(0)\n    } else if(format === \"0.0\") {\n        return value.toFixed(1)\n    } else if(format === \"0.00\") {\n        return value.toFixed(2)\n    } else {\n        return \"Unexpected format: \" + format;\n    }\n}\n\nfunction NoYesCodeString(value) {\n    switch(value) {\n        case 0:\n            return \"no\";\n        case 1:\n            return \"yes\";\n    }\n}\n\nfunction StatusCodeString(value) {\n    switch(value) {\n        case 0:\n            return \"0:Off-position, no heat demand\";\n        case 1:\n            return \"1:Pre-vent./post-ventilation\";\n        case 2:\n            return \"2:Ignition\";\n        case 3:\n            return \"3:Running for CH\";\n        case 4:\n            return \"4:Running for DHW\";\n        case 5:\n            return \"5:Anti hunting time CH\";\n        case 6:\n            return \"6:Post pump time CH\";\n        case 7:\n            return \"7:Post pump time DHW\";\n        case 8:\n            return \"8:Control stop\";\n        case 9:\n            return \"9:Shut down\";\n        case 10:\n            return \"10:Ventingcycle\";\n        case 11:\n            return \"11:Forced burner low flame\";\n        case 12:\n            return \"12:Forced burner high CH\";\n        case 13:\n            return \"13:Forced burner high DHW\";\n        case 15:\n            return \"15:Manual heat demand\";\n        default:\n            return \"Unknown State (\" + value + \")\";\n    }\n}\n\nfunction LockingCodeString(value) {\n    switch(value) {\n        case 0:\n            return \"E00: Sensor error\";\n        case 1:\n            return \"E01: Flow > Tmax.\";\n        case 2:\n            return \"E02: Return > Flow\";\n        case 3:\n            return \"E03: Earthing fault\";\n        case 4:\n            return \"E04: No flame\";\n        case 5:\n            return \"E05: >5 start failures\";\n        case 6:\n            return \"E06: Flame simulation\";\n        case 7:\n            return \"E07: Water pressure to low\";\n        case 8:\n            return \"E08: Fan error\";\n        case 9:\n            return \"E09: Low hydraulic pressure\";\n        case 10:\n            return \"E10: insufficient deairation\";\n        case 11:\n            return \"E11: Airbox temp. > max.\";\n        case 12:\n            return \"E12: Error checking HRU\";\n        case 13:\n            return \"E13: fuse\";\n        case 43:\n            return \"E43: Parameter bounds\";\n        case 44:\n            return \"E44: Parameter checksum\";\n        case 45:\n            return \"E45: Default parameters\";\n        case 46:\n            return \"E46: dF/dU table error\";\n        default:\n            return \"Unknown locking code (\" + value + \")\";\n    }\n}\n\nfunction BlockingCodeString(value) {\n    switch(value) {\n        case 40:\n            return \"B40: Boiler codes unknown\";\n        case 80:\n            return \"B80: shut down input\";\n        case 81:\n            return \"B81: error checking HRU\";\n        case 82:\n            return \"B82:Solar boiler warm, DHW off\";\n        case 83:\n            return \"B83: Calorifier sensor error\";\n        case 90:\n            return \"B90: temperaure increase\";\n        case 91:\n            return \"B91: deltaT to big\";\n        case 92:\n            return \"B92: insufficient flow\";\n        default:\n            return \"Unknown blocking code (\" + value + \")\";\n    }\n}\n\nfunction OffOnCodeString(value) {\n    switch(value) {\n        case 0:\n            return \"Off\";\n        case 1:\n            return \"On\";\n    }\n}\n\nfunction ClosedOpenCodeString(value) {\n    switch(value) {\n        case 0:\n            return \"Closed\";\n        case 1:\n            return \"Open\";\n    }\n}\n\nfunction OpenClosedCodeString(value) {\n    switch(value) {\n        case 0:\n            return \"Open\";\n        case 1:\n            return \"Closed\";\n    }\n}\n\nvar result = {};\nvar buffer = msg.payload;\n\n// State, Group: 0\nresult[\"State\"] = StatusCodeString(buffer[40]);\n// Lock-out, Group: 0\nresult[\"Lock-out\"] = LockingCodeString(buffer[41]);\n// Shutdown, Group: 0\nresult[\"Shutdown\"] = BlockingCodeString(buffer[42]);\n// Flow temperature, Group: 1\nresult[\"Flow temp. [\u00b0C]\"] = FormatNumber(sgn(buffer[0] + (buffer[1] << 8)) * 0.01, \"0.00\", -25, 150, \"Open\", \"Closed\");\n// Return temperature, Group: 1\nresult[\"Return temp. [\u00b0C]\"] = FormatNumber(sgn(buffer[2] + (buffer[3] << 8)) * 0.01, \"0.00\", -25, 150, \"Open\", \"Closed\");\n// DHW temperature, Group: 1\nresult[\"DHW temp. [\u00b0C]\"] = FormatNumber(sgn(buffer[4] + (buffer[5] << 8)) * 0.01, \"0.00\", -25, 150, \"Open\", \"Closed\");\n// Internal setpoint, Group: 1\nresult[\"Internal setpoint [\u00b0C]\"] = FormatNumber(sgn(buffer[27] + (buffer[28] << 8)) * 0.01, \"0.00\", 0, 100, \"Open\", \"Closed\");\n// Setpoint for CH mode, Group: 1\nresult[\"CH Setpoint [\u00b0C]\"] = FormatNumber(sgn(buffer[16] + (buffer[17] << 8)) * 0.01, \"0.00\", 0, 100, \"Open\", \"Closed\");\n// Flow temp setpoint DHW mode, Group: 1\nresult[\"DHW Setpoint [\u00b0C]\"] = FormatNumber(sgn(buffer[18] + (buffer[19] << 8)) * 0.01, \"0.00\", 0, 100, \"Open\", \"Closed\");\n// Room temperature OpenTherm controller, Group: 1\nresult[\"Room temp. [\u00b0C]\"] = FormatNumber(sgn(buffer[14] + (buffer[15] << 8)) * 0.01, \"0.00\", -25, 150, \"Open\", \"Closed\");\n// Room temp setpointOpenTherm controller, Group: 1\nresult[\"Room temp setpoint [\u00b0C]\"] = FormatNumber(sgn(buffer[20] + (buffer[21] << 8)) * 0.01, \"0.00\", 0, 100, \"Open\", \"Closed\");\n// Temp. boiler control, Group: 1\nresult[\"Boiler Control temp. [\u00b0C]\"] = FormatNumber(sgn(buffer[12] + (buffer[13] << 8)) * 0.01, \"0.00\", -25, 150, \"Open\", \"Closed\");\n// Setpoint fanspeed, Group: 2\nresult[\"Fanspeed setpoint [Rpm]\"] = FormatNumber(buffer[22] + (buffer[23] << 8), \"0\", 0, 7000);\n// Fan speed, Group: 2\nresult[\"Fan speed [Rpm]\"] = FormatNumber(buffer[24] + (buffer[25] << 8), \"0\", 0, 7000);\n// Ionisation current, Group: 2\nresult[\"Ionisation current [uA]\"] = FormatNumber(buffer[26] * 0.1, \"0.0\", 0, 10);\n// Pomp speed, Group: 2\nresult[\"Pump [%]\"] = FormatNumber(buffer[30], \"0\", 0, 100);\n// Output, Group: 2\nresult[\"Available power [%]\"] = FormatNumber(buffer[29], \"0\", 0, 100);\n// Actual power from boiler, Group: 2\nresult[\"Actual power [%]\"] = FormatNumber(buffer[33], \"0\", 0, 100);\n// From controller desired max power, Group: 2\nresult[\"Required output [%]\"] = FormatNumber(buffer[32], \"0\", 0, 100);\n// Gas valve, Group: 3\nresult[\"Gas valve\"] = ClosedOpenCodeString(getBit(buffer[38], 0) === 0 ? 1 : 0);\n// Ignition, Group: 3\nresult[\"Ignition\"] = OffOnCodeString(getBit(buffer[38], 2));\n// Ionisation, Group: 3\nresult[\"Ionisation\"] = NoYesCodeString(getBit(buffer[37], 2));\n// Three way valve, Group: 3\nresult[\"Three way valve\"] = OffOnCodeString(getBit(buffer[38], 3));\n// Pump, Group: 3\nresult[\"Pump\"] = OffOnCodeString(getBit(buffer[39], 0));\n// Heat demand from modulating controller, Group: 3\nresult[\"Mod. heat demand\"] = NoYesCodeString(getBit(buffer[36], 1));\n// Heatdemand from on/off controller, Group: 3\nresult[\"On/off heat demand\"] = NoYesCodeString(getBit(buffer[36], 2));\n// DHW eco, boiler not kept warm, Group: 3\nresult[\"DHW eco\"] = NoYesCodeString(getBit(buffer[36], 4) === 0 ? 1 : 0);\n// DHW heat demand, Group: 3\nresult[\"DHW heat demand\"] = NoYesCodeString(getBit(buffer[36], 7));\n// Flow switch for detecting DHW, Group: 3\nresult[\"Flow switch\"] = OffOnCodeString(getBit(buffer[37], 3));\n// shut down input or HRU test, Group: 3\nresult[\"Shut down input\"] = OpenClosedCodeString(getBit(buffer[37], 0));\n// Modulating controller connected, Group: 3\nresult[\"Mod. controller\"] = NoYesCodeString(getBit(buffer[36], 0));\n\nreturn {\n    payload: result\n};\n",
        "id": "2d7af49fbb9d5cb8",
        "initialize": "",
        "libs": [],
        "name": "Parse sample",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "0b3731705511f2d3"
            ]
        ],
        "x": 660,
        "y": 200,
        "z": "d40a49d02a4e326f"
    },
    {
        "base64": false,
        "beserver": "client",
        "end": false,
        "host": "192.168.178.198",
        "id": "fffd3690ab0cd887",
        "name": "",
        "port": "8888",
        "tls": "",
        "type": "tcp out",
        "wires": [],
        "x": 600,
        "y": 400,
        "z": "d40a49d02a4e326f"
    },
    {
        "crontab": "",
        "id": "6fad1f83889df6a8",
        "name": "",
        "once": false,
        "onceDelay": 0.1,
        "payload": "",
        "payloadType": "date",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "1",
        "topic": "",
        "type": "inject",
        "wires": [
            [
                "3bc1ecc2b79435ae"
            ]
        ],
        "x": 140,
        "y": 400,
        "z": "d40a49d02a4e326f"
    },
    {
        "finalize": "",
        "func": "\nvar request = 0x0552;\nvar reply   = 0x0641;\n\nvar identify   = 0x010B;\nvar sample     = 0x0200;\nvar eepromRead = 0x1000;\n\nvar type = request;\nvar func = sample;\n\nvar buffer = Buffer.from(\n    [0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03]\n);\n\nbuffer[1] = (type >> 0) & 0xff;\nbuffer[2] = (type >> 8) & 0xff;\n\nbuffer[4] = (func >> 8) & 0xff;\nbuffer[5] = (func >> 0) & 0xff;\n\nbuffer[3] = buffer.length - 2;\n\nvar csum = 0;\nfor (var val of buffer.slice(1, buffer.length - 2)) {\n    csum ^= val;\n}                        \nbuffer[buffer.length-2] = csum;\n\n\nmsg.payload = buffer;\n\nreturn msg;",
        "id": "3bc1ecc2b79435ae",
        "initialize": "",
        "libs": [],
        "name": "Remeha Request",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "fffd3690ab0cd887"
            ]
        ],
        "x": 350,
        "y": 400,
        "z": "d40a49d02a4e326f"
    },
    {
        "finalize": "",
        "func": "function getBit(number, bitPosition) {\n  return (number & (1 << bitPosition)) === 0 ? 0 : 1;\n}\n\nfunction sgn(value) {\n    return value > 0x7FFF ? value - 0x10000 : value;\n}\n\nvar result = {};\nvar buffer = msg.payload;\n\nreturn {\n    measurement: \"central_heating_diag\",\n    payload: {\n        state: buffer[40],\n        lock_out: buffer[41],\n        shutdown: buffer[42],\n        flow_temp: (sgn(buffer[0] + (buffer[1] << 8)) * (1000 * 0.01)) / 1000,\n        return_temp: (sgn(buffer[2] + (buffer[3] << 8)) * (1000 * 0.01)) / 1000,\n        dhw_temp: (sgn(buffer[4] + (buffer[5] << 8)) * (1000 * 0.01)) / 1000,\n        internal_setpoint: (sgn(buffer[27] + (buffer[28] << 8)) * (1000 * 0.01)) / 1000,\n        ch_setpoint: (sgn(buffer[16] + (buffer[17] << 8)) * (1000 * 0.01)) / 1000,\n        dhw_setpoint: (sgn(buffer[18] + (buffer[19] << 8)) * (1000 * 0.01)) / 1000,\n        room_temp: (sgn(buffer[14] + (buffer[15] << 8)) * (1000 * 0.01)) / 1000,\n        room_temp_setpoint: (sgn(buffer[20] + (buffer[21] << 8)) * (1000 * 0.01)) / 1000,\n        boiler_control_temp: (sgn(buffer[12] + (buffer[13] << 8)) * (1000 * 0.01)) / 1000,\n        fanspeed_setpoint: buffer[22] + (buffer[23] << 8),\n        fan_speed: buffer[24] + (buffer[25] << 8),\n        ionisation_current: (buffer[26] * (1000 * 0.1)) / 1000,\n        pump_speed: buffer[30],\n        available_power: buffer[29],\n        actual_power: buffer[33],\n        required_output: buffer[32],\n        gas_valve: getBit(buffer[38], 0) === 0 ? 1 : 0,\n        ignition: getBit(buffer[38], 2),\n        ionisation: getBit(buffer[37], 2),\n        three_way_valve: getBit(buffer[38], 3),\n        pump: getBit(buffer[39], 0),\n        mod_heat_demand: getBit(buffer[36], 1),\n        on_off_heat_demand: getBit(buffer[36], 2),\n        dhw_eco: getBit(buffer[36], 4) === 0 ? 1 : 0,\n        dhw_heat_demand: getBit(buffer[36], 7),\n        flow_switch: getBit(buffer[37], 3),\n        shut_down_input: getBit(buffer[37], 0),\n        mod_controller: getBit(buffer[36], 0),\n        time: new Date().getTime()\n    }\n};\n\n",
        "id": "2dd30816124478db",
        "initialize": "",
        "libs": [],
        "name": "Parse sample",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "f467169fa32ae12e"
            ]
        ],
        "x": 660,
        "y": 280,
        "z": "d40a49d02a4e326f"
    },
    {
        "bucket": "home_db/autogen",
        "database": "database",
        "id": "f467169fa32ae12e",
        "influxdb": "9e729019.2637e",
        "measurement": "",
        "name": "",
        "org": "phin-home",
        "precision": "",
        "precisionV18FluxV20": "ms",
        "retentionPolicy": "",
        "retentionPolicyV18Flux": "",
        "type": "influxdb out",
        "wires": [],
        "x": 890,
        "y": 280,
        "z": "d40a49d02a4e326f"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "datatype": "json",
        "id": "d2baeb97d466f9c2",
        "inputs": 0,
        "name": "Humidity-A",
        "nl": false,
        "qos": "2",
        "rap": false,
        "topic": "tele/tasmota_521590/SENSOR",
        "type": "mqtt in",
        "wires": [
            [
                "291797345c53722b"
            ]
        ],
        "x": 400,
        "y": 200,
        "z": "be8ec646a7f94614"
    },
    {
        "finalize": "",
        "func": "time = msg.payload.Time;\ndata = msg.payload.SHT3X;\n\nmsg.measurement = \"humidity1\";\nmsg.payload = {\n  temperature: data.Temperature,\n  humidity: data.Humidity,\n  dew_point: data.DewPoint,\n  time: new Date(time).getTime()\n};\nreturn msg;\n",
        "id": "291797345c53722b",
        "initialize": "",
        "libs": [],
        "name": "To influxdb format",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "ec4f6398910cefaa"
            ]
        ],
        "x": 730,
        "y": 200,
        "z": "be8ec646a7f94614"
    },
    {
        "bucket": "home_db/autogen",
        "database": "database",
        "id": "ec4f6398910cefaa",
        "influxdb": "9e729019.2637e",
        "measurement": "",
        "name": "",
        "org": "phin-home",
        "precision": "",
        "precisionV18FluxV20": "ms",
        "retentionPolicy": "",
        "retentionPolicyV18Flux": "",
        "type": "influxdb out",
        "wires": [],
        "x": 1030,
        "y": 300,
        "z": "be8ec646a7f94614"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "datatype": "json",
        "id": "411f279796897c37",
        "inputs": 0,
        "name": "Humidity-B",
        "nl": false,
        "qos": "2",
        "rap": false,
        "topic": "tele/tasmota_52D984/SENSOR",
        "type": "mqtt in",
        "wires": [
            [
                "65fd0d1e9908923b"
            ]
        ],
        "x": 400,
        "y": 300,
        "z": "be8ec646a7f94614"
    },
    {
        "finalize": "",
        "func": "time = msg.payload.Time;\ndata = msg.payload.SHT3X;\n\nmsg.measurement = \"humidity2\";\nmsg.payload = {\n  temperature: data.Temperature,\n  humidity: data.Humidity,\n  dew_point: data.DewPoint,\n  time: new Date(time).getTime()\n};\nreturn msg;\n",
        "id": "65fd0d1e9908923b",
        "initialize": "",
        "libs": [],
        "name": "To influxdb format",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "ec4f6398910cefaa"
            ]
        ],
        "x": 730,
        "y": 300,
        "z": "be8ec646a7f94614"
    },
    {
        "broker": "69f5a3df.5a8b0c",
        "datatype": "json",
        "id": "997545a4b06e810a",
        "inputs": 0,
        "name": "Humidity-C",
        "nl": false,
        "qos": "2",
        "rap": false,
        "topic": "tele/tasmota_0C7410/SENSOR",
        "type": "mqtt in",
        "wires": [
            [
                "bf6daca12632d79c"
            ]
        ],
        "x": 400,
        "y": 400,
        "z": "be8ec646a7f94614"
    },
    {
        "finalize": "",
        "func": "time = msg.payload.Time;\ndata = msg.payload.SHT3X;\n\nmsg.measurement = \"humidity3\";\nmsg.payload = {\n  temperature: data.Temperature,\n  humidity: data.Humidity,\n  dew_point: data.DewPoint,\n  time: new Date(time).getTime()\n};\nreturn msg;\n",
        "id": "bf6daca12632d79c",
        "initialize": "",
        "libs": [],
        "name": "To influxdb format",
        "noerr": 0,
        "outputs": 1,
        "type": "function",
        "wires": [
            [
                "ec4f6398910cefaa"
            ]
        ],
        "x": 730,
        "y": 400,
        "z": "be8ec646a7f94614"
    }
]
